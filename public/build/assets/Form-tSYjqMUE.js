const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CMhZgqwr.js","assets/app-gPN8amc9.js","assets/app-CsR06rKs.css","assets/index-Dw7ZRzTR.js","assets/index-60DjX2N9.js","assets/button-Cj2SoaIi.js","assets/utils-DawFQoOT.js","assets/index-hgHPmbz7.js","assets/index-N1Ys4I5G.js","assets/breadcrumb-CsU1Tz76.js","assets/input-B79_MU8S.js","assets/sheet-DFPrmmg7.js","assets/index-DqyYBftF.js","assets/index-DUKhY4gL.js","assets/index-D87sG7sC.js","assets/index-Dhn2z-om.js","assets/index-iDhR6Kym.js","assets/x-iIZXAApY.js","assets/createLucideIcon-RyF2jhNp.js","assets/index-ACXiQFsW.js","assets/dropdown-menu-CbdLkicC.js","assets/index-COqnm0fp.js","assets/index-CwyY0wof.js","assets/check--GgJOlMB.js","assets/chevron-down-CvfYYazo.js","assets/skeleton-C1y8al6Q.js","assets/use-effective-tenant-D6Q0a9Kt.js","assets/use-tenant-router-D3DXtB31.js","assets/trash-2-DSsJUvYH.js","assets/en-US-DSSwd-Ay.js","assets/endOfMonth-BNqLjwTF.js","assets/user-oXVagHGM.js","assets/file-text-B43tV5Ij.js","assets/dollar-sign-D9IVVGzk.js","assets/credit-card-G68fBoPd.js","assets/mail-CoV0uW20.js","assets/shield-WeHZPON-.js","assets/circle-alert-BYLTzm0A.js","assets/package-BLUjTLsq.js","assets/users-BA1uD91c.js","assets/wallet-C1o0NA-e.js","assets/building-2-CIJou526.js","assets/chevron-right-DN0aDYO-.js","assets/index-j2LBsrE0.js","assets/textarea-CS67bC9x.js","assets/popover-Dd0TuBhp.js","assets/sparkles-No-h75YZ.js","assets/loader-circle-tx9NfyLu.js","assets/card-jiY-BaUL.js","assets/index-CauSx3qW.css"])))=>i.map(i=>d[i]);
var Gn=Object.defineProperty;var Sn=(s,f,h)=>f in s?Gn(s,f,{enumerable:!0,configurable:!0,writable:!0,value:h}):s[f]=h;var Xs=(s,f,h)=>Sn(s,typeof f!="symbol"?f+"":f,h);import{r as c,a as Oe,j as e,H as Ss,L as Jn,_ as Yn}from"./app-gPN8amc9.js";import{A as Js}from"./app-layout-m1QNDmTO.js";import{B as u}from"./button-Cj2SoaIi.js";import{I as H}from"./input-B79_MU8S.js";import{L as z}from"./label-C2dxOHx6.js";import{S as ie,a as ue,b as me,c as he,d as O}from"./select-DS7Eqww7.js";import{S as J,e as Qn,d as Y,a as Q,b as Z,c as ee}from"./sheet-DFPrmmg7.js";import{T as q,o as X,p as P}from"./breadcrumb-CsU1Tz76.js";import{P as at,a as lt,b as ct}from"./popover-Dd0TuBhp.js";import{D as Zn,a as er,b as tr,c as Et,d as sr}from"./dropdown-menu-CbdLkicC.js";import{C as Ps}from"./checkbox-D6hJrUop.js";import{T as mt}from"./textarea-CS67bC9x.js";import{S as U}from"./skeleton-C1y8al6Q.js";import{t as y}from"./index-j2LBsrE0.js";import{D as nr,b as rr,c as or,d as ar,e as lr,f as cr}from"./dialog-C50OIUyO.js";import{u as Ys}from"./use-tenant-router-D3DXtB31.js";import{A as dr}from"./arrow-left-CfrPOGod.js";import{S as Fs}from"./share-2-hKixhpQ-.js";import{E as ir}from"./ellipsis-B84MNE2J.js";import{D as zs}from"./download-CtCxA5ox.js";import{T as $s}from"./trash-2-DSsJUvYH.js";import{S as dt}from"./sparkles-No-h75YZ.js";import{L as ur}from"./list-DqZ_n-is.js";import{M as mr}from"./message-square-CgDP_O0-.js";import{P as Hs}from"./plus-BuZdw3SU.js";import{C as Bs}from"./check--GgJOlMB.js";import{P as Ws}from"./pencil-C5ykBpgC.js";import{X as Ee}from"./x-iIZXAApY.js";import{C as it}from"./copy-BzPAuX6_.js";import{F as hr}from"./file-text-B43tV5Ij.js";import{c as Ue}from"./createLucideIcon-RyF2jhNp.js";import{B as xr}from"./book-open-Ov1M_a3X.js";import{C as pr}from"./clipboard-list-ChRfoGTf.js";import{L as fr}from"./link-2-B1WGP3Eu.js";import{C as gr}from"./circle-alert-BYLTzm0A.js";/* empty css            */import"./sonner-Cdv8P1tn.js";import"./utils-DawFQoOT.js";import"./index-60DjX2N9.js";import"./index-COqnm0fp.js";import"./index-D87sG7sC.js";import"./index-hgHPmbz7.js";import"./index-Dhn2z-om.js";import"./index-DUKhY4gL.js";import"./index-Dw7ZRzTR.js";import"./index-N1Ys4I5G.js";import"./index-C4I1ptta.js";import"./index-ACXiQFsW.js";import"./chevron-down-CvfYYazo.js";import"./index-DqyYBftF.js";import"./index-iDhR6Kym.js";import"./use-effective-tenant-D6Q0a9Kt.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-oXVagHGM.js";import"./dollar-sign-D9IVVGzk.js";import"./credit-card-G68fBoPd.js";import"./mail-CoV0uW20.js";import"./shield-WeHZPON-.js";import"./package-BLUjTLsq.js";import"./users-BA1uD91c.js";import"./wallet-C1o0NA-e.js";import"./building-2-CIJou526.js";import"./chevron-right-DN0aDYO-.js";import"./index-CwyY0wof.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],jr=Ue("ChartNoAxesColumn",yr);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["path",{d:"M21 7h-3a2 2 0 0 1-2-2V2",key:"9rb54x"}],["path",{d:"M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17Z",key:"1059l0"}],["path",{d:"M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15",key:"16874u"}],["path",{d:"M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11",key:"k2ox98"}]],Nr=Ue("FileStack",br);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],wr=Ue("Film",vr);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],Ut=Ue("ImagePlus",Tr);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],_r=Ue("Quote",kr);function Cr({text:s}){const f=s.split(/\n/),h=[];let d=[];const i=()=>{d.length>0&&(h.push(e.jsx("ul",{className:"list-inside list-disc space-y-0.5 py-1",children:d.map((j,w)=>e.jsx("li",{children:j.replace(/\*\*(.+?)\*\*/g,(N,g)=>g)},w))},h.length)),d=[])};for(let j=0;j<f.length;j++){const N=f[j].trim();/^###\s/.test(N)?(i(),h.push(e.jsx("h3",{className:"mt-3 font-semibold text-sm",children:N.slice(3).trim()},h.length))):/^##\s/.test(N)?(i(),h.push(e.jsx("h2",{className:"mt-4 font-semibold",children:N.slice(2).trim()},h.length))):/^#\s/.test(N)?(i(),h.push(e.jsx("h1",{className:"mt-4 text-lg font-semibold",children:N.slice(1).trim()},h.length))):/^[-*]\s/.test(N)?d.push(N.slice(1).trim()):N===""?(i(),h.push(e.jsx("div",{className:"h-2"},h.length))):(i(),h.push(e.jsx("p",{className:"py-0.5 text-sm",children:N.split(/(\*\*.+?\*\*)/g).map((g,T)=>/^\*\*.+?\*\*$/.test(g)?e.jsx("strong",{children:g.slice(2,-2)},T):g)},h.length)))}return i(),e.jsx("div",{className:"space-y-0",children:h})}const Rr=1500,Ar=2e3;function Or(s){const f=i=>{let j="";for(const w of i){if(typeof w!="object"||w===null)continue;const N=w;N.type==="text"&&typeof N.text=="string"&&(j+=" "+N.text),Array.isArray(N.content)&&(j+=" "+f(N.content)),Array.isArray(N.children)&&(j+=" "+f(N.children))}return j};return f(s).trim().split(/\s+/).filter(i=>i.length>0).length}function Er(s){const f=[],h=d=>{let i="";for(const j of d){if(typeof j!="object"||j===null)continue;const w=j;w.type==="text"&&typeof w.text=="string"&&(i+=w.text),Array.isArray(w.content)&&(i+=h(w.content))}return i};return s.forEach((d,i)=>{var N;const w=d.type==="heading"?((N=d.props)==null?void 0:N.level)??1:0;if(w>0){const g=d.content,T=Array.isArray(g)?h(g):"";f.push({id:d.id??`h-${i}`,level:w,text:T.trim()||"(Untitled)"})}}),f}function It(s,f){return Math.max(0,Math.round(s/f*10)/10)}function Ur(s){return{slower:It(s,Pr),normal:It(s,Fr),faster:It(s,zr)}}function ve(s){const f=Math.round(s*60),h=Math.floor(f/60),d=f%60;return d===0?`${h}m`:`${h}m ${d}s`}function Ir(s){const f=(s??"").trim().split(":"),h=Math.max(0,parseInt(f[0],10)||0),d=Math.max(0,parseInt(f[1],10)||0);return`${String(h).padStart(2,"0")}:${String(d).padStart(2,"0")}`}function Lr(s){const f=s.split(/[.!?]+/).map(j=>j.trim()).filter(Boolean);if(f.length===0)return{avgWordsPerSentence:0,label:"â€”"};const d=s.trim().split(/\s+/).filter(Boolean).length/f.length;let i="Conversational";return d>25?i="Dense":d>18?i="Moderate":d<10&&(i="Very simple"),{avgWordsPerSentence:Math.round(d*10)/10,label:i}}const Dr=["actually","basically","just","really","very","so","literally","honestly","obviously","simply","clearly","quite","pretty","thing","things"];function Mr(s){const h=s.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(Boolean),d={},i=3;for(let g=0;g<=h.length-i;g++){const T=h.slice(g,g+i).join(" ");T.length<15||(d[T]=(d[T]??0)+1)}const j=Object.entries(d).filter(([,g])=>g>=2).map(([g,T])=>({phrase:g,count:T})).sort((g,T)=>T.count-g.count).slice(0,10),w={};h.forEach(g=>{Dr.includes(g)&&(w[g]=(w[g]??0)+1)});const N=Object.entries(w).filter(([,g])=>g>=2).map(([g,T])=>({word:g,count:T})).sort((g,T)=>T.count-g.count);return{repeatedPhrases:j,overused:N}}class qr extends c.Component{constructor(){super(...arguments);Xs(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(h){return{hasError:!0,error:h}}componentDidCatch(h,d){console.error("BlockNote editor error:",h,d.componentStack)}render(){return this.state.hasError&&this.state.error?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"min-h-[400px] rounded-md border border-destructive/50 bg-destructive/10 p-4 text-destructive",role:"alert",children:[e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[e.jsx(gr,{className:"h-4 w-4 shrink-0"}),"Editor failed to load"]}),e.jsx("p",{className:"mt-2 text-sm opacity-90",children:this.state.error.message}),e.jsxs("p",{className:"mt-2 text-xs opacity-75",children:["If you recently upgraded, try ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"npm install"})," and refresh. BlockNote 0.46+ is required for React 19."]})]}):this.props.children}}function Xr(s){const[f,h]=c.useState(null),[d,i]=c.useState(null);return c.useEffect(()=>{Yn(()=>import("./index-CMhZgqwr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49])).then(j=>h(()=>j.BlockNoteEditor)).catch(j=>i((j==null?void 0:j.message)??"Failed to load editor"))},[]),d?e.jsxs("div",{className:"min-h-[400px] rounded-md border border-destructive/50 bg-destructive/10 p-4 text-destructive",children:["Editor failed to load: ",d]}):f?e.jsx(f,{...s}):e.jsx("div",{className:"min-h-[60vh] bg-muted/20 animate-pulse","aria-label":"Editor loading"})}function Lt(s){function f(i){return typeof i=="string"?i:i.type==="text"&&typeof i.text=="string"?i.text:i.type==="link"&&Array.isArray(i.content)?i.content.map(f).join(""):""}const h=[],d=s.content;return Array.isArray(d)&&h.push(d.map(f).join("")),Array.isArray(s.children)&&s.children.length&&h.push(s.children.map(Lt).join(`
`)),h.filter(Boolean).join(`
`)}function Ks(s){return s.replace(/\s+/g," ").replace(/[\u201C\u201D\u201E\u201F\u2033"]/g,'"').replace(/[\u2018\u2019\u201A\u201B\u2032']/g,"'").trim()}function Vs(s,f){const h=Ks(f);if(!h)return null;const d=h.split(/\s+/).slice(0,15).join(" "),i=h.slice(0,100),j=[h];d.length<h.length&&j.push(d),i.length<h.length&&i.length>=20&&j.push(i);function w(N){for(const g of N){const T=Lt(g),k=Ks(T);for(const D of j)if(D.length>=10&&k.includes(D))return g;if(Array.isArray(g.children)){const D=w(g.children);if(D)return D}}return null}return w(s)}function te(s){return s!=null&&s.length?s.map(Lt).filter(Boolean).join(`

`):""}const ut=500,Pr=130,Fr=150,zr=170,$r=[{id:"review",name:"Review",content:[{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Hook (first 30 sec)"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Intro"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Main review"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Verdict & CTA"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]}]},{id:"tutorial",name:"Tutorial",content:[{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Hook (first 30 sec)"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"What we'll cover"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Step 1"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Step 2"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Step 3"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Outro & subscribe"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]}]},{id:"listicle",name:"Listicle",content:[{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Hook (first 30 sec)"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Intro"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Point 1"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Point 2"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Point 3"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Outro & subscribe"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]}]},{id:"story",name:"Story / Vlog",content:[{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Hook (first 30 sec)"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Setup"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Story"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]},{id:crypto.randomUUID(),type:"heading",content:[{type:"text",text:"Takeaway & CTA"}],props:{level:2}},{id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:""}]}]}],Hr=[{id:"emotional",label:"Emotional",description:"Appeal to feelings"},{id:"urgency",label:"Urgency",description:"Create FOMO, act now"},{id:"curiosity",label:"Curiosity",description:"Tease without giving away"},{id:"how-to",label:"How-to",description:"Clear, instructional"},{id:"listicle",label:"Listicle",description:"Numbers and lists"},{id:"question",label:"Question",description:"Pose a question"},{id:"provocative",label:"Provocative",description:"Bold or controversial"}],Gs=[{id:"hook",label:"Hook in first 15 sec",checked:!1},{id:"main",label:"3 main points",checked:!1},{id:"cta",label:"Clear CTA",checked:!1},{id:"outro",label:"Outro / subscribe ask",checked:!1}];function Br({tenantRouter:s,onAdded:f}){const[h,d]=c.useState(""),[i,j]=c.useState(""),[w,N]=c.useState(!1),g=async T=>{var D;if(T.preventDefault(),!h.trim()||!i.trim())return;N(!0);const k=((D=document.querySelector('meta[name="csrf-token"]'))==null?void 0:D.content)??"";try{const v=await fetch(s.route("script.snippets.store"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":k,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({title:h.trim(),body:i.trim()})}),M=await v.json().catch(()=>({}));v.ok&&M.snippet?(f(M.snippet),d(""),j(""),y.success("Snippet saved")):y.error(M.message??"Failed to save")}catch{y.error("Failed to save")}finally{N(!1)}};return e.jsxs("form",{onSubmit:g,className:"flex flex-col gap-2",children:[e.jsx(H,{value:h,onChange:T=>d(T.target.value),placeholder:"Title",className:"h-9"}),e.jsx(mt,{value:i,onChange:T=>j(T.target.value),placeholder:"Body",rows:2,className:"resize-y text-sm"}),e.jsx(u,{type:"submit",size:"sm",disabled:w||!h.trim()||!i.trim(),children:w?"Savingâ€¦":"Add snippet"})]})}function Wr(){const f=[{title:"Scripts",href:Ys().route("script.index")},{title:"Loadingâ€¦",href:"#"}];return e.jsxs(Js,{breadcrumbs:f,children:[e.jsx(Ss,{title:"Loading scriptâ€¦"}),e.jsxs("div",{className:"w-full py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(U,{className:"h-9 w-9 shrink-0 rounded-md"}),e.jsx(U,{className:"h-9 min-w-[200px] max-w-2xl flex-1"}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx(U,{className:"h-9 w-20 rounded-md"}),e.jsx(U,{className:"h-9 w-9 rounded-md"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-10"}),e.jsx(U,{className:"h-9 w-[180px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-20"}),e.jsx(U,{className:"h-9 w-[190px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-12"}),e.jsx(U,{className:"h-9 w-[150px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-16"}),e.jsx(U,{className:"h-9 w-[160px]"})]})]})]}),e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx(U,{className:"h-9 w-40 rounded-md"}),e.jsx(U,{className:"h-9 w-28 rounded-md"})]}),e.jsx(U,{className:"min-h-[60vh] w-full rounded-lg","aria-hidden":"true"})]})]})}const Kr=45e3;function ca({script:s,scriptTypes:f,hrTasks:h=[]}){var Rs,As,Os,Es,Us,Is,Ls,Ds,Ms,qs;const d=Ys(),i=s!=null,[j,w]=c.useState(!1),[N,g]=c.useState(!1),T=c.useRef(!1);T.current=j;const k=i&&(s==null?void 0:s.can_edit)===!1||i&&!!(s!=null&&s.can_edit)&&!j,D=!!(i&&(s!=null&&s.can_manage_access)),[v,M]=c.useState((Rs=s==null?void 0:s.content)!=null&&Rs.length?s.content:[]),[we,se]=c.useState((s==null?void 0:s.title)??""),[Te,xe]=c.useState((s==null?void 0:s.thumbnail_text)??null),[ne,Dt]=c.useState((s==null?void 0:s.script_type_id)!=null?String(s.script_type_id):null),ht=t=>t==="writing"||t==="completed"||t==="published"?t:t==="in_review"?"writing":t==="archived"?"completed":"draft",[re,Mt]=c.useState(()=>ht(s==null?void 0:s.status)),[Ie,qt]=c.useState((s==null?void 0:s.production_status)??"not_shot"),[B,Le]=c.useState(()=>{const t=s==null?void 0:s.scheduled_at;if(!t)return"";try{const n=new Date(t);if(Number.isNaN(n.getTime()))return"";const r=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),l=String(n.getDate()).padStart(2,"0"),a=String(n.getHours()).padStart(2,"0"),m=String(n.getMinutes()).padStart(2,"0");return`${r}-${o}-${l}T${a}:${m}`}catch{return""}}),[pe,W]=c.useState((As=s==null?void 0:s.title_options)!=null&&As.length?s.title_options:[]),[Xt,xt]=c.useState([]),[De,Qs]=c.useState([]),[Zs,Pt]=c.useState(!1),[fe,pt]=c.useState(!1),[en,Ft]=c.useState(!1),[Me,ke]=c.useState(null),[oe,ge]=c.useState({title:"",thumbnailText:""}),[qe,ft]=c.useState(!1),[ae,Xe]=c.useState({title:"",thumbnailText:""}),[Pe,zt]=c.useState(()=>{var t;return(t=s==null?void 0:s.checklist)!=null&&t.length?s.checklist:Gs.map(n=>({...n}))}),[tn,$t]=c.useState(!1),[sn,Ht]=c.useState(!1),[nn,Fe]=c.useState(!1),[$,Bt]=c.useState(!1),[I,ze]=c.useState(null),[rn,gt]=c.useState([]),[on,Wt]=c.useState(!1),[yt,jt]=c.useState(!1),[an,Kt]=c.useState(!1),[ln,$e]=c.useState(!1),[He,bt]=c.useState(""),[_e,Vt]=c.useState(!1),[Gt,St]=c.useState(!1),[K,Jt]=c.useState(null),Nt=c.useRef(null),[Yt,Be]=c.useState(null),[cn,vt]=c.useState(!1),[C,Ce]=c.useState(s!=null&&s.description||s!=null&&s.meta_tags?{descriptionBlock:(s==null?void 0:s.description)??"",metaTags:(s==null?void 0:s.meta_tags)??""}:null),[We,wt]=c.useState(!1),[Qt,Ke]=c.useState(null),[Vr,Gr]=c.useState(!1),[le,V]=c.useState("idle"),[Tt,Zt]=c.useState(!1),[p,G]=c.useState(null),[kt,es]=c.useState(!1),[Ve,Ge]=c.useState(!1),[_t,ts]=c.useState(""),[ss,ns]=c.useState(""),[rs,os]=c.useState("view"),[Se,as]=c.useState(!1),[ls,Je]=c.useState(null),[Ye,Ct]=c.useState((s==null?void 0:s.co_authors)??[]),[Rt,cs]=c.useState(!1),[dn,ds]=c.useState(null),[ye,is]=c.useState(""),[us,un]=c.useState(!1),[je,At]=c.useState((s==null?void 0:s.thumbnails)??[]),[mn,ms]=c.useState(!1),[Qe,hs]=c.useState(!1),xs=c.useRef(null),[hn,ps]=c.useState(!1),[be,fs]=c.useState(!1),[L,gs]=c.useState((s==null?void 0:s.reel_captions)??null),ys=c.useRef(!1),Ze=c.useRef(Date.now()+Ar),ce=c.useRef(null),Ne=c.useRef(!1),xn=c.useMemo(()=>$||_e||be||fe||We||!!K||kt||Ve||Se||Qe||yt||le==="saving",[$,_e,be,fe,We,K,kt,Ve,Se,Qe,yt,le]),et=c.useRef({content:v,pageTitle:we,mainThumbnailText:Te,scriptTypeId:ne,descriptionData:C,titleOptions:pe,workflowStatus:re,scheduledAt:B,productionStatus:Ie,checklist:Pe});et.current={content:v,pageTitle:we,mainThumbnailText:Te,scriptTypeId:ne,descriptionData:C,titleOptions:pe,workflowStatus:re,scheduledAt:B,productionStatus:Ie,checklist:Pe},c.useEffect(()=>{var t,n,r;if(s!=null&&typeof s=="object"&&!ys.current){if(ys.current=!0,M((t=s.content)!=null&&t.length?s.content:[]),se(s.title??""),xe(s.thumbnail_text??null),Dt(s.script_type_id!=null?String(s.script_type_id):null),Mt(ht(s.status)),qt(s.production_status??"not_shot"),s.scheduled_at)try{const o=new Date(s.scheduled_at);if(!Number.isNaN(o.getTime())){const l=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),m=String(o.getDate()).padStart(2,"0"),x=String(o.getHours()).padStart(2,"0"),b=String(o.getMinutes()).padStart(2,"0");Le(`${l}-${a}-${m}T${x}:${b}`)}}catch{Le("")}else Le("");W((n=s.title_options)!=null&&n.length?s.title_options:[]),Ce(s.description||s.meta_tags?{descriptionBlock:s.description??"",metaTags:s.meta_tags??""}:null),At(s.thumbnails??[]),gs(s.reel_captions??null),zt((r=s.checklist)!=null&&r.length?s.checklist:Gs.map(o=>({...o})))}},[s]),c.useEffect(()=>{var r;if(!i||!(s!=null&&s.can_edit)||!(s!=null&&s.uuid)||!d)return;const t=d.route("script.lock.acquire",{script:s.uuid}),n=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)??"";g(!0),fetch(t,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"}}).then(o=>o.json().catch(()=>({}))).then(o=>{w(!!o.acquired)}).finally(()=>g(!1))},[i,s==null?void 0:s.can_edit,s==null?void 0:s.uuid]),c.useEffect(()=>{if(!i||!(s!=null&&s.uuid)||!d)return;const t=()=>{var a;if(!T.current)return;const o=d.route("script.lock.release",{script:s.uuid}),l=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)??"";fetch(o,{method:"DELETE",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},keepalive:!0}).catch(()=>{})},n=Oe.on("before",()=>{t()}),r=()=>{t()};return window.addEventListener("beforeunload",r),()=>{n(),window.removeEventListener("beforeunload",r)}},[i,s==null?void 0:s.uuid]),c.useEffect(()=>{var l;if(!i||!(s!=null&&s.uuid)||!d||!(s!=null&&s.current_user_id))return;const t=d.route("script.lock.show",{script:s.uuid}),n=((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)??"",r=s.current_user_id,o=setInterval(()=>{T.current&&fetch(t,{headers:{Accept:"application/json","X-CSRF-TOKEN":n}}).then(a=>a.json().catch(()=>({}))).then(a=>{a.locked&&a.locked_by&&a.locked_by.user_id!==r&&(w(!1),y.info("Someone else is now editing this script. You are in view-only mode."))}).catch(()=>{})},Kr);return()=>clearInterval(o)},[i,s==null?void 0:s.uuid,s==null?void 0:s.current_user_id]);const pn=t=>{M(t)},fn={"Shorten this.":"shorten","Expand this.":"expand","Make it more casual.":"casual","Add an example.":"add_example"},gn=async(t,n)=>{var a;const r=fn[n],o=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)??"",l=r?d.route("script.ai-script-action"):d.route("script.ai-edit-selection");try{const m=r?{action:r,content:t}:{content:te(v)||"",selected_text:t,instruction:n},x=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(m)}),b=await x.json().catch(()=>({}));if(!x.ok)return y.error(b.message??"AI edit failed"),null;const _=r?b.text:b.rewritten;return typeof _=="string"?_:null}catch(m){return y.error(m instanceof Error?m.message:"AI edit failed"),null}},Ot=async(t,n)=>{var l;Jt(t);const r=te(v)||"",o=((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)??"";try{const a={action:t};n.selectedText&&(a.content=n.selectedText),["intro","outro","hook"].includes(t)?a.full_script=r:n.selectedText&&(a.content=n.selectedText);const m=await fetch(d.route("script.ai-script-action"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),x=await m.json().catch(()=>({}));if(!m.ok)return y.error(x.message??"AI action failed"),null;const b=typeof x.text=="string"?x.text:null;if(b&&n.insertAt){const _=b.split(/\n\n+/).map(F=>F.trim()).filter(Boolean),A=_.length>0?_.map(F=>({type:"paragraph",content:F})):[{type:"paragraph",content:b}],E=Nt.current;if(E!=null&&E.document&&(E.insertBlocks||E.replaceBlocks))try{const F=E.document;F.length>0?n.insertAt==="top"?E.insertBlocks(A,F[0],"before"):E.insertBlocks(A,F[F.length-1],"after"):E.replaceBlocks([],A)}catch(F){console.warn("Editor insert failed, falling back to setContent",F),n.insertAt==="top"?M([...A,...v]):M([...v,...A])}else n.insertAt==="top"?M([...A,...v]):M([...v,...A])}return b}catch(a){return y.error(a instanceof Error?a.message:"AI action failed"),null}finally{Jt(null)}},yn=t=>{Qs(n=>n.includes(t)?n.filter(r=>r!==t):[...n,t])},js=async t=>{var a;const n=t??De;if(n.length===0)return;Pt(!1),pt(!0),Be(null);const r=te(v),o=d.route("script.generate-title-ideas"),l=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)??"";try{const m=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:r||"(No content yet â€” add some in the editor below.)",styles:n})}),x=await m.json().catch(()=>({}));if(!m.ok){Be(x.message??"Failed to generate ideas."),pt(!1);return}const _=(Array.isArray(x.titles)?x.titles:[]).map(A=>({id:crypto.randomUUID(),text:typeof A.title=="string"?A.title:"",thumbnailText:typeof A.thumbnailText=="string"?A.thumbnailText:void 0}));W(A=>[...A,..._.map(E=>({id:void 0,title:E.text,thumbnail_text:E.thumbnailText??null,is_primary:!1}))]),Ft(!0)}catch{Be("Network or server error. Please try again.")}finally{pt(!1)}},bs=async()=>{var t;if(s!=null&&s.uuid){fs(!0);try{const n=`/${d.tenant.slug}/script/${s.uuid}/generate-reel-captions`,r=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)??"",o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"}}),l=await o.json().catch(()=>({}));if(!o.ok){y.error(l.message??"Could not generate captions.");return}gs({generated_at:l.generated_at??"",options:l.options??[]})}catch{y.error("Network error. Try again.")}finally{fs(!1)}}},jn=t=>{se(t.text),xe(t.thumbnailText??null),W(n=>[...n.filter(o=>!(o.title===t.text&&(o.thumbnail_text??null)===(t.thumbnailText??null))).map(o=>({...o,is_primary:!1})),{id:void 0,title:t.text,thumbnail_text:t.thumbnailText??null,is_primary:!0}]),xt(n=>n.filter(r=>r.id!==t.id))},bn=t=>{W(n=>{if(n.some(l=>l.title===t.text&&(l.thumbnail_text??null)===(t.thumbnailText??null)))return n;const o=n.length===0;return o&&(se(t.text),xe(t.thumbnailText??null)),[...n.map(l=>({...l,is_primary:!1})),{id:void 0,title:t.text,thumbnail_text:t.thumbnailText??null,is_primary:o}]})},Nn=()=>{const t=ae.title.trim();t&&(W(n=>{var a,m;if(n.some(x=>{var b;return x.title===t&&(x.thumbnail_text??null)===(((b=ae.thumbnailText)==null?void 0:b.trim())??null)}))return n;const o=n.length===0;o&&(se(t),xe(((a=ae.thumbnailText)==null?void 0:a.trim())??null));const l=((m=ae.thumbnailText)==null?void 0:m.trim())||null;return[...n.map(x=>({...x,is_primary:!1})),{id:void 0,title:t,thumbnail_text:l,is_primary:o}]}),Xe({title:"",thumbnailText:""}),ft(!1))},vn=t=>{xt(n=>n.filter(r=>r.id!==t))},wn=t=>{se(t.title),xe(t.thumbnail_text??null),W(n=>n.map(r=>({...r,is_primary:r.id!=null&&t.id!=null&&r.id===t.id||r.id==null&&t.id==null&&r.title===t.title})))},Tn=t=>{W(n=>{const r=n.filter(o=>o.id!=null&&t.id!=null?o.id!==t.id:o.title!==t.title);return r.length>0&&!r.some(o=>o.is_primary)?r.map((o,l)=>({...o,is_primary:l===0})):r}),ke(null)},kn=(t,n)=>{ke(`opt-${n}`),ge({title:t.title,thumbnailText:t.thumbnail_text??""})},_n=t=>{ke(`sug-${t.id}`),ge({title:t.text,thumbnailText:t.thumbnailText??""})},Ns=()=>{if(!Me)return;const[t,n]=Me.split("-"),r=oe.title.trim()||oe.title,o=oe.thumbnailText.trim()||null;if(t==="sug")xt(l=>l.map(a=>a.id===n?{...a,text:r||a.text,thumbnailText:o??void 0}:a));else{const l=parseInt(n,10);if(Number.isNaN(l))return;W(a=>a.map((x,b)=>{if(b!==l)return x;const _={...x,title:r||x.title,thumbnail_text:o??x.thumbnail_text};return x.is_primary&&(se(_.title),xe(_.thumbnail_text??null)),_}))}ke(null)},vs=()=>{ke(null)},Cn=async t=>{var a,m;const n=(a=t.target.files)==null?void 0:a[0];if(!n||!s||!d)return;hs(!0);const r=d.route("script.thumbnails.store",{script:s.uuid}),o=((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.content)??"",l=new FormData;l.append("file",n);try{const x=await fetch(r,{method:"POST",headers:{"X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:l}),b=await x.json().catch(()=>({}));x.ok&&b.thumbnail?At(_=>[..._,b.thumbnail]):y.error(b.message??"Upload failed.")}catch{y.error("Upload failed.")}finally{hs(!1),t.target.value=""}},Rn=async t=>{var o;if(!s||!d)return;const n=d.route("script.thumbnails.destroy",{script:s.uuid,thumbnail:t.id}),r=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"";try{const l=await fetch(n,{method:"DELETE",headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(l.ok)At(a=>a.filter(m=>m.id!==t.id));else{const a=await l.json().catch(()=>({}));y.error(a.message??"Delete failed.")}}catch{y.error("Delete failed.")}},de=c.useMemo(()=>{const t=r=>pe.some(o=>o.title===r.text&&(o.thumbnail_text??null)===(r.thumbnailText??null)),n=Xt.filter(r=>!t(r));return[...pe.map((r,o)=>({kind:"option",option:r,index:o})),...n.map(r=>({kind:"suggestion",suggestion:r}))]},[pe,Xt]);de.length>0;const Re=c.useMemo(()=>Or(v),[v]),S=c.useMemo(()=>Ur(Re),[Re]),ws=c.useMemo(()=>Er(v),[v]),tt=c.useMemo(()=>te(v),[v]),Ts=c.useMemo(()=>Lr(tt),[tt]),st=c.useMemo(()=>Mr(tt),[tt]),An=()=>{var r,o,l;const t=et.current,n=t.titleOptions.length>0?t.titleOptions.map(a=>({id:a.id,title:a.is_primary&&t.pageTitle.trim()||a.title,thumbnail_text:a.is_primary?t.mainThumbnailText:a.thumbnail_text,is_primary:a.is_primary})):[];return n.length===0&&t.pageTitle.trim()&&n.push({title:t.pageTitle.trim(),thumbnail_text:t.mainThumbnailText??null,is_primary:!0}),{title:t.pageTitle.trim()||"Untitled script",thumbnail_text:t.mainThumbnailText??null,script_type_id:t.scriptTypeId?Number(t.scriptTypeId):null,content:t.content,description:((r=t.descriptionData)==null?void 0:r.descriptionBlock)??null,meta_tags:((o=t.descriptionData)==null?void 0:o.metaTags)??null,status:t.workflowStatus,scheduled_at:(l=t.scheduledAt)!=null&&l.trim()?t.scheduledAt.trim():null,production_status:t.productionStatus,title_options:n,custom_attributes:{checklist:t.checklist}}},nt=async()=>{var n;if(!s||!d||Ne.current)return;Ne.current=!0,V("saving");const t=An();try{const r=await fetch(d.route("script.update",{script:s.uuid}),{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-XSRF-TOKEN":decodeURIComponent(((n=document.cookie.match(/XSRF-TOKEN=([^;]+)/))==null?void 0:n[1])??"")},body:JSON.stringify(t)});r.ok?(V("saved"),setTimeout(()=>V("idle"),2e3)):(r.status===423&&(w(!1),y.error("Script is being edited by someone else. Your changes were not saved.")),V("idle"))}catch{V("idle")}finally{Ne.current=!1}},On=async()=>{var r,o,l,a;if(i||!d||Ne.current)return;Ne.current=!0,V("saving");const t=et.current,n=t.pageTitle.trim()?[{title:t.pageTitle.trim(),thumbnail_text:t.mainThumbnailText??null,is_primary:!0}]:[];try{const m=await fetch(d.route("script.store"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-XSRF-TOKEN":decodeURIComponent(((r=document.cookie.match(/XSRF-TOKEN=([^;]+)/))==null?void 0:r[1])??"")},body:JSON.stringify({title:t.pageTitle.trim()||"Untitled script",thumbnail_text:t.mainThumbnailText??null,script_type_id:t.scriptTypeId?Number(t.scriptTypeId):null,content:t.content,description:((o=t.descriptionData)==null?void 0:o.descriptionBlock)??null,meta_tags:((l=t.descriptionData)==null?void 0:l.metaTags)??null,status:t.workflowStatus,scheduled_at:(a=t.scheduledAt)!=null&&a.trim()?t.scheduledAt.trim():null,production_status:t.productionStatus,title_options:n,custom_attributes:{checklist:t.checklist}})});if(m.ok){const x=await m.json().catch(()=>null);if(x!=null&&x.redirect_url)Oe.visit(x.redirect_url,{preserveScroll:!1});else{const b=m.headers.get("X-Inertia-Location")||m.url;b&&b!==window.location.href&&Oe.visit(b,{preserveScroll:!1})}}V("idle")}catch{V("idle")}finally{Ne.current=!1}};c.useEffect(()=>{if(!k&&!(Date.now()<Ze.current))return ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{var t,n;if(ce.current=null,i&&s)nt();else if(!i){const r=et.current;((((t=r.pageTitle)==null?void 0:t.trim())??"")!==""||(((n=r.content)==null?void 0:n.length)??0)>0)&&On()}},Rr),()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)}},[v,we,Te,ne,C,pe,re,B,Ie,Pe,i,s==null?void 0:s.id,k]);const R=c.useRef(null),ks=c.useRef((s==null?void 0:s.script_type_id)!=null?String(s.script_type_id):null);c.useEffect(()=>{if(!(k||!i||!s)&&ne!==ks.current)return ks.current=ne,R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{R.current=null,Date.now()>=Ze.current&&nt()},400),()=>{R.current&&(clearTimeout(R.current),R.current=null)}},[ne,i,s,k]);const _s=c.useRef(ht(s==null?void 0:s.status));c.useEffect(()=>{if(!(k||!i||!s)&&re!==_s.current)return _s.current=re,R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{R.current=null,Date.now()>=Ze.current&&nt()},400),()=>{R.current&&(clearTimeout(R.current),R.current=null)}},[re,i,s,k]);const rt=c.useRef(null);c.useEffect(()=>{if(k||!i||!s)return;const t=(B==null?void 0:B.trim())??"";if(rt.current===null){rt.current=t;return}if(t!==rt.current)return rt.current=t,R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{R.current=null,Date.now()>=Ze.current&&nt()},400),()=>{R.current&&(clearTimeout(R.current),R.current=null)}},[B,i,s,k]);const En=()=>{!s||!window.confirm("Delete this script? This cannot be undone.")||Oe.delete(d.route("script.destroy",{script:s.uuid}),{preserveScroll:!1})},Un=async()=>{var o;wt(!0),Ke(null);const t=te(v),n=d.route("script.generate-description-assets"),r=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"";try{const l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:t||"(No content yet â€” add some in the editor below.)"})}),a=await l.json().catch(()=>({}));if(!l.ok){Ke(a.message??"Failed to generate."),wt(!1);return}const m=typeof a.shortDescription=="string"?a.shortDescription:"",x=Array.isArray(a.timestamps)?a.timestamps.map(_=>({time:typeof _.time=="string"?_.time:"",label:typeof _.label=="string"?_.label:""})):[],b=[m.trim(),"","::::::::::::::: ðŸŽ¬ Related Videos :::::::::::::::","video 1 - ","video 2 - ","video 3 - ","","::::::::::::::: â° Timestamps :::::::::::::::"];for(const _ of x){const A=Ir(_.time??""),E=(_.label??"").trim();b.push(E?`${A} - ${E}`:A)}Ce({descriptionBlock:b.join(`
`),metaTags:typeof a.metaTags=="string"?a.metaTags:""}),vt(!0)}catch{Ke("Network or server error. Please try again.")}finally{wt(!1)}},ot=(t,n="Copied!")=>{navigator.clipboard.writeText(t).then(()=>y.success(n)).catch(()=>{})},In=t=>{if(t==="retention")return s==null?void 0:s.analysis_retention;if(t==="cta")return s==null?void 0:s.analysis_cta;if(t==="storytelling")return s==null?void 0:s.analysis_storytelling},Ae=async(t,n=!1)=>{var o;if(Ht(!1),t==="readability"){const l=["## Readability",`${Ts.label} (avg ${Ts.avgWordsPerSentence} words/sentence).`,"","## Repeated phrases (3+ words)",st.repeatedPhrases.length===0?"None detected.":st.repeatedPhrases.slice(0,10).map(a=>`- "${a.phrase}" (${a.count}Ã—)`).join(`
`),"","## Overused words",st.overused.length===0?"None detected.":st.overused.slice(0,12).map(a=>`- ${a.word} (${a.count}Ã—)`).join(`
`)].join(`
`);ze({type:"readability",analysis:l,suggestions:[]}),Fe(!0);return}const r=In(t);if(!n&&(r!=null&&r.analysis)){ze({type:t,analysis:r.analysis,suggestions:Array.isArray(r.suggestions)?r.suggestions:[]}),Fe(!0);return}Bt(!0),ze(null);try{const l=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"",a=await fetch(d.route("script.analyze"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({type:t,content:te(v)||""})}),m=await a.json().catch(()=>({}));if(!a.ok){y.error(m.message??"Analysis failed.");return}const x={type:t,analysis:m.analysis??"",suggestions:Array.isArray(m.suggestions)?m.suggestions:[]};if(ze(x),Fe(!0),s!=null&&s.uuid&&(t==="retention"||t==="cta"||t==="storytelling")){const b=`/${d.tenant.slug}/script/${s.uuid}/analysis-${t}`;try{(await fetch(b,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({analysis:x.analysis,suggestions:x.suggestions})})).ok||y.error("Analysis could not be saved for next time.")}catch{y.error("Analysis could not be saved for next time.")}}}catch(l){console.error("Analysis request failed",l),y.error("Network error. Please try again.")}finally{Bt(!1)}},Ln=t=>{var l;const n=Nt.current;if(!((l=n==null?void 0:n.document)!=null&&l.length)){y.error("Editor not ready. Focus the script and try again.");return}let r=Vs(n.document,t.originalSnippet);if(!r&&v.length>0&&(r=Vs(v,t.originalSnippet)),!r){y.error("Could not find that section in the script. The text may have been edited or the suggestion quote does not match exactly.");return}const o={id:`suggestion-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:"paragraph",content:[{type:"text",text:t.suggestedText}]};n.insertBlocks([o],r,"before"),y.success("Suggested version added above the original. Compare and edit as needed.")},Dn=async()=>{var n;const t=te(v)||"";if(!t.trim()){y.error("Add some script content first.");return}Vt(!0),bt("");try{const r=`/${d.tenant.slug}/script/generate-short`,o=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)??"",l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:t})}),a=await l.json().catch(()=>({}));if(!l.ok){y.error(a.message??"Could not generate short.");return}bt(a.short_script??""),$e(!0)}catch{y.error("Network error. Try again.")}finally{Vt(!1)}},Mn=async()=>{var t,n;if(!He.trim()){y.error("Nothing to save.");return}St(!0);try{const r=d.route("script.transcripts.create-script"),o=((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)??"",l=(((n=s==null?void 0:s.title)==null?void 0:n.trim())||"Script")+" SHORT",a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({title:l,content:He.trim()})}),m=await a.json().catch(()=>({}));if(!a.ok){y.error(m.message??"Failed to create script.");return}const x=m.edit_url;x?(y.success("Short script created. Openingâ€¦"),Oe.visit(x)):(y.success("Short script created."),$e(!1))}catch{y.error("Could not create script. Try again.")}finally{St(!1)}},Cs=async t=>{var o;if(!s)return;const n=d.route("script.export",{script:s.uuid,format:t}),r=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"";try{const l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:t==="csv"?"text/csv":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:v})});if(!l.ok){y.error("Failed to export script.");return}const a=await l.blob(),m=URL.createObjectURL(a),x=document.createElement("a");x.href=m,x.download=`script-${s.uuid}.${t}`,x.click(),URL.revokeObjectURL(m)}catch{y.error("Network error while exporting.")}},qn=async()=>{if(s){es(!0);try{const t=d.route("script.share",{script:s.uuid}),n=await fetch(t,{headers:{Accept:"application/json"}}),r=await n.json();n.ok&&G(r)}finally{es(!1)}}};c.useEffect(()=>{Tt&&s&&D&&qn()},[Tt,s==null?void 0:s.id,D]),c.useEffect(()=>{s!=null&&s.co_authors&&Ct(s.co_authors)},[s==null?void 0:s.co_authors]);const Xn=async()=>{var n;if(!s)return;Ge(!0);const t=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)??"";try{const r=d.route("script.publish",{script:s.uuid}),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}}),l=await o.json();o.ok&&l.public_url&&G(a=>a?{...a,visibility:"published",public_url:l.public_url,share_token:l.share_token}:null)}finally{Ge(!1)}},Pn=async()=>{var n;if(!s)return;Ge(!0);const t=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)??"";try{const r=d.route("script.unpublish",{script:s.uuid});await fetch(r,{method:"POST",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}}),G(o=>o?{...o,visibility:"private",public_url:null}:null)}finally{Ge(!1)}},Fn=async()=>{var n;if(!s||!_t.trim())return;as(!0),Je(null);const t=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)??"";try{const r=d.route("script.collaborators.store",{script:s.uuid}),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:_t.trim(),role:rs})}),l=await o.json();o.ok&&l.collaborator?(G(a=>a?{...a,collaborators:[...a.collaborators||[],l.collaborator]}:null),ts(""),ns(""),os("view")):Je(l.message||"Failed to invite.")}finally{as(!1)}},zn=async t=>{var o;if(!s)return;const n=d.route("script.collaborators.destroy",{script:s.uuid,user:t}),r=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"";await fetch(n,{method:"DELETE",headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"}}),G(l=>l?{...l,collaborators:(l.collaborators||[]).filter(a=>a.user_id!==t)}:null)},$n=async(t,n)=>{var l;if(!s)return;const r=d.route("script.collaborators.update",{script:s.uuid,user:t}),o=((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)??"";await fetch(r,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({role:n})}),G(a=>a&&{...a,collaborators:(a.collaborators||[]).map(m=>m.user_id===t?{...m,role:n}:m)})},Hn=()=>{p!=null&&p.public_url&&(navigator.clipboard.writeText(p.public_url),y.success("Link copied to clipboard"))},Bn=async t=>{var a;if(!s)return;Je(null);const n=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)??"",r=d.route("script.collaborators.store",{script:s.uuid}),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:t,role:"view"})}),l=await o.json();o.ok&&l.collaborator&&G(m=>m?{...m,collaborators:[...m.collaborators||[],l.collaborator],access_denied_user_ids:(m.access_denied_user_ids||[]).filter(x=>x!==l.collaborator.user_id)}:null)},Wn=async(t,n)=>{var o;if(!s)return;cs(!0);const r=((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)??"";try{const l=d.route("script.co-authors.store",{script:s.uuid}),a=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({user_id:t,add_as_collaborator:n})}),m=await a.json();a.ok&&m.co_author&&(Ct(x=>[...x,m.co_author]),m.co_author&&n&&p&&G(x=>x?{...x,collaborators:[...x.collaborators||[],{user_id:m.co_author.user_id,name:m.co_author.name,email:m.co_author.email,role:"edit"}],access_denied_user_ids:(x.access_denied_user_ids||[]).filter(b=>b!==m.co_author.user_id)}:null))}finally{cs(!1)}},Kn=async t=>{var r;if(!s)return;ds(t);const n=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)??"";try{const o=d.route("script.co-authors.destroy",{script:s.uuid,user:t});await fetch(o,{method:"DELETE",headers:{"X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"}}),Ct(l=>l.filter(a=>a.user_id!==t))}finally{ds(null)}};if(s===void 0)return e.jsx(Wr,{});const Vn=[{title:"Scripts",href:d.route("script.index")},{title:i?(s==null?void 0:s.title)||"Edit script":"New script",href:"#"}];return e.jsxs(Js,{breadcrumbs:Vn,children:[e.jsx(Ss,{title:we||(i?"Edit script":"New script")}),xn&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[100] h-1 overflow-hidden bg-primary/20",role:"progressbar","aria-label":"Loading",children:e.jsx("div",{className:"h-full w-[40%] animate-[script-loading-bar_1.5s_ease-in-out_infinite] bg-primary"})}),e.jsxs("div",{className:"w-full py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(u,{variant:"outline",size:"icon",asChild:!0,children:e.jsx(Jn,{href:d.route("script.index"),children:e.jsx(dr,{className:"h-4 w-4"})})}),e.jsx(H,{value:we,onChange:t=>se(t.target.value),placeholder:"Untitled script",disabled:k,className:"min-w-[200px] max-w-2xl flex-1 border-0 bg-transparent text-2xl font-semibold shadow-none placeholder:text-muted-foreground focus-visible:ring-0 md:text-3xl disabled:opacity-80"}),e.jsxs("div",{className:"ml-auto flex shrink-0 items-center gap-2",children:[e.jsxs("span",{className:"text-muted-foreground text-xs tabular-nums",children:[Re.toLocaleString()," ",Re===1?"word":"words",Re>0&&e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsxs("span",{className:"ml-1.5 cursor-default",children:["Â· ~",S.faster===S.slower?ve(S.normal):`${ve(S.faster)}â€“${ve(S.slower)}`]})}),e.jsxs(P,{side:"bottom",children:["Faster: ~",ve(S.faster)," Â· Normal: ~",ve(S.normal)," Â· Slower: ~",ve(S.slower)]})]}),(i&&le!=="idle"||!i&&le==="saving")&&e.jsx("span",{className:"mx-1",children:"Â·"}),i&&le!=="idle"&&(le==="saving"?"Savingâ€¦":"Saved"),!i&&le==="saving"&&"Savingâ€¦"]}),D&&e.jsxs(u,{type:"button",variant:"outline",size:"sm",className:"shrink-0",onClick:()=>Zt(!0),children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),"Share"]}),!k&&e.jsxs(Zn,{children:[e.jsx(er,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",children:e.jsx(ir,{className:"h-4 w-4"})})}),e.jsxs(tr,{align:"end",children:[e.jsxs(Et,{onClick:()=>Cs("json"),children:[e.jsx(zs,{className:"mr-2 h-4 w-4"}),"Export JSON"]}),e.jsxs(Et,{onClick:()=>Cs("csv"),children:[e.jsx(zs,{className:"mr-2 h-4 w-4"}),"Export CSV"]}),i&&(s==null?void 0:s.can_delete)&&e.jsxs(e.Fragment,{children:[e.jsx(sr,{}),e.jsxs(Et,{onClick:En,className:"text-destructive focus:text-destructive",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Delete script"]})]})]})]})]})]}),i&&((s==null?void 0:s.author)||(s==null?void 0:s.co_authors)&&s.co_authors.length>0||(s==null?void 0:s.last_edited_by))&&e.jsxs("div",{className:"text-muted-foreground flex flex-wrap items-center gap-x-4 gap-y-1 text-sm",children:[(s==null?void 0:s.author)&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Author:"})," ",s.author.name]}),(s==null?void 0:s.co_authors)&&s.co_authors.length>0&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Co-authors:"})," ",s.co_authors.map(t=>t.name).join(", ")]}),(s==null?void 0:s.last_edited_by)&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Last edited by:"})," ",s.last_edited_by.name,(s==null?void 0:s.updated_at)&&e.jsxs("span",{className:"ml-1",children:["(",new Date(s.updated_at).toLocaleDateString(void 0,{dateStyle:"short"}),")"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[f.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-muted-foreground shrink-0 text-sm",children:"Type"}),e.jsxs(ie,{value:ne??"",onValueChange:Dt,disabled:k,children:[e.jsx(ue,{className:"w-[180px]",children:e.jsx(me,{placeholder:"Select type"})}),e.jsx(he,{children:f.map(t=>e.jsx(O,{value:String(t.id),children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-muted-foreground shrink-0 text-sm",children:"Scheduled for"}),e.jsx(H,{type:"datetime-local",value:B,onChange:t=>Le(t.target.value),disabled:k,className:"w-[190px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-muted-foreground shrink-0 text-sm",children:"Status"}),e.jsxs(ie,{value:re,onValueChange:t=>Mt(t),disabled:k,children:[e.jsx(ue,{className:"w-[150px]",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx(O,{value:"draft",children:"Draft"}),e.jsx(O,{value:"writing",children:"Writing"}),e.jsx(O,{value:"completed",children:"Completed"}),e.jsx(O,{value:"published",children:"Published"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-muted-foreground shrink-0 text-sm",children:"Production"}),e.jsxs(ie,{value:Ie,onValueChange:t=>qt(t),disabled:k,children:[e.jsx(ue,{className:"w-[160px]",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx(O,{value:"not_shot",children:"Not shot"}),e.jsx(O,{value:"shot",children:"Shot"}),e.jsx(O,{value:"editing",children:"Editing"}),e.jsx(O,{value:"edited",children:"Edited"})]})]})]})]}),h&&h.length>0&&e.jsxs("div",{className:"mt-3 rounded-md border bg-muted/30 p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-foreground",children:"HR tasks linked to this script"}),e.jsx("ul",{className:"space-y-1.5 text-sm",children:h.map(t=>e.jsxs("li",{className:"flex items-center justify-between gap-2",children:[e.jsx("a",{href:d.route("hr.tasks.show",{task:t.id}),target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:t.title}),e.jsxs("span",{className:"shrink-0 text-muted-foreground",children:[t.status,t.completed_at?` Â· Done ${new Date(t.completed_at).toLocaleDateString()}`:t.due_at?` Â· Due ${new Date(t.due_at).toLocaleDateString()}`:"",t.assignee?` Â· ${t.assignee}`:""]})]},t.id))})]})]}),!k&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsxs(at,{open:Zs,onOpenChange:t=>{Pt(t),t&&Be(null)},children:[e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(lt,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",disabled:fe,children:e.jsx(dt,{className:"h-4 w-4"})})})}),e.jsx(P,{side:"bottom",children:fe?"Generatingâ€¦":"Generate title ideas"})]}),e.jsx(ct,{className:"w-80",align:"start",side:"bottom",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium leading-none",children:"Choose title style"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"Pick one or more. Weâ€™ll use your script content to generate ideas."})]}),e.jsx("div",{className:"grid gap-2 py-2",children:Hr.map(t=>e.jsxs("label",{className:"flex cursor-pointer items-start gap-3 rounded-md border border-transparent px-2 py-1.5 hover:bg-muted/50 has-[:checked]:bg-muted/30",children:[e.jsx(Ps,{checked:De.includes(t.id),onCheckedChange:()=>yn(t.id)}),e.jsxs("div",{className:"grid gap-0.5 leading-none",children:[e.jsx("span",{className:"text-sm font-medium",children:t.label}),e.jsx("span",{className:"text-muted-foreground text-xs",children:t.description})]})]},t.id))}),e.jsx(u,{type:"button",size:"sm",className:"w-full",onClick:()=>js(),disabled:De.length===0,children:"Generate ideas"})]})})]}),e.jsxs(J,{open:en,onOpenChange:t=>{Ft(t),t&&de.length===0&&ft(!0)},children:[e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(Qn,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0 relative",children:[e.jsx(ur,{className:"h-4 w-4"}),de.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 flex h-4 min-w-4 items-center justify-center rounded-full bg-muted px-1 text-[10px] font-medium",children:de.length})]})})}),e.jsx(P,{side:"bottom",children:de.length>0?`Title ideas (${de.length})`:"View title ideas"})]}),e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0 relative",onClick:()=>ps(!0),children:[e.jsx(mr,{className:"h-4 w-4"}),(Os=L==null?void 0:L.options)!=null&&Os.length?e.jsx("span",{className:"absolute -top-0.5 -right-0.5 flex h-4 min-w-4 items-center justify-center rounded-full bg-muted px-1 text-[10px] font-medium",children:"3"}):null]})}),e.jsx(P,{side:"bottom",children:(Es=L==null?void 0:L.options)!=null&&Es.length?"Reel captions (3)":"Reel captions"})]}),e.jsxs(Y,{side:"right",className:"w-full sm:max-w-md",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Title ideas"}),e.jsx(ee,{children:"Checkmark sets one as the current title; the rest stay. Remove only the ones you donâ€™t want. Regenerate adds new ideas below. Edit with the pencil. Changes save with the script."}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsxs(u,{type:"button",variant:"outline",size:"sm",disabled:fe,onClick:()=>js(De.length>0?void 0:["curiosity"]),children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),fe?"Generatingâ€¦":"Regenerate"]}),e.jsxs(u,{type:"button",variant:qe?"secondary":"outline",size:"sm",onClick:()=>{ft(t=>!t),qe&&Xe({title:"",thumbnailText:""})},children:[e.jsx(Hs,{className:"mr-2 h-4 w-4"}),qe?"Cancel":"Add title"]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2 overflow-auto py-4",children:[qe&&e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-dashed bg-muted/20 p-3",children:[e.jsx(z,{className:"text-xs",children:"Title"}),e.jsx(H,{value:ae.title,onChange:t=>Xe(n=>({...n,title:t.target.value})),placeholder:"Enter your title",className:"h-9",autoFocus:!0}),e.jsx(z,{className:"text-xs",children:"Thumbnail text (optional)"}),e.jsx(H,{value:ae.thumbnailText,onChange:t=>Xe(n=>({...n,thumbnailText:t.target.value})),placeholder:"Short text for thumbnail",className:"h-9"}),e.jsx(u,{type:"button",size:"sm",onClick:Nn,disabled:!ae.title.trim(),children:"Add title"})]}),de.map(t=>t.kind==="suggestion"?(()=>{const{suggestion:n}=t,r=Me===`sug-${n.id}`;return e.jsx("div",{className:"flex flex-col gap-2 rounded-lg border bg-muted/30 p-3",children:r?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"text-xs",children:"Title"}),e.jsx(H,{value:oe.title,onChange:o=>ge(l=>({...l,title:o.target.value})),placeholder:"Title",className:"h-9"}),e.jsx(z,{className:"text-xs",children:"Thumbnail text (optional)"}),e.jsx(H,{value:oe.thumbnailText,onChange:o=>ge(l=>({...l,thumbnailText:o.target.value})),placeholder:"Short text for thumbnail",className:"h-9"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(u,{type:"button",size:"sm",onClick:Ns,children:"Save"}),e.jsx(u,{type:"button",size:"sm",variant:"ghost",onClick:vs,children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:n.text}),n.thumbnailText&&e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:n.thumbnailText})]}),e.jsxs("div",{className:"flex shrink-0 gap-1",children:[e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>jn(n),title:"Use as title",children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>bn(n),title:"Add to saved titles",children:e.jsx(Hs,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>_n(n),title:"Edit",children:e.jsx(Ws,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>vn(n.id),title:"Remove",children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})})},`sug-${n.id}`)})():(()=>{const{option:n,index:r}=t,o=Me===`opt-${r}`;return e.jsx("div",{className:"flex flex-col gap-2 rounded-lg border bg-muted/30 p-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"text-xs",children:"Title"}),e.jsx(H,{value:oe.title,onChange:l=>ge(a=>({...a,title:l.target.value})),placeholder:"Title",className:"h-9"}),e.jsx(z,{className:"text-xs",children:"Thumbnail text (optional)"}),e.jsx(H,{value:oe.thumbnailText,onChange:l=>ge(a=>({...a,thumbnailText:l.target.value})),placeholder:"Short text for thumbnail",className:"h-9"}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(u,{type:"button",size:"sm",onClick:Ns,children:"Save"}),e.jsx(u,{type:"button",size:"sm",variant:"ghost",onClick:vs,children:"Cancel"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:n.title}),n.thumbnail_text&&e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:n.thumbnail_text}),n.is_primary&&e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:"Current title"})]}),e.jsxs("div",{className:"flex shrink-0 gap-1",children:[e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>wn(n),title:"Use as title",disabled:n.is_primary,children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>kn(n,r),title:"Edit",children:e.jsx(Ws,{className:"h-4 w-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>Tn(n),title:"Remove",children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})})},`opt-${n.id??n.title??r}`)})())]})]})]}),e.jsx(J,{open:hn,onOpenChange:ps,children:e.jsxs(Y,{side:"right",className:"w-full sm:max-w-lg flex flex-col",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Reel captions"}),e.jsx(ee,{children:"Captions for IG Reels, TikTok, Facebook Reels, and X. Generate once â€” theyâ€™re saved with the script. Copy the one you like."}),(!((Us=L==null?void 0:L.options)!=null&&Us.length)||L.options.length<3)&&e.jsxs(u,{type:"button",variant:"outline",size:"sm",className:"mt-2 w-fit",disabled:be,onClick:bs,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),be?"Generatingâ€¦":"Generate 3 options"]})]}),e.jsx("div",{className:"mt-4 flex flex-1 flex-col gap-4 overflow-y-auto",children:(Is=L==null?void 0:L.options)!=null&&Is.length?e.jsxs(e.Fragment,{children:[L.options.map((t,n)=>e.jsxs("div",{className:"rounded-lg border bg-muted/20 p-4",children:[e.jsxs("p",{className:"text-muted-foreground mb-2 text-xs font-medium",children:["Option ",n+1]}),e.jsx("p",{className:"whitespace-pre-wrap text-sm",children:t.caption}),e.jsxs(u,{type:"button",variant:"ghost",size:"sm",className:"mt-2 h-8",onClick:()=>ot(t.caption,"Caption copied!"),children:[e.jsx(it,{className:"mr-1.5 h-3.5 w-3.5"}),"Copy"]})]},n)),e.jsx(u,{type:"button",variant:"outline",size:"sm",className:"w-fit",disabled:be,onClick:bs,children:be?"Regeneratingâ€¦":"Regenerate"})]}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No captions yet. Click Generate to create 3 options from your script."})})]})}),Yt&&e.jsx("p",{className:"text-destructive text-sm",role:"alert",children:Yt}),e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(u,{type:"button",variant:C&&(C.descriptionBlock||C.metaTags)?"ghost":"outline",size:"icon",className:"h-9 w-9 shrink-0",onClick:()=>vt(!0),children:e.jsx(hr,{className:"h-4 w-4"})})}),e.jsx(P,{side:"bottom",children:"Description & tags"})]}),Qt&&e.jsx("p",{className:"text-destructive text-sm",role:"alert",children:Qt}),i&&e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 shrink-0 relative",onClick:()=>ms(!0),children:[e.jsx(Ut,{className:"h-4 w-4"}),je.length>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 flex h-4 min-w-4 items-center justify-center rounded-full bg-muted px-1 text-[10px] font-medium",children:je.length})]})}),e.jsx(P,{side:"bottom",children:je.length>0?`Thumbnails (${je.length})`:"Thumbnails"})]}),e.jsx(J,{open:cn,onOpenChange:t=>{vt(t),t&&(Ke(null),C===null&&Ce({descriptionBlock:"",metaTags:""}))},children:e.jsxs(Y,{side:"right",className:"flex w-full flex-col gap-0 sm:max-w-xl",children:[e.jsxs(Q,{className:"px-6 pt-6 pb-4",children:[e.jsx(Z,{children:"Description, timestamps & tags"}),e.jsx(ee,{children:"Edit below â€” changes are saved automatically with the script. Generate with AI or write your own."}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[C&&(C.descriptionBlock||C.metaTags)&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{type:"button",variant:"secondary",size:"sm",onClick:()=>ot(C.descriptionBlock),children:[e.jsx(it,{className:"mr-2 h-4 w-4"}),"Copy description"]}),e.jsxs(u,{type:"button",variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>ot(C.metaTags,"Tags copied!"),children:[e.jsx(it,{className:"mr-1.5 h-3.5 w-3.5"}),"Copy tags"]})]}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",disabled:We,onClick:Un,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),We?"Generatingâ€¦":C&&(C.descriptionBlock||C.metaTags)?"Regenerate with AI":"Generate with AI"]})]})]}),C&&e.jsxs("div",{className:"flex flex-1 flex-col gap-6 overflow-y-auto px-6 pb-8 pt-2",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description, related videos & timestamps"}),e.jsx(mt,{value:C.descriptionBlock,onChange:t=>Ce(n=>n?{...n,descriptionBlock:t.target.value}:null),rows:18,className:"min-h-[320px] resize-y font-sans text-sm leading-relaxed",placeholder:"Short descriptionâ€¦"})]}),e.jsxs("section",{className:"space-y-2 rounded-lg border border-border/60 bg-muted/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Meta tags"}),e.jsxs("span",{className:`text-xs tabular-nums ${C.metaTags.length>ut?"text-destructive":"text-muted-foreground"}`,children:[C.metaTags.length," / ",ut]})]}),e.jsx(mt,{value:C.metaTags,onChange:t=>Ce(n=>n?{...n,metaTags:t.target.value.slice(0,ut)}:null),maxLength:ut,rows:3,className:"resize-y font-sans text-sm",placeholder:"tag1, tag2, tag3â€¦ (max 500 characters for YouTube)"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{type:"button",variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>ot(C.metaTags,"Tags copied!"),children:[e.jsx(it,{className:"mr-1.5 h-3.5 w-3.5"}),"Copy tags"]})})]})]})]})}),e.jsx(J,{open:mn,onOpenChange:ms,children:e.jsxs(Y,{side:"right",className:"flex w-full flex-col gap-0 sm:max-w-lg",children:[e.jsxs(Q,{className:"px-6 pt-6 pb-4",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5"}),"Thumbnails"]}),e.jsx(ee,{children:"Overlay text is set in Title ideas. Here you can add and view thumbnail images for this script â€” upload to keep a gallery, remove any you donâ€™t need."})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 overflow-y-auto px-6 pb-8 pt-2",children:[Te&&e.jsxs("section",{className:"rounded-lg border border-border/60 bg-muted/10 p-3",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wider",children:"Overlay text"}),e.jsx("p",{className:"mt-1 text-sm",children:Te}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:"Edit in Title ideas â†’ use or edit a title option."})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 pb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Images"}),!k&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:xs,type:"file",accept:"image/*",className:"hidden",onChange:Cn}),e.jsx(u,{type:"button",size:"sm",variant:"outline",disabled:Qe,onClick:()=>{var t;return(t=xs.current)==null?void 0:t.click()},children:Qe?"Uploadingâ€¦":"Add image"})]})]}),je.length===0?e.jsxs("div",{className:"rounded-lg border border-dashed border-muted-foreground/30 bg-muted/10 p-8 text-center",children:[e.jsx(Ut,{className:"mx-auto h-10 w-10 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"No thumbnail images yet"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:"Upload an image to get started (e.g. 1280Ã—720 for YouTube)."})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-2",children:je.map(t=>e.jsxs("div",{className:"group relative overflow-hidden rounded-lg border bg-muted/30",children:[e.jsx("img",{src:t.url,alt:"",className:"aspect-video w-full object-cover"}),!k&&e.jsx(u,{type:"button",variant:"destructive",size:"icon",className:"absolute right-2 top-2 h-8 w-8 opacity-90 shadow hover:opacity-100",onClick:()=>Rn(t),title:"Remove",children:e.jsx($s,{className:"h-4 w-4"})})]},t.id))})]})]})]})}),e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",onClick:()=>$t(!0),children:e.jsx(xr,{className:"h-4 w-4"})})}),e.jsx(P,{side:"bottom",children:"Outline"})]}),e.jsxs(at,{children:[e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(lt,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",children:e.jsx(pr,{className:"h-4 w-4"})})})}),e.jsx(P,{side:"bottom",children:"Checklist"})]}),e.jsxs(ct,{className:"w-72 p-3",align:"start",side:"bottom",children:[e.jsx("p",{className:"text-muted-foreground mb-2 text-xs font-medium",children:"Script checklist"}),e.jsx("div",{className:"flex flex-col gap-2",children:Pe.map(t=>e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 text-sm",children:[e.jsx(Ps,{checked:t.checked,onCheckedChange:n=>zt(r=>r.map(o=>o.id===t.id?{...o,checked:!!n}:o))}),e.jsx("span",{className:t.checked?"text-muted-foreground line-through":"",children:t.label})]},t.id))})]})]}),(v.length===0||v.length===1&&!te(v).trim())&&e.jsxs(at,{open:an,onOpenChange:Kt,children:[e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(lt,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",size:"sm",className:"h-9 shrink-0",children:[e.jsx(Nr,{className:"mr-2 h-4 w-4"}),"Start from template"]})})}),e.jsx(P,{side:"bottom",children:"Script templates"})]}),e.jsx(ct,{className:"w-64 p-2",align:"start",children:$r.map(t=>e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{M(t.content.map(n=>({...n,id:crypto.randomUUID()}))),Kt(!1),y.success(`Applied "${t.name}" template`)},children:t.name},t.id))})]}),e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>{Wt(!0),jt(!0),fetch(d.route("script.snippets.index"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(t=>t.json()).then(t=>{gt(t.snippets??[]),jt(!1)}).catch(()=>jt(!1))},children:e.jsx(_r,{className:"h-4 w-4"})})}),e.jsx(P,{side:"bottom",children:"Snippets"})]}),e.jsxs(at,{open:sn,onOpenChange:Ht,children:[e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(lt,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9",disabled:$,children:e.jsx(jr,{className:"h-4 w-4"})})})}),e.jsx(P,{side:"bottom",children:"Analysis"})]}),e.jsxs(q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9",disabled:_e,onClick:Dn,children:_e?e.jsx("span",{className:"text-xs",children:"â€¦"}):e.jsx(wr,{className:"h-4 w-4"})})}),e.jsx(P,{side:"bottom",children:"Generate short from script"})]}),e.jsxs(ct,{className:"w-56 p-2",align:"start",children:[e.jsx("p",{className:"text-muted-foreground mb-2 px-1 text-xs font-medium",children:"What do you want to analyze?"}),e.jsxs("div",{className:"grid gap-0.5",children:[e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"justify-start font-normal",onClick:()=>Ae("retention"),disabled:$,children:"Retention & engagement"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"justify-start font-normal",onClick:()=>Ae("cta"),disabled:$,children:"CTA & conversion"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"justify-start font-normal",onClick:()=>Ae("storytelling"),disabled:$,children:"Storytelling & narrative"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"justify-start font-normal",onClick:()=>Ae("readability"),children:"Readability & repetition"})]})]})]}),e.jsx("span",{className:"text-muted-foreground mx-1 text-xs",children:"|"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-9",disabled:!!K,onClick:()=>Ot("intro",{insertAt:"top"}),children:K==="intro"?"â€¦":"Write intro"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-9",disabled:!!K,onClick:()=>Ot("outro",{insertAt:"bottom"}),children:K==="outro"?"â€¦":"Write outro"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-9",disabled:!!K,onClick:()=>Ot("hook",{insertAt:"top"}),children:K==="hook"?"â€¦":"Suggest hook"}),e.jsx(J,{open:tn,onOpenChange:$t,children:e.jsxs(Y,{side:"left",className:"w-64",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Outline"}),e.jsx(ee,{children:"Headings in your script"})]}),e.jsx("div",{className:"mt-4 space-y-1",children:ws.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"Add heading blocks to see the outline."}):ws.map(t=>e.jsx("div",{className:"text-sm",style:{paddingLeft:(t.level-1)*12},children:t.text},t.id))})]})}),e.jsx(J,{open:nn,onOpenChange:Fe,children:e.jsxs(Y,{side:"right",className:"w-full sm:max-w-xl overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsxs(Z,{children:["Analysis ",I?`(${I.type==="retention"?"Retention & engagement":I.type==="cta"?"CTA & conversion":I.type==="storytelling"?"Storytelling & narrative":"Readability & repetition"})`:""]}),e.jsx(ee,{children:"Reference while editing. Use Apply to insert a suggested version above the original in the script."})]}),$&&e.jsx("p",{className:"text-muted-foreground mt-4 text-sm",children:"Running analysisâ€¦"}),!$&&I&&(I.type==="retention"||I.type==="cta"||I.type==="storytelling")&&e.jsx(u,{type:"button",variant:"outline",size:"sm",className:"mt-4",onClick:()=>Ae(I.type,!0),children:"Regenerate"}),!$&&I&&e.jsxs("div",{className:"mt-4 space-y-6",children:[I.analysis&&e.jsx("div",{className:"rounded-md border bg-muted/30 p-4",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-sm",children:e.jsx(Cr,{text:I.analysis})})}),I.suggestions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 text-sm font-semibold",children:"Suggested fixes (insert above original)"}),e.jsx("div",{className:"space-y-3",children:I.suggestions.map((t,n)=>e.jsxs("div",{className:"rounded-md border bg-card p-3",children:[e.jsx("p",{className:"text-muted-foreground mb-1 text-xs font-medium",children:t.label}),e.jsxs("p",{className:"text-muted-foreground mb-2 line-clamp-2 text-xs",children:["Original: ",t.originalSnippet.slice(0,120),t.originalSnippet.length>120?"â€¦":""]}),e.jsxs("p",{className:"mb-3 line-clamp-3 text-xs",children:["Suggested: ",t.suggestedText.slice(0,180),t.suggestedText.length>180?"â€¦":""]}),e.jsx(u,{type:"button",variant:"secondary",size:"sm",onClick:()=>Ln(t),children:"Apply above original"})]},n))})]})]})]})}),e.jsx(nr,{open:ln,onOpenChange:$e,children:e.jsxs(rr,{className:"max-w-2xl max-h-[85vh] flex flex-col",children:[e.jsxs(or,{children:[e.jsx(ar,{children:"Short from script"}),e.jsx(lr,{children:'Edit the short below, then create a new script to save it. The new script will be titled with " SHORT" appended.'})]}),e.jsx(mt,{value:He,onChange:t=>bt(t.target.value),placeholder:"Short script will appear hereâ€¦",className:"min-h-[280px] resize-y font-sans text-sm",disabled:_e}),e.jsxs(cr,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>$e(!1),children:"Cancel"}),e.jsx(u,{type:"button",disabled:!He.trim()||Gt,onClick:Mn,children:Gt?"Creatingâ€¦":"Create new script"})]})]})}),e.jsx(J,{open:on,onOpenChange:Wt,children:e.jsxs(Y,{side:"right",className:"w-full sm:max-w-md",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Snippets"}),e.jsx(ee,{children:"Insert saved phrases at the end of your script."})]}),e.jsx("div",{className:"mt-4 flex flex-col gap-2",children:yt?e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loadingâ€¦"}):e.jsxs(e.Fragment,{children:[rn.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded border p-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:t.title}),e.jsxs("p",{className:"text-muted-foreground truncate text-xs",children:[t.body.slice(0,60),t.body.length>60?"â€¦":""]})]}),e.jsxs("div",{className:"flex shrink-0 gap-1",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{const n={id:crypto.randomUUID(),type:"paragraph",content:[{type:"text",text:t.body}]};M(r=>[...r,n]),y.success("Snippet appended")},children:"Insert"}),e.jsx(u,{size:"sm",variant:"ghost",onClick:async()=>{var r;const n=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)??"";await fetch(d.route("script.snippets.destroy",{id:t.id}),{method:"DELETE",headers:{"X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"}}),gt(o=>o.filter(l=>l.id!==t.id)),y.success("Deleted")},children:e.jsx(Ee,{className:"h-4 w-4"})})]})]},t.id)),e.jsxs("div",{className:"rounded border border-dashed p-3",children:[e.jsx("p",{className:"text-muted-foreground mb-2 text-xs font-medium",children:"Add snippet"}),e.jsx(Br,{tenantRouter:d,onAdded:t=>gt(n=>[...n,t])})]})]})})]})})]}),i&&(s==null?void 0:s.can_edit)&&!j&&((Ls=s==null?void 0:s.lock)==null?void 0:Ls.locked)&&s.lock.locked_by&&e.jsx("div",{className:"mb-4 flex items-center gap-2",children:e.jsxs("p",{className:"bg-amber-500/10 text-amber-700 dark:text-amber-400 rounded-md px-3 py-1.5 text-sm font-medium",children:["Locked by ",s.lock.locked_by.name,". You can view only until they leave."]})}),k&&i&&(s==null?void 0:s.can_edit)===!1&&e.jsx("p",{className:"text-muted-foreground mb-4 text-sm",children:"You have view-only access to this script."}),e.jsx(qr,{children:e.jsx(Xr,{initialContent:v.length>0?v:void 0,onChange:pn,placeholder:"Start typing your script or press '/' for commands...",editable:!k,onAiEditRequest:k?void 0:gn,onEditorReady:t=>{Nt.current=t}})}),D&&s&&e.jsx(J,{open:Tt,onOpenChange:Zt,children:e.jsxs(Y,{side:"right",className:"flex w-full flex-col gap-0 sm:max-w-md",children:[e.jsxs(Q,{className:"px-6 pt-6 pb-4",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5"}),"Share & access"]}),e.jsx(ee,{children:"Invite people or publish a read-only link. Only people with access can open this script."})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 overflow-y-auto px-6 pb-8 pt-2",children:[e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Publish to web"}),kt?e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loadingâ€¦"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:(p==null?void 0:p.visibility)==="published"?"Anyone with the link can view (read-only)":"Only people with access can open"}),e.jsx(u,{type:"button",variant:(p==null?void 0:p.visibility)==="published"?"secondary":"default",size:"sm",disabled:Ve,onClick:(p==null?void 0:p.visibility)==="published"?Pn:Xn,children:Ve?"â€¦":(p==null?void 0:p.visibility)==="published"?"Unpublish":"Publish"})]}),(p==null?void 0:p.visibility)==="published"&&(p==null?void 0:p.public_url)&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/30 p-2",children:[e.jsx(fr,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),e.jsx("input",{readOnly:!0,className:"min-w-0 flex-1 bg-transparent text-sm outline-none",value:p.public_url}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:Hn,children:"Copy"})]})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"People with access"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Only organization members can be added. To share publicly, use Publish above."}),p&&e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-md border p-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:(Ds=p.owner)==null?void 0:Ds.name}),e.jsx("p",{className:"text-muted-foreground truncate text-xs",children:(Ms=p.owner)==null?void 0:Ms.email})]}),e.jsx("span",{className:"shrink-0 rounded bg-muted px-2 py-0.5 text-xs font-medium",children:"Owner"})]}),(p.collaborators||[]).map(t=>e.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-md border p-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.name}),e.jsx("p",{className:"text-muted-foreground truncate text-xs",children:t.email})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsxs(ie,{value:t.role,onValueChange:n=>$n(t.user_id,n),children:[e.jsx(ue,{className:"h-8 w-24",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx(O,{value:"view",children:"View"}),e.jsx(O,{value:"edit",children:"Edit"}),e.jsx(O,{value:"admin",children:"Admin"})]})]}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>zn(t.user_id),title:"Remove from this script",children:e.jsx(Ee,{className:"h-4 w-4"})})]})]},t.user_id))]}),(p==null?void 0:p.access_denied_user_ids)&&p.access_denied_user_ids.length>0&&p.org_members&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-medium",children:"Removed from this script (can re-add)"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:p.org_members.filter(t=>p.access_denied_user_ids.includes(t.user_id)).map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md border bg-muted/50 px-2 py-1 text-xs",children:[t.name,e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"h-5 px-1 text-xs",onClick:()=>Bn(t.email),children:"Re-add"})]},t.user_id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ie,{value:ss===""?"":String(ss),onValueChange:t=>{const n=t===""?"":Number(t);if(ns(n),n&&(p!=null&&p.org_members)){const r=p.org_members.find(o=>o.user_id===n);r&&ts(r.email)}Je(null)},children:[e.jsx(ue,{className:"max-w-[220px]",children:e.jsx(me,{placeholder:"Add a team memberâ€¦"})}),e.jsx(he,{children:(qs=p==null?void 0:p.org_members)==null?void 0:qs.filter(t=>{var n;return t.user_id!==((n=p.owner)==null?void 0:n.user_id)&&!(p.collaborators||[]).some(r=>r.user_id===t.user_id)}).map(t=>e.jsxs(O,{value:String(t.user_id),children:[t.name," (",t.email,")"]},t.user_id))})]}),e.jsxs(ie,{value:rs,onValueChange:t=>os(t),children:[e.jsx(ue,{className:"w-28",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx(O,{value:"view",children:"View"}),e.jsx(O,{value:"edit",children:"Edit"}),e.jsx(O,{value:"admin",children:"Admin"})]})]}),e.jsx(u,{type:"button",size:"sm",onClick:Fn,disabled:Se||!_t.trim(),children:Se?"â€¦":"Add"})]}),ls&&e.jsx("p",{className:"text-destructive text-sm",children:ls})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Co-authors"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Credit others on this script. Optionally give them edit access when adding."}),e.jsx("ul",{className:"space-y-2",children:Ye.map(t=>e.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-md border p-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.name}),e.jsx("p",{className:"text-muted-foreground truncate text-xs",children:t.email})]}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0 text-destructive",onClick:()=>Kn(t.user_id),disabled:dn===t.user_id,title:"Remove co-author",children:e.jsx(Ee,{className:"h-4 w-4"})})]},t.user_id))}),Ye.length===0&&e.jsx("p",{className:"text-muted-foreground text-xs",children:"No co-authors yet."}),(p==null?void 0:p.org_members)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(ie,{value:ye===""?"":String(ye),onValueChange:t=>is(t===""?"":Number(t)),disabled:Rt,children:[e.jsx(ue,{className:"max-w-[220px]",children:e.jsx(me,{placeholder:"Add co-authorâ€¦"})}),e.jsx(he,{children:p.org_members.filter(t=>{var n;return t.user_id!==((n=p.owner)==null?void 0:n.user_id)&&!Ye.some(r=>r.user_id===t.user_id)}).map(t=>e.jsxs(O,{value:String(t.user_id),children:[t.name," (",t.email,")"]},t.user_id))})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("input",{type:"checkbox",checked:us,onChange:t=>un(t.target.checked),className:"rounded border-input"}),"Also give edit access"]}),e.jsx(u,{type:"button",size:"sm",onClick:()=>{ye&&!Ye.some(t=>t.user_id===ye)&&(Wn(ye,us),is(""))},disabled:Rt||!ye,children:Rt?"â€¦":"Add"})]})]})]})]})})]})]})}export{ca as default};
