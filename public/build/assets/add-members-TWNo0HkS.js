import{r as n,j as e,H as W,L as T,a as Y}from"./app-CMfsqCQM.js";import{t as m}from"./index-q8lzB8Tn.js";import{A as Z}from"./app-layout-DWW7ov8A.js";import{B as c}from"./button-B2dnQCAa.js";import{I}from"./input-Bpdo4m0L.js";import{L as f}from"./label-BEW08XYy.js";import{C as ee,a as se,b as te,c as ae,d as re}from"./card-BKip0K0O.js";import{S as E,a as k,b as F,c as R,d as U}from"./select-CAt556DM.js";import{T as ie,a as ne,b as _,c as B}from"./tabs-BjbrlGHc.js";import{U as P}from"./user-plus-C-NrluTS.js";import{B as le}from"./building-2-CraT7Xwf.js";import{S as M}from"./search-CB-aVQff.js";import{M as oe}from"./mail-CyHnWLIa.js";import{L as V}from"./loader-circle-_myqQxWV.js";import{X as me}from"./x-Cu70FuQ4.js";/* empty css            */import"./breadcrumb-UVH0om7h.js";import"./utils-DawFQoOT.js";import"./sheet-CwGP68Z_.js";import"./index-Dsoa9CjY.js";import"./index-xqWKCSYm.js";import"./index-BeUfNboo.js";import"./index-DYM8iIys.js";import"./index-NxXi0nlY.js";import"./index-DCzB2KT7.js";import"./index-jjTweGYJ.js";import"./index-BrOQlPGX.js";import"./index-C5ERfWkd.js";import"./index-CmYx4CDV.js";import"./createLucideIcon-DV9StWnM.js";import"./dropdown-menu-D-TuDDeo.js";import"./index-DJMkznTg.js";import"./index-BDWLcZMo.js";import"./check-KdCJQoSn.js";import"./file-text-ZIm8Me-N.js";import"./users-nX7eRmms.js";import"./package-BK_e8Gd3.js";import"./wallet-D3VF3ET3.js";import"./chevron-down-uDeEpgqx.js";import"./skeleton-BM9JAt9Z.js";import"./use-effective-tenant-FNx9T5uV.js";import"./use-tenant-router-ECVXs2qr.js";import"./trash-2-C6bUCbz1.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-Bt6Fbven.js";import"./dollar-sign-Cvub9wzG.js";import"./credit-card-BIZzkTvA.js";import"./shield-BxhzRHW9.js";import"./circle-alert-DbZArJmq.js";import"./chevron-right-DPdqOnta.js";import"./sonner-DSzJt1Z7.js";import"./index-CSp-ZSgT.js";const ce=[{title:"Organizations",href:"/organizations"},{title:"Add members",href:"/organizations/add-members"}];function cs({tenants:g,roles:H}){const[d,O]=n.useState(""),[v,$]=n.useState("member"),[l,u]=n.useState([]),[j,y]=n.useState(""),[N,p]=n.useState([]),[q,w]=n.useState(!1),o=n.useRef(null),[S,C]=n.useState(""),[z,b]=n.useState(!1),A=n.useCallback(async s=>{const r=s.trim();if(r.length<2){p([]);return}w(!0);try{const i=`${route("tenants.add-members.search-users")}?q=${encodeURIComponent(r)}`,x=await(await fetch(i,{headers:{Accept:"application/json"}})).json();p(Array.isArray(x.users)?x.users:[])}catch{p([])}finally{w(!1)}},[]);n.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{A(j)},300),()=>{o.current&&clearTimeout(o.current)}),[j,A]);const D=s=>{l.some(i=>i.type==="user"&&i.id===s.id)||(u(i=>[...i,{type:"user",id:s.id,name:s.name,email:s.email}]),y(""),p([]))},Q=()=>{const s=S.split(/[\n,;]+/).map(t=>t.trim().toLowerCase()).filter(t=>t.length>0),r=s.filter(t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)),i=r.map(t=>({type:"email",email:t})),a=new Set(l.filter(t=>t.type==="email").map(t=>t.email)),x=new Set(l.filter(t=>t.type==="user").map(t=>t.email.toLowerCase())),K=i.filter(t=>!a.has(t.email)&&!x.has(t.email));u(t=>[...t,...K]),C(""),r.length!==s.length&&m.info("Some lines were not valid emails and were skipped.")},X=s=>{u(r=>r.filter((i,a)=>a!==s))},G=s=>{if(s.preventDefault(),!d||l.length===0){m.error("Select an organization and add at least one user or email.");return}const r=l.filter(a=>a.type==="user").map(a=>a.id),i=l.filter(a=>a.type==="email").map(a=>a.email);if(r.length===0&&i.length===0){m.error("Add at least one user or email.");return}b(!0),Y.post(route("tenants.add-members.store"),{tenant_id:d,role:v,user_ids:r,emails:i},{preserveScroll:!0,onSuccess:()=>{u([]),b(!1),m.success("Members added successfully.")},onError:a=>{b(!1),m.error(a.tenant_id||a.role||"Failed to add members.")}})},[h,J]=n.useState(""),L=h.trim()?g.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.slug.toLowerCase().includes(h.toLowerCase())):g;return e.jsxs(Z,{breadcrumbs:ce,children:[e.jsx(W,{title:"Add members to organization"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Add members"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Add existing users to an organization with a role. No invites or emails are sent."})]}),e.jsx(T,{href:route("tenants.index"),children:e.jsx(c,{variant:"outline",size:"sm",children:"Back to organizations"})})]}),e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Add to organization"]}),e.jsx(ae,{children:"Choose an organization and role, then add users by search or by pasting emails."})]}),e.jsx(re,{children:e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"tenant",children:"Organization"}),g.length>3&&e.jsx(I,{placeholder:"Search organizations...",value:h,onChange:s=>J(s.target.value),className:"mb-2"}),e.jsxs(E,{value:d,onValueChange:O,required:!0,children:[e.jsx(k,{id:"tenant",className:"w-full",children:e.jsx(F,{placeholder:"Select organization"})}),e.jsx(R,{children:L.length===0?e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No organizations match."}):L.map(s=>e.jsx(U,{value:s.id,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),s.name]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"role",children:"Role"}),e.jsxs(E,{value:v,onValueChange:$,children:[e.jsx(k,{id:"role",className:"w-full",children:e.jsx(F,{})}),e.jsx(R,{children:H.map(s=>e.jsx(U,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Users to add"}),e.jsxs(ie,{defaultValue:"search",className:"w-full",children:[e.jsxs(ne,{className:"grid w-full grid-cols-2",children:[e.jsxs(_,{value:"search",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Search user"]}),e.jsxs(_,{value:"emails",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Paste emails"]})]}),e.jsxs(B,{value:"search",className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by name or email (min 2 chars)...",value:j,onChange:s=>y(s.target.value),className:"pl-9"}),q&&e.jsx(V,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),N.length>0&&e.jsx("ul",{className:"border rounded-md divide-y max-h-48 overflow-auto",children:N.map(s=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>D(s),className:"w-full px-3 py-2 text-left text-sm hover:bg-muted/60 flex items-center justify-between",children:[e.jsxs("span",{children:[s.name," ",e.jsxs("span",{className:"text-muted-foreground",children:["(",s.email,")"]})]}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]})},s.id))})]}),e.jsxs(B,{value:"emails",className:"space-y-2 mt-2",children:[e.jsx("textarea",{placeholder:"One email per line, or comma/semicolon separated",value:S,onChange:s=>C(s.target.value),className:"flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",rows:4}),e.jsx(c,{type:"button",variant:"secondary",size:"sm",onClick:Q,children:"Add from list"})]})]})]}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{children:["Pending (",l.length,")"]}),e.jsx("ul",{className:"border rounded-md divide-y max-h-40 overflow-auto",children:l.map((s,r)=>e.jsxs("li",{className:"flex items-center justify-between px-3 py-2 text-sm",children:[s.type==="user"?e.jsxs("span",{children:[s.name," ",e.jsxs("span",{className:"text-muted-foreground",children:["(",s.email,")"]})]}):e.jsx("span",{className:"text-muted-foreground",children:s.email}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>X(r),children:e.jsx(me,{className:"h-4 w-4"})})]},r))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(c,{type:"submit",disabled:z||!d||l.length===0,children:z?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Addingâ€¦"]}):e.jsx(e.Fragment,{children:"Add to organization"})}),e.jsx(T,{href:route("tenants.index"),children:e.jsx(c,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})]})]})}export{cs as default};
