import{r as c,j as e,H as K,L as q,a as o}from"./app-DU4M08QO.js";import{A as V}from"./app-layout-CWJDu2yd.js";import{B as m}from"./button-0DWS1uOF.js";import{C as B}from"./card-CIVp5v17.js";import{EditForm as O}from"./edit-form-gKo_ZFDc.js";import{t as n}from"./index-rHsITjXj.js";import{C as R}from"./calendar-CidCCUuE.js";import{P as E,a as A,b as L}from"./popover-DnY4cizK.js";import{c as $}from"./utils-DawFQoOT.js";import{S as T,a as M,b as W,c as H,d as z}from"./select-DVGvg1wx.js";import{D as X,b as G}from"./dialog-8xkmOHR_.js";import{B as J}from"./badge-CRsyjkeS.js";import{RejectDialog as Q}from"./reject-dialog-C4kYho8S.js";import{C as U}from"./calendar-WI8NWamZ.js";import{C as Z}from"./check-CljcYcVc.js";import{X as b}from"./x-DVBtjuUJ.js";import{R as k}from"./rotate-ccw-CuzzFpOv.js";import{f as ee}from"./format-Dbvp4nIN.js";/* empty css            */import"./breadcrumb-BSvnjDea.js";import"./input-z-FCfDx3.js";import"./sheet-CHL5JyIf.js";import"./index-ksG8cN4f.js";import"./index-Ba8EDFfi.js";import"./index-DWOVOz5G.js";import"./index-BfArzEZR.js";import"./index-Dax8b012.js";import"./index-BuAmfKhH.js";import"./index-DVV6TkzN.js";import"./index-CY-eh05M.js";import"./index-DdLmsglv.js";import"./index-Dy8zP7tC.js";import"./createLucideIcon-Kjqtfux8.js";import"./dropdown-menu-BSZHQ9yV.js";import"./index-C31rQuzh.js";import"./index-ELRl1PxQ.js";import"./chevron-down-DOpVs1Mm.js";import"./skeleton-DeAfgcQK.js";import"./use-effective-tenant-6xYuTafE.js";import"./use-tenant-router-mhkU5Kgb.js";import"./trash-2-C9dHTECi.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-tVN0-8fp.js";import"./file-text-BaK0CXIP.js";import"./dollar-sign-DzSGN3WH.js";import"./credit-card-CRs7L-78.js";import"./mail-CwNPBuud.js";import"./shield-IA8j3DE0.js";import"./circle-alert-CvqXQmI-.js";import"./package-ChfYgdRA.js";import"./users-Cd4kg-Sk.js";import"./wallet-CqZJpKq_.js";import"./building-2-CdICHkKN.js";import"./chevron-right-CrQYE_m4.js";import"./sonner-Dh23Qk9O.js";import"./label-BsVN1GsZ.js";import"./textarea-C7BpPhvr.js";import"./chevron-left-9NrEPTAz.js";import"./index-sRFl2c6N.js";const f={passport:"Passport",national_id:"National ID Card",drivers_license:"Driver's License"},te=[{title:"Admin",href:"/dashboard/admin"},{title:"KYC Management",href:"/admin/kyc"},{title:"Edit KYC",href:"#"}];function nt({kyc:t}){const[p,s]=c.useState(!1),[C,i]=c.useState({}),[d,v]=c.useState(t.date_of_birth?new Date(t.date_of_birth):void 0),[x,N]=c.useState(t.date_of_birth?new Date(t.date_of_birth).getFullYear():new Date().getFullYear()),[w,_]=c.useState(!1),[u,h]=c.useState(null),[D,g]=c.useState(!1),Y=Array.from({length:100},(r,a)=>new Date().getFullYear()-a),S=[{name:"full_name",type:"text",label:"Full Name",required:!0,defaultValue:t.full_name},{name:"date_of_birth",type:"custom",label:"Date of Birth",required:!0,defaultValue:t.date_of_birth,render:r=>e.jsx("div",{className:"space-y-2",children:e.jsxs(E,{open:w,onOpenChange:_,children:[e.jsx(A,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:$("w-full justify-start text-left font-normal",!d&&"text-muted-foreground"),children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),d?ee(d,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsxs(L,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"p-3",children:e.jsxs(T,{value:x.toString(),onValueChange:a=>{const l=parseInt(a);if(N(l),d){const j=new Date(d);j.setFullYear(l),v(j),r.onChange(j.toISOString().split("T")[0])}},children:[e.jsx(M,{children:e.jsx(W,{placeholder:"Select year"})}),e.jsx(H,{children:Y.map(a=>e.jsx(z,{value:a.toString(),children:a},a))})]})}),e.jsx(R,{mode:"single",selected:d,onSelect:a=>{if(a){const l=new Date(a);l.setFullYear(x),v(l),r.onChange(l.toISOString().split("T")[0]),_(!1)}},initialFocus:!0,fromYear:new Date().getFullYear()-100,toYear:new Date().getFullYear(),defaultMonth:d||new Date(x,0,1)})]})]})})},{name:"phone_number",type:"text",label:"Phone Number",required:!0,defaultValue:t.phone_number},{name:"address_line_1",type:"text",label:"Address Line 1",required:!0,defaultValue:t.address_line_1},{name:"address_line_2",type:"text",label:"Address Line 2",required:!1,defaultValue:t.address_line_2},{name:"city",type:"text",label:"City",required:!0,defaultValue:t.city},{name:"state_province",type:"text",label:"State/Province",required:!0,defaultValue:t.state_province},{name:"postal_code",type:"text",label:"Postal Code",required:!0,defaultValue:t.postal_code},{name:"country",type:"text",label:"Country",required:!0,defaultValue:t.country},{name:"id_type",type:"select",label:"ID Type",required:!0,defaultValue:t.id_type,options:[{value:"passport",label:f.passport},{value:"national_id",label:f.national_id},{value:"drivers_license",label:f.drivers_license}]},{name:"id_number",type:"text",label:"ID Number",required:!0,defaultValue:t.id_number},{name:"id_document_front",type:"file",label:"ID Document Front",required:!0,accept:"image/*,.pdf"},{name:"id_document_back",type:"file",label:"ID Document Back",required:!0,accept:"image/*,.pdf"}],F=r=>{s(!0),i({}),o.post(route("kyc.update",t.id),r,{onSuccess:()=>{n.success("KYC verification updated successfully"),o.visit(route("kyc.show",t.id))},onError:a=>{i(a),Object.values(a).forEach(l=>{n.error(l)})},onFinish:()=>{s(!1)}})},y=async()=>{s(!0),i({});try{await o.put(route("kyc.update",t.id),{status:"approved"}),n.success("KYC approved successfully"),o.visit(route("kyc.index"))}catch{i({status:"Failed to approve KYC"}),n.error("Failed to approve KYC")}finally{s(!1)}},P=async r=>{s(!0),i({});try{await o.put(route("kyc.update",t.id),{status:"rejected",rejection_reason:r}),n.success("KYC rejected successfully"),o.visit(route("kyc.index"))}catch{i({status:"Failed to reject KYC"}),n.error("Failed to reject KYC")}finally{s(!1)}},I=async()=>{s(!0),i({});try{await o.put(route("kyc.update",t.id),{status:"pending",rejection_reason:null}),n.success("KYC status reverted to pending"),o.visit(route("kyc.index"))}catch{i({status:"Failed to revert KYC status"}),n.error("Failed to revert KYC status")}finally{s(!1)}};return e.jsxs(V,{breadcrumbs:te,children:[e.jsx(K,{title:"Edit KYC"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(q,{href:route("kyc.index"),children:e.jsx(m,{variant:"outline",children:"Back to KYC Management"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{variant:"default",onClick:y,disabled:p,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs(m,{variant:"destructive",onClick:()=>g(!0),disabled:p,children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Reject"]})]}),(t.status==="approved"||t.status==="rejected")&&e.jsxs(m,{variant:"outline",onClick:I,disabled:p,children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Revert to Pending"]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(O,{fields:S,entityName:"KYC",onSubmit:F,processing:p,errors:C}),e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Current Documents"}),e.jsx(J,{variant:t.status==="approved"?"default":t.status==="rejected"?"destructive":"secondary",children:t.status})]}),t.rejection_reason&&e.jsxs("div",{className:"rounded-lg border p-4 bg-destructive/10",children:[e.jsx("h3",{className:"font-medium text-destructive",children:"Rejection Reason"}),e.jsx("p",{className:"mt-1 text-sm",children:t.rejection_reason})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-medium",children:["Front of ",f[t.id_type]]}),e.jsx("div",{className:"relative aspect-video w-full overflow-hidden rounded-lg border cursor-pointer",onClick:()=>h(t.id_document_front),children:t.id_document_front.endsWith(".pdf")?e.jsx("iframe",{src:`/storage/${t.id_document_front}`,className:"h-full w-full",title:"Front Document"}):e.jsx("img",{src:`/storage/${t.id_document_front}`,alt:"Front of ID Document",className:"h-full w-full object-cover"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-medium",children:["Back of ",f[t.id_type]]}),e.jsx("div",{className:"relative aspect-video w-full overflow-hidden rounded-lg border cursor-pointer",onClick:()=>h(t.id_document_back),children:t.id_document_back.endsWith(".pdf")?e.jsx("iframe",{src:`/storage/${t.id_document_back}`,className:"h-full w-full",title:"Back Document"}):e.jsx("img",{src:`/storage/${t.id_document_back}`,alt:"Back of ID Document",className:"h-full w-full object-cover"})})]})]})]})})]}),e.jsx(X,{open:!!u,onOpenChange:()=>h(null),children:e.jsx(G,{className:"max-w-4xl",children:e.jsxs("div",{className:"relative",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"absolute right-2 top-2",onClick:()=>h(null),children:e.jsx(b,{className:"h-4 w-4"})}),u!=null&&u.endsWith(".pdf")?e.jsx("iframe",{src:`/storage/${u}`,className:"w-full h-[80vh]",title:"Document"}):e.jsx("img",{src:`/storage/${u}`,alt:"Document",className:"w-full h-auto max-h-[80vh] object-contain"})]})})}),e.jsx(Q,{isOpen:D,onClose:()=>g(!1),onConfirm:P,isLoading:p})]})]})}export{nt as default};
