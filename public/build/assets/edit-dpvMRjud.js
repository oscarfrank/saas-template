import{r as s,j as e,H as W,L as Y}from"./app-C6kPN11i.js";import{A as z}from"./app-layout-D7Ym20yP.js";import{B as l}from"./button-BpcDdXY5.js";import{EditForm as Q}from"./edit-form-BbtungrQ.js";import{t as o}from"./index-BdMXpxBe.js";import{A as S,a as D,b as N,c as k,d as A,e as L,f as q,g as w}from"./alert-dialog-Dxf_TM7l.js";import{T}from"./textarea-XQGu6FqI.js";import{L as i}from"./label-DjBGQ4hv.js";import{I}from"./input-DeRGwPqG.js";import{S as X,a as G,b as J,c as K,d as Z}from"./select-Ccun-8aA.js";import{u as ee}from"./use-tenant-router-DTqtlbGV.js";import{T as te}from"./trash-2-CxGNVkTA.js";import{D as ae}from"./dollar-sign-B1EcXlzZ.js";import{C as re}from"./circle-play-DtCWuxqy.js";import{C as se}from"./circle-check-big-DL2JgZ9L.js";import{C as E}from"./circle-x-BhVw3MSW.js";/* empty css            */import"./breadcrumb-T3ZEscMa.js";import"./utils-DawFQoOT.js";import"./sheet-DTohGHug.js";import"./index-BAMDKCYP.js";import"./index-BgupMaT4.js";import"./index-BAwu540p.js";import"./index-B6IO7GeI.js";import"./index-C7NICwH1.js";import"./index-D4LQi-WW.js";import"./index-BUDeVy67.js";import"./x-CBDS_5l3.js";import"./createLucideIcon-Btrq-JEB.js";import"./index-qNm-4KWi.js";import"./index-DjhqQPoh.js";import"./index-DhnENxrq.js";import"./dropdown-menu-D3Uldfay.js";import"./index-CNSJNdLA.js";import"./index-DqvV1WAh.js";import"./check-ClCxYYgj.js";import"./chevron-down-B2X-k1Lh.js";import"./skeleton-COOtXclS.js";import"./use-effective-tenant-BWuu0ab1.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-B4Zct4sF.js";import"./file-text-Dt63_vzy.js";import"./credit-card-DqGQHV60.js";import"./mail-CxIpkxxd.js";import"./shield-JlQ_48fz.js";import"./circle-alert-CphltCJl.js";import"./package-BxdLO7jd.js";import"./users-Hp18PoY4.js";import"./wallet-Rygk2Esi.js";import"./building-2-BJ5JnpgN.js";import"./chevron-right-DDsMzLk9.js";import"./sonner-Dk1iPVCY.js";import"./card-BmLtWeUg.js";import"./calendar-3eL0cqvQ.js";import"./format-Dbvp4nIN.js";import"./chevron-left-BLoEphdw.js";import"./popover-dYAbnPMd.js";import"./calendar-DYECHhff.js";import"./index-DHeuMB84.js";const le=[{title:"Loans",href:"/loans"},{title:"Edit Loan",href:"/loans/edit"}];function pt({loan:r,users:g,currencies:R,packages:P=[],payment_methods:F}){const c=ee(),[O,d]=s.useState(!1),[B,_]=s.useState(!1),[a,v]=s.useState(null),[b,u]=s.useState(""),[f,m]=s.useState(""),[j,C]=s.useState(""),[x,p]=s.useState(""),[y,h]=s.useState(""),n=t=>{v(t),u(""),m(""),p(""),h(""),d(!0)},M=()=>{if(!a)return;const t={status:a};a==="approved"?t.approval_notes=b:a==="rejected"?t.rejection_reason=f:a==="active"&&(t.payment_method_id=x,t.disbursement_transaction_id=y,t.start_date=new Date().toISOString().split("T")[0],t.end_date=new Date(Date.now()+r.duration_days*24*60*60*1e3).toISOString().split("T")[0]),c.put("loans.update-status",t,{id:r.id},{onSuccess:()=>{o.success(`Loan status updated to ${a}`),d(!1),v(null),u(""),m(""),p(""),h("")},onError:ne=>{o.error("Failed to update loan status"),d(!1),v(null),u(""),m(""),p(""),h("")}})},$=()=>{if(j!==r.reference_number){o.error("Please enter the correct loan reference number");return}c.delete("loans.destroy",{loan:r.id},{onSuccess:()=>{o.success("Loan deleted successfully"),c.visit("loans.index")},onError:()=>{o.error("Failed to delete loan")}})},U=()=>{const t=[];switch(r.status){case"pending":t.push(e.jsxs(l,{variant:"default",onClick:()=>n("approved"),className:"bg-green-600 hover:bg-green-700 cursor-pointer",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Approve Loan"]},"approve"),e.jsxs(l,{variant:"destructive",onClick:()=>n("rejected"),className:"cursor-pointer",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Reject Loan"]},"reject"));break;case"approved":t.push(e.jsxs(l,{variant:"default",onClick:()=>n("active"),className:"bg-blue-600 hover:bg-blue-700 cursor-pointer",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Activate Loan"]},"activate"));break;case"active":case"in_arrears":t.push(e.jsxs(l,{variant:"default",onClick:()=>n("paid"),className:"bg-green-600 hover:bg-green-700 cursor-pointer",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Mark as Paid"]},"mark-paid"));break}return["pending","approved","active","in_arrears"].includes(r.status)&&t.push(e.jsxs(l,{variant:"destructive",onClick:()=>n("cancelled"),className:"cursor-pointer",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Cancel Loan"]},"cancel")),t},V=[{name:"user_id",type:"select",label:"Borrower",required:!0,options:g.map(t=>({value:t.id.toString(),label:`${t.first_name} ${t.last_name}`})),defaultValue:r.user.id.toString()},{name:"package_id",type:"select",label:"Loan Package",required:!0,options:P.map(t=>({value:t.id.toString(),label:t.name})),optionLabel:"name",optionValue:"id"},{name:"amount",type:"number",label:"Loan Amount",required:!0,min:0},{name:"currency_id",type:"select",label:"Currency",required:!0,options:R.map(t=>({value:t.id.toString(),label:`${t.code} (${t.symbol})`})),optionLabel:"code",optionValue:"id"},{name:"interest_rate",type:"number",label:"Interest Rate (%)",required:!0,min:0,step:.01},{name:"interest_type",type:"select",label:"Interest Type",required:!0,options:[{value:"simple",label:"Simple"},{value:"compound",label:"Compound"}]},{name:"interest_calculation",type:"select",label:"Interest Calculation",required:!0,options:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}]},{name:"interest_payment_frequency",type:"select",label:"Payment Frequency",required:!0,options:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"biweekly",label:"Bi-weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"yearly",label:"Yearly"},{value:"end_of_term",label:"End of Term"}]},{name:"duration_days",type:"number",label:"Duration (days)",required:!0,min:1},{name:"purpose",type:"textarea",label:"Purpose",required:!1},{name:"start_date",type:"date",label:"Start Date",required:!0},{name:"end_date",type:"date",label:"End Date",required:!0},{name:"status",type:"select",label:"Status",required:!0,options:[{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"},{value:"active",label:"Active"},{value:"in_arrears",label:"In Arrears"},{value:"defaulted",label:"Defaulted"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}]}],H=g.filter(t=>t.id!==r.user.id);return e.jsxs(z,{breadcrumbs:le,children:[e.jsx(W,{title:`Edit Loan - ${r.reference_number}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y,{href:c.route("loans.index"),children:e.jsx(l,{variant:"outline",className:"cursor-pointer",children:"Cancel"})}),e.jsxs("div",{className:"flex gap-2",children:[U(),e.jsx(l,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10 cursor-pointer",onClick:()=>_(!0),children:e.jsx(te,{className:"h-4 w-4"})})]})]}),e.jsx(S,{open:O,onOpenChange:d,children:e.jsxs(D,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Confirm Status Update"}),e.jsxs(A,{children:["Are you sure you want to update this loan's status to ",a==null?void 0:a.replace("_"," ").toUpperCase(),"? This action cannot be undone."]})]}),a==="approved"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{htmlFor:"approval_notes",children:"Approval Notes"}),e.jsx(T,{id:"approval_notes",value:b,onChange:t=>u(t.target.value),placeholder:"Enter any notes about the approval...",className:"mt-1"})]}),a==="rejected"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{htmlFor:"rejection_reason",children:"Reason for Rejection"}),e.jsx(T,{id:"rejection_reason",value:f,onChange:t=>m(t.target.value),placeholder:"Enter the reason for rejection...",className:"mt-1",required:!0})]}),a==="active"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"payment_method",children:"Payment Method"}),e.jsxs(X,{value:x,onValueChange:p,required:!0,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select payment method"})}),e.jsx(K,{children:F.map(t=>e.jsx(Z,{value:String(t.id),children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"disbursement_transaction_id",children:"Disbursement Transaction ID"}),e.jsx(I,{id:"disbursement_transaction_id",value:y,onChange:t=>h(t.target.value),placeholder:"Enter disbursement transaction ID",required:!0})]})]}),e.jsxs(L,{children:[e.jsx(q,{children:"Cancel"}),e.jsx(w,{onClick:M,disabled:a==="rejected"&&!f||a==="approved"&&!b||a==="active"&&(!x||!y),children:"Confirm"})]})]})}),e.jsx(S,{open:B,onOpenChange:_,children:e.jsxs(D,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Delete Loan"}),e.jsxs(A,{children:["This action cannot be undone. This will permanently delete the loan and all associated data. To confirm, please enter the loan reference number:",e.jsx("span",{className:"font-semibold ml-1",children:r.reference_number})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{htmlFor:"delete_confirmation",children:"Loan Reference Number"}),e.jsx(I,{id:"delete_confirmation",value:j,onChange:t=>C(t.target.value),placeholder:"Enter loan reference number",className:"mt-1"})]}),e.jsxs(L,{children:[e.jsx(q,{onClick:()=>C(""),children:"Cancel"}),e.jsx(w,{onClick:$,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 cursor-pointer",disabled:j!==r.reference_number,children:"Delete Loan"})]})]})}),e.jsx(Q,{entity:r,fields:V,entityName:"loan",onSubmit:t=>{},processing:!1,errors:{},availableUsers:H})]})]})}export{pt as default};
