import{r as x,j as e,H as J,L as u,a as W}from"./app-DU4M08QO.js";import{A as Q}from"./app-layout-CWJDu2yd.js";import{B as j}from"./button-0DWS1uOF.js";import{C as g,a as N,c as k}from"./card-CIVp5v17.js";import{I as Y}from"./input-z-FCfDx3.js";import{B}from"./badge-CRsyjkeS.js";import{S as Z,a as ee,b as se,c as te,d as y}from"./select-DVGvg1wx.js";import{T as ae,a as re,b as v}from"./tabs-Z561YrE4.js";import{u as ne}from"./use-tenant-router-mhkU5Kgb.js";import{F as de,i as ie,a as le}from"./index-CyJlVsHt.js";import{t as p}from"./index-rHsITjXj.js";import{S as oe}from"./search-BFLwEg_u.js";import{P as ce}from"./plus-zMgbV9C_.js";import{L as me}from"./package-ChfYgdRA.js";import{C as ue}from"./calendar-WI8NWamZ.js";import{c as he}from"./createLucideIcon-Kjqtfux8.js";import{U as xe}from"./users-Cd4kg-Sk.js";import{F as pe}from"./folder-kanban-CgHS0FyL.js";import{C as je}from"./chevron-left-9NrEPTAz.js";import{C as fe}from"./chevron-right-CrQYE_m4.js";/* empty css            */import"./breadcrumb-BSvnjDea.js";import"./utils-DawFQoOT.js";import"./sheet-CHL5JyIf.js";import"./index-ksG8cN4f.js";import"./index-Ba8EDFfi.js";import"./index-DWOVOz5G.js";import"./index-BfArzEZR.js";import"./index-Dax8b012.js";import"./index-BuAmfKhH.js";import"./index-DVV6TkzN.js";import"./x-DVBtjuUJ.js";import"./index-CY-eh05M.js";import"./index-DdLmsglv.js";import"./index-Dy8zP7tC.js";import"./dropdown-menu-BSZHQ9yV.js";import"./index-C31rQuzh.js";import"./index-ELRl1PxQ.js";import"./check-CljcYcVc.js";import"./chevron-down-DOpVs1Mm.js";import"./skeleton-DeAfgcQK.js";import"./use-effective-tenant-6xYuTafE.js";import"./trash-2-C9dHTECi.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-tVN0-8fp.js";import"./file-text-BaK0CXIP.js";import"./dollar-sign-DzSGN3WH.js";import"./credit-card-CRs7L-78.js";import"./mail-CwNPBuud.js";import"./shield-IA8j3DE0.js";import"./circle-alert-CvqXQmI-.js";import"./wallet-CqZJpKq_.js";import"./building-2-CdICHkKN.js";import"./sonner-Dh23Qk9O.js";import"./index-sRFl2c6N.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Ne=he("Columns3",ge),ke=[{key:"todo",label:"To do"},{key:"in_progress",label:"In progress"},{key:"done",label:"Done"},{key:"cancelled",label:"Cancelled"}];function w(d){var o;return(o=d.assignee)!=null&&o.user&&`${d.assignee.user.first_name||""} ${d.assignee.user.last_name||""}`.trim()||"—"}function ys({tasks:d,allTasks:o,staffOptions:L,projectOptions:A,filters:c,tasksView:q="all",currentStaffId:_=null,canManageAnyTask:C=!1}){const n=ne(),i=c.view||"table",[V,U]=x.useState(()=>o??[]);x.useEffect(()=>{i==="board"&&o&&U(o)},[i,o]);const f=i==="board"?V:o??[],I=s=>{var t;return _!=null&&((t=s.assignee)==null?void 0:t.id)===_},R=s=>C,S=s=>C||I(s),O=[{title:"HR",href:n.route("hr.staff.index")},{title:"Tasks",href:n.route("hr.tasks.index")}],z=s=>{n.get("hr.tasks.index",{...c,view:s,page:void 0})},D=x.useMemo(()=>(o??[]).filter(s=>s.due_at).map(s=>({id:String(s.id),title:s.title,start:s.due_at,allDay:!1,extendedProps:{taskUuid:s.uuid,status:s.status}})),[o]),[X,P]=x.useState(D);x.useEffect(()=>{P(D)},[D]);const $=s=>{const t=s.event.extendedProps.taskUuid;t&&W.visit(n.route("hr.tasks.show",{task:t}))},K=async s=>{var b;const t=s.event.extendedProps.taskUuid,a=s.event.start;if(!t||!a){s.revert();return}if(!(o==null?void 0:o.find(m=>m.uuid===t))||!R()){s.revert(),p.error("Only admins can reschedule tasks.");return}const l=a.toISOString(),h=n.route("hr.tasks.update-due",{task:t}),H=((b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.content)??"";try{const m=await fetch(h,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":H,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({due_at:l})});if(!m.ok){s.revert();const T=await m.json().catch(()=>({}));p.error(T.message??"Failed to update due date.");return}P(T=>T.map(E=>E.id===s.event.id?{...E,start:l}:E)),p.success("Due date updated.")}catch{s.revert(),p.error("Network error.")}},G=async(s,t)=>{var l;const a=((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)??"",r=n.route("hr.tasks.update-status",{task:s});try{const h=await fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({status:t})});if(!h.ok){p.error("Failed to update status");return}const H=await h.json();U(b=>b.map(m=>m.uuid===s?{...m,status:t,completed_at:t==="done"?new Date().toISOString():null}:m)),p.success("Status updated")}catch{p.error("Network error")}},F=x.useMemo(()=>{const s=new Map;return s.set("unassigned",{name:"Unassigned",tasks:[]}),L.forEach(t=>s.set(t.id,{name:t.name,tasks:[]})),f.forEach(t=>{var l;const a=((l=t.assignee)==null?void 0:l.id)??null,r=a!=null?s.get(a):s.get("unassigned");r?r.tasks.push(t):a!=null?s.set(a,{name:w(t),tasks:[t]}):s.get("unassigned").tasks.push(t)}),Array.from(s.entries()).filter(([,t])=>t.tasks.length>0||t.name==="Unassigned")},[f,L]),M=x.useMemo(()=>{const s=new Map;return s.set("none",{name:"No project",tasks:[]}),A.forEach(t=>s.set(t.id,{name:t.name,tasks:[]})),f.forEach(t=>{var l,h;const a=((l=t.project)==null?void 0:l.id)??"none",r=s.get(a);r?r.tasks.push(t):s.set(a,{name:((h=t.project)==null?void 0:h.name)??"No project",tasks:[t]})}),Array.from(s.entries()).filter(([,t])=>t.tasks.length>0)},[f,A]);return e.jsxs(Q,{breadcrumbs:O,children:[e.jsx(J,{title:"HR – Tasks"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Tasks"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("form",{className:"flex gap-2",onSubmit:s=>{var a;s.preventDefault();const t=(a=s.currentTarget.querySelector('input[name="search"]'))==null?void 0:a.value;n.get("hr.tasks.index",{search:t||void 0,...c,view:i})},children:[e.jsx(Y,{name:"search",placeholder:"Search...",defaultValue:c.search||"",className:"max-w-xs"}),e.jsx(j,{type:"submit",variant:"secondary",size:"icon",children:e.jsx(oe,{className:"h-4 w-4"})})]}),(i==="table"||i==="board"||i==="by_staff"||i==="by_project")&&e.jsxs(Z,{value:c.show_completed||"active",onValueChange:s=>{n.get("hr.tasks.index",{...c,show_completed:s==="active"?void 0:s,view:i,page:void 0})},children:[e.jsx(ee,{className:"w-[180px]",children:e.jsx(se,{placeholder:"Show completed"})}),e.jsxs(te,{children:[e.jsx(y,{value:"active",children:"Active only"}),e.jsx(y,{value:"last_month",children:"+ Completed (last month)"}),e.jsx(y,{value:"last_3_months",children:"+ Completed (last 3 months)"}),e.jsx(y,{value:"all",children:"All time"})]})]}),(q==="all"||_!=null)&&e.jsx(j,{asChild:!0,children:e.jsxs(u,{href:n.route("hr.tasks.create"),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"New task"]})})]})]}),e.jsxs(ae,{value:i,onValueChange:s=>z(s),children:[e.jsxs(re,{className:"grid w-full max-w-lg grid-cols-5",children:[e.jsxs(v,{value:"table",className:"gap-1.5",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Table"})]}),e.jsxs(v,{value:"calendar",className:"gap-1.5",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Calendar"})]}),e.jsxs(v,{value:"board",className:"gap-1.5",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Board"})]}),e.jsxs(v,{value:"by_staff",className:"gap-1.5",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"By staff"})]}),e.jsxs(v,{value:"by_project",className:"gap-1.5",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"By project"})]})]}),e.jsxs("div",{className:"mt-4",children:[i==="table"&&e.jsxs(g,{children:[e.jsx(N,{children:e.jsx("h2",{className:"text-lg font-medium",children:"All tasks"})}),e.jsx(k,{children:!d||d.data.length===0?e.jsx("p",{className:"text-muted-foreground py-8 text-center",children:"No tasks yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"Title"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Project"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Assignee"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Due"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Blocked by"}),e.jsx("th",{className:"p-3 text-right font-medium"})]})}),e.jsx("tbody",{children:d.data.map(s=>{var t;return e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"p-3",children:s.title}),e.jsx("td",{className:"p-3",children:((t=s.project)==null?void 0:t.name)??"—"}),e.jsx("td",{className:"p-3",children:w(s)}),e.jsx("td",{className:"p-3",children:e.jsx(B,{variant:s.status==="done"?"secondary":"default",children:s.status})}),e.jsx("td",{className:"p-3",children:s.due_at?new Date(s.due_at).toLocaleDateString():"—"}),e.jsx("td",{className:"p-3",children:s.blocked_by_task?e.jsx(u,{href:n.route("hr.tasks.show",{task:s.blocked_by_task.uuid}),className:"text-amber-600 dark:text-amber-400 hover:underline text-sm",children:s.blocked_by_task.title}):"—"}),e.jsxs("td",{className:"p-3 text-right",children:[e.jsx(j,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(u,{href:n.route("hr.tasks.show",{task:s.uuid}),children:"View"})}),R()&&e.jsx(j,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(u,{href:n.route("hr.tasks.edit",{task:s.uuid}),children:"Edit"})})]})]},s.id)})})]})}),d.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",d.current_page," of ",d.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",disabled:d.current_page<=1,onClick:()=>n.get("hr.tasks.index",{...c,view:"table",page:d.current_page-1}),children:[e.jsx(je,{className:"h-4 w-4"})," Previous"]}),e.jsxs(j,{variant:"outline",size:"sm",disabled:d.current_page>=d.last_page,onClick:()=>n.get("hr.tasks.index",{...c,view:"table",page:d.current_page+1}),children:["Next ",e.jsx(fe,{className:"h-4 w-4"})]})]})]})]})})]}),i==="calendar"&&e.jsxs(g,{children:[e.jsxs(N,{children:[e.jsx("h2",{className:"text-lg font-medium",children:"Tasks by due date"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Tasks with a due date appear on the calendar. Click an event to open the task."})]}),e.jsx(k,{children:e.jsx("div",{className:"hr-tasks-calendar",children:e.jsx(de,{plugins:[ie,le],initialView:"dayGridMonth",events:X,editable:C,eventClick:$,eventDrop:K,height:"auto",dayMaxEvents:!0,displayEventTime:!1})})})]}),i==="board"&&e.jsxs(g,{children:[e.jsxs(N,{children:[e.jsx("h2",{className:"text-lg font-medium",children:"Board"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Drag cards between columns to update status."})]}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:ke.map(s=>{const t=f.filter(a=>a.status===s.key);return e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-3",onDragOver:a=>a.preventDefault(),onDrop:a=>{a.preventDefault();const r=a.dataTransfer.getData("taskUuid");r&&s.key&&G(r,s.key)},children:[e.jsxs("h3",{className:"mb-2 font-medium",children:[s.label," ",e.jsxs("span",{className:"text-muted-foreground",children:["(",t.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:t.map(a=>e.jsxs("div",{draggable:S(a),onDragStart:r=>{S(a)&&(r.dataTransfer.setData("taskUuid",a.uuid),r.dataTransfer.effectAllowed="move")},className:`rounded border bg-background p-3 shadow-sm ${S(a)?"cursor-grab active:cursor-grabbing":""}`,children:[e.jsx(u,{href:n.route("hr.tasks.show",{task:a.uuid}),className:"font-medium hover:underline",onClick:r=>r.stopPropagation(),children:a.title}),e.jsxs("p",{className:"mt-1 text-muted-foreground text-xs",children:[w(a),a.due_at?` · Due ${new Date(a.due_at).toLocaleDateString()}`:""]}),a.blocked_by_task&&e.jsxs("p",{className:"mt-1 text-xs text-amber-600 dark:text-amber-400",children:["Blocked by: ",e.jsx(u,{href:n.route("hr.tasks.show",{task:a.blocked_by_task.uuid}),className:"hover:underline",children:a.blocked_by_task.title})]})]},a.id))})]},s.key)})})})]}),i==="by_staff"&&e.jsxs(g,{children:[e.jsxs(N,{children:[e.jsx("h2",{className:"text-lg font-medium",children:"By staff"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Tasks grouped by assignee."})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[F.map(([s,{name:t,tasks:a}])=>e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium text-muted-foreground",children:t}),e.jsx("ul",{className:"space-y-2",children:a.map(r=>{var l;return e.jsxs("li",{className:"flex items-center justify-between rounded border p-3",children:[e.jsxs("div",{children:[e.jsx(u,{href:n.route("hr.tasks.show",{task:r.uuid}),className:"font-medium hover:underline",children:r.title}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:[((l=r.project)==null?void 0:l.name)??"—"," · ",r.due_at?new Date(r.due_at).toLocaleDateString():"No due date"]})]}),e.jsx(B,{variant:r.status==="done"?"secondary":"default",children:r.status})]},r.id)})})]},String(s))),F.length===0&&e.jsx("p",{className:"text-muted-foreground py-8 text-center",children:"No tasks to group."})]})})]}),i==="by_project"&&e.jsxs(g,{children:[e.jsxs(N,{children:[e.jsx("h2",{className:"text-lg font-medium",children:"By project"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Tasks grouped by project."})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[M.map(([s,{name:t,tasks:a}])=>e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium text-muted-foreground",children:t}),e.jsx("ul",{className:"space-y-2",children:a.map(r=>e.jsxs("li",{className:"flex items-center justify-between rounded border p-3",children:[e.jsxs("div",{children:[e.jsx(u,{href:n.route("hr.tasks.show",{task:r.uuid}),className:"font-medium hover:underline",children:r.title}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:[w(r)," · ",r.due_at?new Date(r.due_at).toLocaleDateString():"No due date"]})]}),e.jsx(B,{variant:r.status==="done"?"secondary":"default",children:r.status})]},r.id))})]},String(s))),M.length===0&&e.jsx("p",{className:"text-muted-foreground py-8 text-center",children:"No tasks to group."})]})})]})]})]})]})}),e.jsx("style",{children:`
                .hr-tasks-calendar .fc-daygrid-event { white-space: normal; }
                .hr-tasks-calendar .fc-event-title { font-size: 0.75rem; }
            `})]})}export{ys as default};
