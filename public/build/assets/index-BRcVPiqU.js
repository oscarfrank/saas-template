import{r as o,a as P,j as s,L as y,N as j,H as me}from"./app-Bw_eO3sd.js";import{A as ce}from"./app-layout-BSIvknne.js";import{B as D}from"./button-DY2O9S9G.js";import{u as U}from"./use-tenant-router-BPEgyWCx.js";import{D as pe}from"./data-table-DpDxh3V5.js";import{t as x}from"./index-De6LdJTA.js";import{C as Z}from"./custom-alert-dialog-BYzOmq9i.js";import{D as he,a as we,b as Ce,c as E,d as Se}from"./dropdown-menu-eFqcjt66.js";import{C as ee}from"./checkbox-5NUexb-C.js";import{E as Pe}from"./eye-BVuaZ7bM.js";import{E as xe}from"./ellipsis-Ch7a2J_A.js";import{P as be}from"./pencil-BBZRpxMO.js";import{C as ve}from"./copy-9_qN9k6W.js";import{S as je}from"./share-2-Dtd47koy.js";import{T as ye}from"./trash-2-CEE_VqOF.js";import{f as De}from"./utils-DawFQoOT.js";import{P as ke}from"./plus-CgfQg4Kz.js";/* empty css            */import"./breadcrumb-C2sRCkcu.js";import"./input-Bmbc7aO-.js";import"./sheet-CmXTK4FQ.js";import"./index-ByXzH8er.js";import"./index-BUUDosUt.js";import"./index-CVZ3wJAA.js";import"./index-fLpoMwuJ.js";import"./index-CtNM4qhv.js";import"./index-NSo7goI1.js";import"./index-KPETvMeP.js";import"./x-BbsTXzvW.js";import"./createLucideIcon-B9LDe1F7.js";import"./index-V7Tq7z7Y.js";import"./index-VORSUaQ4.js";import"./index-U92boKRB.js";import"./chevron-down-1laKfkfM.js";import"./skeleton-COevZx66.js";import"./use-effective-tenant-DB7mi6AU.js";import"./check-DWqh-ITp.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-DQDpUZmM.js";import"./file-text-DPljHKaA.js";import"./dollar-sign-BdaYzWQe.js";import"./credit-card-8AiVb87_.js";import"./mail-FVHvQLZC.js";import"./shield-BPzbhB4h.js";import"./circle-alert-BvybSHRd.js";import"./package-D6uMvGvA.js";import"./users-BpArtZsm.js";import"./wallet-Cnkdu3fg.js";import"./building-2-DJOAXm0m.js";import"./chevron-right-BXZknpZE.js";import"./sonner--M2gOl5q.js";import"./index-BUXCvpGi.js";import"./table-lR01Ael5.js";import"./select-BGKBtYvv.js";import"./index-Bt6kV37t.js";import"./index-2GXxL6M4.js";import"./badge-DPU-7Oq6.js";import"./popover-Ch2yF9di.js";import"./file-json-BeiXL6jk.js";import"./printer-C3RXsJt5.js";import"./download-DsxiZaT_.js";import"./arrow-up-Bm1INFlp.js";import"./arrow-up-down-DM_US_--.js";import"./chevron-left-Co4h3CpG.js";import"./index-BG0SbQBQ.js";function Le({config:e}){var z,q;console.log("UltimateTable render",{configName:e.name,dataLength:e.data.length,pagination:e.pagination});const i=U(),[d,l]=o.useState(!1),[w,c]=o.useState(null),[re,f]=o.useState(!1),[b,_]=o.useState(null),[te,A]=o.useState(!1),[I,g]=o.useState([]),[m,se]=o.useState(""),[p,le]=o.useState(null),[S,$]=o.useState(((z=e.pagination)==null?void 0:z.current_page)??1),[u,oe]=o.useState(((q=e.pagination)==null?void 0:q.per_page)??10),T=o.useRef(!0),v=o.useRef({lastSearch:m,lastSort:p,lastPage:S,lastPerPage:u}),L=o.useMemo(()=>({isLoading:d,error:w,lastSearch:m,lastSort:p,lastPage:S,lastPerPage:u}),[d,w,m,p,S,u]);o.useEffect(()=>{if(T.current){T.current=!1,v.current=L;return}(v.current.lastSearch!==m||v.current.lastSort!==p||v.current.lastPage!==S||v.current.lastPerPage!==u)&&(console.log("UltimateTable state changed",L),v.current=L)},[L,m,p,S,u]);const B=o.useCallback(a=>{_(a),f(!0)},[]),ne=o.useCallback(async()=>{var a,r;if(!(!b||!((a=e.api)!=null&&a.deleteUrl))){l(!0);try{await P.delete(e.api.deleteUrl(b.id),{preserveState:!0,preserveScroll:!0}),x.success(`${e.name} deleted successfully`),f(!1),_(null),P.reload({only:[e.name.toLowerCase(),"pagination"],onSuccess:()=>{var t;l(!1),(t=e.onDeleteSuccess)==null||t.call(e)},onError:t=>{var n;l(!1),x.error("Failed to refresh data after deletion"),(n=e.onDeleteError)==null||n.call(e,t)}})}catch(t){x.error(`Failed to delete ${e.name.toLowerCase()}`),l(!1),(r=e.onDeleteError)==null||r.call(e,t)}}},[b,e]),M=o.useCallback(a=>{g(a),A(!0)},[]),ie=o.useCallback(async()=>{var a,r;if((a=e.api)!=null&&a.deleteUrl){l(!0);try{for(const t of I)await P.delete(e.api.deleteUrl(t.id),{preserveState:!0,preserveScroll:!0});x.success(`Selected ${e.name.toLowerCase()} deleted successfully`),A(!1),g([]),P.reload({only:[e.name.toLowerCase(),"pagination"],onSuccess:()=>{var t;l(!1),(t=e.onDeleteSuccess)==null||t.call(e)},onError:t=>{var n;l(!1),x.error("Failed to refresh data after deletion"),(n=e.onDeleteError)==null||n.call(e,t)}})}catch(t){x.error(`Failed to delete some ${e.name.toLowerCase()}`),l(!1),(r=e.onDeleteError)==null||r.call(e,t)}}},[I,e]),F=o.useCallback(a=>{var r;console.log("handlePageChange called",{page:a,lastPage:S}),!(!((r=e.api)!=null&&r.baseUrl)||a===S)&&(Promise.resolve().then(()=>{l(!0),c(null),$(a)}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.pageParam||"page"]:a,[e.api.perPageParam||"per_page"]:u},onSuccess:()=>{l(!1)},onError:t=>{l(!1),c("Failed to load data. Please try again.")}}))},[e.api,e.name,S,u]),R=o.useCallback((a,r)=>{var t;console.log("handleSortChange called",{sort:a,direction:r,lastSort:p}),(t=e.api)!=null&&t.baseUrl&&(p&&p.id===a&&p.direction===r||(Promise.resolve().then(()=>{l(!0),c(null),le({id:a,direction:r})}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.sortParam||"sort"]:a,[e.api.directionParam||"direction"]:r,[e.api.perPageParam||"per_page"]:u},onSuccess:()=>{l(!1)},onError:n=>{l(!1),c("Failed to load data. Please try again.")}})))},[e.api,e.name,p,u]),H=o.useCallback(a=>{var h;if(console.log("handleSearchChange called",{search:a,lastSearch:m}),!((h=e.api)!=null&&h.baseUrl))return;Promise.resolve().then(()=>{l(!0),c(null),se(a)});const r=new URLSearchParams(window.location.search),t={},n=e.api.searchParam||"search";r.forEach((C,k)=>{k!==n&&(t[k]=C)}),a&&(t[n]=a),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:t,onSuccess:()=>{l(!1)},onError:C=>{l(!1),c("Failed to load data. Please try again.")}})},[e.api,e.name]),V=o.useCallback(a=>{var r;(r=e.api)!=null&&r.baseUrl&&a!==m&&H(a)},[e.api,m,H]),K=o.useCallback(a=>{var r;console.log("handlePerPageChange called",{perPage:a,lastPerPage:u}),!(!((r=e.api)!=null&&r.baseUrl)||a===u)&&(Promise.resolve().then(()=>{l(!0),c(null),oe(a),$(1)}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.perPageParam||"per_page"]:a,[e.api.pageParam||"page"]:1,...m?{[e.api.searchParam||"search"]:m}:{}},onSuccess:()=>{l(!1)},onError:t=>{l(!1),c("Failed to load data. Please try again.")}}))},[e.api,e.name,u,m]),N=o.useMemo(()=>{var a;return[...((a=e.features)==null?void 0:a.selection)!==!1?[{id:"select",header:({table:r})=>s.jsx(ee,{checked:r.getIsAllPageRowsSelected(),onCheckedChange:t=>r.toggleAllPageRowsSelected(!!t),"aria-label":"Select all"}),cell:({row:r})=>s.jsx(ee,{checked:r.getIsSelected(),onCheckedChange:t=>r.toggleSelected(!!t),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1}]:[],...e.columns.map(r=>{const t={id:r.id,accessorKey:r.accessorKey,header:r.header,enableSorting:r.enableSorting??!0,enableHiding:r.enableHiding??!0};return r.cell?{...t,cell:r.cell}:{...t,cell:({row:n})=>{const h=n.getValue(r.accessorKey);if(r.link){const C=e.routeParam||e.name.toLowerCase().slice(0,-1);return s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[C]:n.original.id}),className:"font-medium hover:underline cursor-pointer",children:String(h)})}return s.jsx("div",{children:String(h)})}}}),{id:"actions",header:"Actions",cell:({row:r})=>{var k,G,J,Q,W,X,Y;const t=r.original,n=e.routeParam||e.name.toLowerCase().slice(0,-1),h=()=>{navigator.clipboard.writeText(String(t.id)),x.success(`${e.name} ID copied to clipboard`)},C=()=>{const de=i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id});navigator.clipboard.writeText(de),x.success(`${e.name} URL copied to clipboard`)};return s.jsxs("div",{className:"flex items-center gap-2",children:[((k=e.actions)==null?void 0:k.showViewIcon)!==!1&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"icon",className:"cursor-pointer",children:s.jsx(Pe,{className:"h-4 w-4"})})}),((G=e.actions)==null?void 0:G.showViewButton)&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"sm",children:"View"})}),((J=e.actions)==null?void 0:J.showEditButton)&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.edit`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"sm",children:"Edit"})}),((Q=e.actions)==null?void 0:Q.showDeleteButton)&&s.jsx(D,{variant:"outline",size:"sm",onClick:()=>B(t),className:"text-destructive",children:"Delete"}),((W=e.actions)==null?void 0:W.showMoreMenu)!==!1&&s.jsxs(he,{children:[s.jsx(we,{asChild:!0,children:s.jsx(D,{variant:"outline",size:"icon",className:"cursor-pointer",children:s.jsx(xe,{className:"h-4 w-4"})})}),s.jsxs(Ce,{align:"end",children:[s.jsx(E,{asChild:!0,children:s.jsxs(y,{href:i.route(`${e.name.toLowerCase()}.edit`,{[n]:t.id}),className:"cursor-pointer",children:[s.jsx(be,{className:"mr-2 h-4 w-4"}),"Edit ",e.name]})}),((X=e.actions)==null?void 0:X.showCopyId)!==!1&&s.jsxs(E,{onClick:h,className:"cursor-pointer",children:[s.jsx(ve,{className:"mr-2 h-4 w-4"}),"Copy ID"]}),((Y=e.actions)==null?void 0:Y.showShare)!==!1&&s.jsxs(E,{onClick:C,className:"cursor-pointer",children:[s.jsx(je,{className:"mr-2 h-4 w-4"}),"Share ",e.name]}),s.jsx(Se,{}),s.jsxs(E,{onClick:()=>B(t),className:"text-destructive cursor-pointer",children:[s.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete ",e.name]})]})]})]})}}]},[e,i,B]),O=o.useMemo(()=>e.printConfig||{title:`${e.name} List`,columns:N.filter(a=>a.id!=="select"&&a.id!=="actions").map(a=>({header:String(a.header),accessor:a.id||"",format:r=>String(r)}))},[e,N]),ue=o.useMemo(()=>{var a,r,t,n,h,C;return{columns:N,data:e.data,searchPlaceholder:e.searchPlaceholder,searchColumns:e.searchColumns,showSearch:((a=e.features)==null?void 0:a.search)!==!1,showExport:((r=e.features)==null?void 0:r.export)!==!1,showFilters:((t=e.features)==null?void 0:t.filters)!==!1,showPagination:((n=e.features)==null?void 0:n.pagination)!==!1,showPrint:((h=e.features)==null?void 0:h.print)!==!1,showBulkActions:((C=e.features)==null?void 0:C.bulkActions)!==!1,bulkActions:e.bulkActions,onBulkDelete:M,onBulkArchive:e.onBulkArchive,resetSelection:!0,pagination:e.pagination,onPageChange:F,onSortChange:R,onSearchChange:V,onPerPageChange:K,isLoading:d,error:w??void 0,tableName:e.name,printConfig:O}},[N,e.data,e.searchPlaceholder,e.searchColumns,e.features,e.bulkActions,e.onBulkArchive,e.pagination,e.name,M,F,R,V,K,d,w,O]);return s.jsxs(s.Fragment,{children:[s.jsx(pe,{...ue}),s.jsx(Z,{isOpen:re,onClose:()=>f(!1),onConfirm:ne,title:"Are you sure?",description:`This action cannot be undone. This will permanently delete the ${e.name.toLowerCase()} "${b==null?void 0:b.name}".`,isLoading:d}),s.jsx(Z,{isOpen:te,onClose:()=>{A(!1),g([])},onConfirm:ie,title:"Are you sure?",description:`This action cannot be undone. This will permanently delete ${I.length} selected ${e.name.toLowerCase()}(s).`,confirmText:"Delete Selected",isLoading:d})]})}const ae=(e,i)=>{const d=U();return{name:"Products",routeParam:"product",data:e,columns:[{id:"name",accessorKey:"name",header:"Name",enableSorting:!0,enableHiding:!0,link:!0},{id:"description",accessorKey:"description",header:"Description",enableSorting:!0,enableHiding:!0,cell:({row:l})=>j.createElement("div",{className:"max-w-[300px] truncate"},l.getValue("description"))},{id:"price",accessorKey:"price",header:"Price",enableSorting:!0,enableHiding:!0,cell:({row:l})=>{const w=parseFloat(l.getValue("price"));return j.createElement("div",{className:"font-medium"},De(w))}},{id:"featured_image",accessorKey:"featured_image",header:"Image",enableSorting:!1,enableHiding:!0,cell:({row:l})=>{const w=l.getValue("featured_image"),c=l.original.featured_image_original_name;return w?j.createElement("div",{className:"relative h-10 w-10"},j.createElement("img",{src:w,alt:c||"Product image",className:"h-full w-full rounded-md object-cover"})):j.createElement("div",{className:"text-muted-foreground"},"No image")}},{id:"created_at",accessorKey:"created_at",header:"Created At",enableSorting:!0,enableHiding:!0,cell:({row:l})=>j.createElement("div",{},new Date(l.getValue("created_at")).toLocaleDateString())}],searchColumns:["name","description"],searchPlaceholder:"Search products...",features:{search:!0,selection:!0,bulkActions:!0,export:!1,print:!1,filters:!0,pagination:!0},actions:{showViewIcon:!0,showViewButton:!1,showEditButton:!1,showDeleteButton:!1,showMoreMenu:!0,showCopyId:!0,showShare:!0},api:{baseUrl:d.route("products.index"),searchParam:"search",sortParam:"sort",directionParam:"direction",pageParam:"page",perPageParam:"per_page",deleteUrl:l=>d.route("products.destroy",{product:l})},exportConfig:{showCsv:!0,showJson:!0,showPrint:!0,filename:"products"},pagination:i}},Ne=[{title:"Products",href:"/products"}];function Ra({products:e,pagination:i}){const d=U(),l={...ae(e,i),api:{...ae(e,i).api,baseUrl:window.location.pathname,preserveState:["notifications","tenant","preferences"]}};return s.jsxs(ce,{breadcrumbs:Ne,children:[s.jsx(me,{title:"Products Management"}),s.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"flex gap-2"}),s.jsx(y,{href:d.route("products.create"),children:s.jsxs(D,{className:"cursor-pointer",children:[s.jsx(ke,{className:"mr-2 h-4 w-4"}),"Add Product"]})})]}),s.jsx(Le,{config:l})]})]})}export{Ra as default};
