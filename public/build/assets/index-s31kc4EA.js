import{r as o,a as P,j as s,L as y,N as j,H as me}from"./app-CMfsqCQM.js";import{A as ce}from"./app-layout-DWW7ov8A.js";import{B as D}from"./button-B2dnQCAa.js";import{u as U}from"./use-tenant-router-ECVXs2qr.js";import{D as pe}from"./data-table-75yhiJcY.js";import{t as x}from"./index-q8lzB8Tn.js";import{C as Z}from"./custom-alert-dialog-DyYeCpZY.js";import{D as he,a as we,b as Ce,c as E,d as Se}from"./dropdown-menu-D-TuDDeo.js";import{C as ee}from"./checkbox-BuKLpctU.js";import{E as Pe}from"./eye-CBsOHp1B.js";import{E as xe}from"./ellipsis-Cqq0Icdz.js";import{P as be}from"./pencil-BoQS6W4i.js";import{C as ve}from"./copy-BYVWoPMP.js";import{S as je}from"./share-2-CKbAbRjO.js";import{T as ye}from"./trash-2-C6bUCbz1.js";import{f as De}from"./utils-DawFQoOT.js";import{P as ke}from"./plus-DHmSJ9Ej.js";/* empty css            */import"./breadcrumb-UVH0om7h.js";import"./input-Bpdo4m0L.js";import"./sheet-CwGP68Z_.js";import"./index-Dsoa9CjY.js";import"./index-xqWKCSYm.js";import"./index-BeUfNboo.js";import"./index-DYM8iIys.js";import"./index-NxXi0nlY.js";import"./index-DCzB2KT7.js";import"./index-jjTweGYJ.js";import"./x-Cu70FuQ4.js";import"./createLucideIcon-DV9StWnM.js";import"./index-BrOQlPGX.js";import"./index-C5ERfWkd.js";import"./index-CmYx4CDV.js";import"./file-text-ZIm8Me-N.js";import"./users-nX7eRmms.js";import"./package-BK_e8Gd3.js";import"./wallet-D3VF3ET3.js";import"./chevron-down-uDeEpgqx.js";import"./skeleton-BM9JAt9Z.js";import"./use-effective-tenant-FNx9T5uV.js";import"./check-KdCJQoSn.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-Bt6Fbven.js";import"./dollar-sign-Cvub9wzG.js";import"./credit-card-BIZzkTvA.js";import"./mail-CyHnWLIa.js";import"./shield-BxhzRHW9.js";import"./circle-alert-DbZArJmq.js";import"./building-2-CraT7Xwf.js";import"./chevron-right-DPdqOnta.js";import"./sonner-DSzJt1Z7.js";import"./index-3ZfaH849.js";import"./table-4R1BSENb.js";import"./select-CAt556DM.js";import"./index-DJMkznTg.js";import"./index-CSp-ZSgT.js";import"./badge-OOYS7ox8.js";import"./popover-CWcu33yS.js";import"./file-json-CBOsNMHR.js";import"./printer-Bf11cd68.js";import"./download-CPY3cAX4.js";import"./arrow-up-ftm_o6la.js";import"./arrow-up-down-DibDNY1b.js";import"./chevron-left-BlVDFTUH.js";import"./index-BDWLcZMo.js";function Le({config:e}){var z,q;console.log("UltimateTable render",{configName:e.name,dataLength:e.data.length,pagination:e.pagination});const i=U(),[d,l]=o.useState(!1),[w,c]=o.useState(null),[re,f]=o.useState(!1),[b,_]=o.useState(null),[te,A]=o.useState(!1),[I,g]=o.useState([]),[m,se]=o.useState(""),[p,le]=o.useState(null),[S,$]=o.useState(((z=e.pagination)==null?void 0:z.current_page)??1),[u,oe]=o.useState(((q=e.pagination)==null?void 0:q.per_page)??10),T=o.useRef(!0),v=o.useRef({lastSearch:m,lastSort:p,lastPage:S,lastPerPage:u}),L=o.useMemo(()=>({isLoading:d,error:w,lastSearch:m,lastSort:p,lastPage:S,lastPerPage:u}),[d,w,m,p,S,u]);o.useEffect(()=>{if(T.current){T.current=!1,v.current=L;return}(v.current.lastSearch!==m||v.current.lastSort!==p||v.current.lastPage!==S||v.current.lastPerPage!==u)&&(console.log("UltimateTable state changed",L),v.current=L)},[L,m,p,S,u]);const B=o.useCallback(a=>{_(a),f(!0)},[]),ne=o.useCallback(async()=>{var a,r;if(!(!b||!((a=e.api)!=null&&a.deleteUrl))){l(!0);try{await P.delete(e.api.deleteUrl(b.id),{preserveState:!0,preserveScroll:!0}),x.success(`${e.name} deleted successfully`),f(!1),_(null),P.reload({only:[e.name.toLowerCase(),"pagination"],onSuccess:()=>{var t;l(!1),(t=e.onDeleteSuccess)==null||t.call(e)},onError:t=>{var n;l(!1),x.error("Failed to refresh data after deletion"),(n=e.onDeleteError)==null||n.call(e,t)}})}catch(t){x.error(`Failed to delete ${e.name.toLowerCase()}`),l(!1),(r=e.onDeleteError)==null||r.call(e,t)}}},[b,e]),M=o.useCallback(a=>{g(a),A(!0)},[]),ie=o.useCallback(async()=>{var a,r;if((a=e.api)!=null&&a.deleteUrl){l(!0);try{for(const t of I)await P.delete(e.api.deleteUrl(t.id),{preserveState:!0,preserveScroll:!0});x.success(`Selected ${e.name.toLowerCase()} deleted successfully`),A(!1),g([]),P.reload({only:[e.name.toLowerCase(),"pagination"],onSuccess:()=>{var t;l(!1),(t=e.onDeleteSuccess)==null||t.call(e)},onError:t=>{var n;l(!1),x.error("Failed to refresh data after deletion"),(n=e.onDeleteError)==null||n.call(e,t)}})}catch(t){x.error(`Failed to delete some ${e.name.toLowerCase()}`),l(!1),(r=e.onDeleteError)==null||r.call(e,t)}}},[I,e]),F=o.useCallback(a=>{var r;console.log("handlePageChange called",{page:a,lastPage:S}),!(!((r=e.api)!=null&&r.baseUrl)||a===S)&&(Promise.resolve().then(()=>{l(!0),c(null),$(a)}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.pageParam||"page"]:a,[e.api.perPageParam||"per_page"]:u},onSuccess:()=>{l(!1)},onError:t=>{l(!1),c("Failed to load data. Please try again.")}}))},[e.api,e.name,S,u]),R=o.useCallback((a,r)=>{var t;console.log("handleSortChange called",{sort:a,direction:r,lastSort:p}),(t=e.api)!=null&&t.baseUrl&&(p&&p.id===a&&p.direction===r||(Promise.resolve().then(()=>{l(!0),c(null),le({id:a,direction:r})}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.sortParam||"sort"]:a,[e.api.directionParam||"direction"]:r,[e.api.perPageParam||"per_page"]:u},onSuccess:()=>{l(!1)},onError:n=>{l(!1),c("Failed to load data. Please try again.")}})))},[e.api,e.name,p,u]),H=o.useCallback(a=>{var h;if(console.log("handleSearchChange called",{search:a,lastSearch:m}),!((h=e.api)!=null&&h.baseUrl))return;Promise.resolve().then(()=>{l(!0),c(null),se(a)});const r=new URLSearchParams(window.location.search),t={},n=e.api.searchParam||"search";r.forEach((C,k)=>{k!==n&&(t[k]=C)}),a&&(t[n]=a),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:t,onSuccess:()=>{l(!1)},onError:C=>{l(!1),c("Failed to load data. Please try again.")}})},[e.api,e.name]),V=o.useCallback(a=>{var r;(r=e.api)!=null&&r.baseUrl&&a!==m&&H(a)},[e.api,m,H]),K=o.useCallback(a=>{var r;console.log("handlePerPageChange called",{perPage:a,lastPerPage:u}),!(!((r=e.api)!=null&&r.baseUrl)||a===u)&&(Promise.resolve().then(()=>{l(!0),c(null),oe(a),$(1)}),P.visit(window.location.pathname,{only:[e.name.toLowerCase(),"pagination"],preserveState:!0,preserveScroll:!0,data:{[e.api.perPageParam||"per_page"]:a,[e.api.pageParam||"page"]:1,...m?{[e.api.searchParam||"search"]:m}:{}},onSuccess:()=>{l(!1)},onError:t=>{l(!1),c("Failed to load data. Please try again.")}}))},[e.api,e.name,u,m]),N=o.useMemo(()=>{var a;return[...((a=e.features)==null?void 0:a.selection)!==!1?[{id:"select",header:({table:r})=>s.jsx(ee,{checked:r.getIsAllPageRowsSelected(),onCheckedChange:t=>r.toggleAllPageRowsSelected(!!t),"aria-label":"Select all"}),cell:({row:r})=>s.jsx(ee,{checked:r.getIsSelected(),onCheckedChange:t=>r.toggleSelected(!!t),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1}]:[],...e.columns.map(r=>{const t={id:r.id,accessorKey:r.accessorKey,header:r.header,enableSorting:r.enableSorting??!0,enableHiding:r.enableHiding??!0};return r.cell?{...t,cell:r.cell}:{...t,cell:({row:n})=>{const h=n.getValue(r.accessorKey);if(r.link){const C=e.routeParam||e.name.toLowerCase().slice(0,-1);return s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[C]:n.original.id}),className:"font-medium hover:underline cursor-pointer",children:String(h)})}return s.jsx("div",{children:String(h)})}}}),{id:"actions",header:"Actions",cell:({row:r})=>{var k,G,J,Q,W,X,Y;const t=r.original,n=e.routeParam||e.name.toLowerCase().slice(0,-1),h=()=>{navigator.clipboard.writeText(String(t.id)),x.success(`${e.name} ID copied to clipboard`)},C=()=>{const de=i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id});navigator.clipboard.writeText(de),x.success(`${e.name} URL copied to clipboard`)};return s.jsxs("div",{className:"flex items-center gap-2",children:[((k=e.actions)==null?void 0:k.showViewIcon)!==!1&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"icon",className:"cursor-pointer",children:s.jsx(Pe,{className:"h-4 w-4"})})}),((G=e.actions)==null?void 0:G.showViewButton)&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.show`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"sm",children:"View"})}),((J=e.actions)==null?void 0:J.showEditButton)&&s.jsx(y,{href:i.route(`${e.name.toLowerCase()}.edit`,{[n]:t.id}),children:s.jsx(D,{variant:"outline",size:"sm",children:"Edit"})}),((Q=e.actions)==null?void 0:Q.showDeleteButton)&&s.jsx(D,{variant:"outline",size:"sm",onClick:()=>B(t),className:"text-destructive",children:"Delete"}),((W=e.actions)==null?void 0:W.showMoreMenu)!==!1&&s.jsxs(he,{children:[s.jsx(we,{asChild:!0,children:s.jsx(D,{variant:"outline",size:"icon",className:"cursor-pointer",children:s.jsx(xe,{className:"h-4 w-4"})})}),s.jsxs(Ce,{align:"end",children:[s.jsx(E,{asChild:!0,children:s.jsxs(y,{href:i.route(`${e.name.toLowerCase()}.edit`,{[n]:t.id}),className:"cursor-pointer",children:[s.jsx(be,{className:"mr-2 h-4 w-4"}),"Edit ",e.name]})}),((X=e.actions)==null?void 0:X.showCopyId)!==!1&&s.jsxs(E,{onClick:h,className:"cursor-pointer",children:[s.jsx(ve,{className:"mr-2 h-4 w-4"}),"Copy ID"]}),((Y=e.actions)==null?void 0:Y.showShare)!==!1&&s.jsxs(E,{onClick:C,className:"cursor-pointer",children:[s.jsx(je,{className:"mr-2 h-4 w-4"}),"Share ",e.name]}),s.jsx(Se,{}),s.jsxs(E,{onClick:()=>B(t),className:"text-destructive cursor-pointer",children:[s.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete ",e.name]})]})]})]})}}]},[e,i,B]),O=o.useMemo(()=>e.printConfig||{title:`${e.name} List`,columns:N.filter(a=>a.id!=="select"&&a.id!=="actions").map(a=>({header:String(a.header),accessor:a.id||"",format:r=>String(r)}))},[e,N]),ue=o.useMemo(()=>{var a,r,t,n,h,C;return{columns:N,data:e.data,searchPlaceholder:e.searchPlaceholder,searchColumns:e.searchColumns,showSearch:((a=e.features)==null?void 0:a.search)!==!1,showExport:((r=e.features)==null?void 0:r.export)!==!1,showFilters:((t=e.features)==null?void 0:t.filters)!==!1,showPagination:((n=e.features)==null?void 0:n.pagination)!==!1,showPrint:((h=e.features)==null?void 0:h.print)!==!1,showBulkActions:((C=e.features)==null?void 0:C.bulkActions)!==!1,bulkActions:e.bulkActions,onBulkDelete:M,onBulkArchive:e.onBulkArchive,resetSelection:!0,pagination:e.pagination,onPageChange:F,onSortChange:R,onSearchChange:V,onPerPageChange:K,isLoading:d,error:w??void 0,tableName:e.name,printConfig:O}},[N,e.data,e.searchPlaceholder,e.searchColumns,e.features,e.bulkActions,e.onBulkArchive,e.pagination,e.name,M,F,R,V,K,d,w,O]);return s.jsxs(s.Fragment,{children:[s.jsx(pe,{...ue}),s.jsx(Z,{isOpen:re,onClose:()=>f(!1),onConfirm:ne,title:"Are you sure?",description:`This action cannot be undone. This will permanently delete the ${e.name.toLowerCase()} "${b==null?void 0:b.name}".`,isLoading:d}),s.jsx(Z,{isOpen:te,onClose:()=>{A(!1),g([])},onConfirm:ie,title:"Are you sure?",description:`This action cannot be undone. This will permanently delete ${I.length} selected ${e.name.toLowerCase()}(s).`,confirmText:"Delete Selected",isLoading:d})]})}const ae=(e,i)=>{const d=U();return{name:"Products",routeParam:"product",data:e,columns:[{id:"name",accessorKey:"name",header:"Name",enableSorting:!0,enableHiding:!0,link:!0},{id:"description",accessorKey:"description",header:"Description",enableSorting:!0,enableHiding:!0,cell:({row:l})=>j.createElement("div",{className:"max-w-[300px] truncate"},l.getValue("description"))},{id:"price",accessorKey:"price",header:"Price",enableSorting:!0,enableHiding:!0,cell:({row:l})=>{const w=parseFloat(l.getValue("price"));return j.createElement("div",{className:"font-medium"},De(w))}},{id:"featured_image",accessorKey:"featured_image",header:"Image",enableSorting:!1,enableHiding:!0,cell:({row:l})=>{const w=l.getValue("featured_image"),c=l.original.featured_image_original_name;return w?j.createElement("div",{className:"relative h-10 w-10"},j.createElement("img",{src:w,alt:c||"Product image",className:"h-full w-full rounded-md object-cover"})):j.createElement("div",{className:"text-muted-foreground"},"No image")}},{id:"created_at",accessorKey:"created_at",header:"Created At",enableSorting:!0,enableHiding:!0,cell:({row:l})=>j.createElement("div",{},new Date(l.getValue("created_at")).toLocaleDateString())}],searchColumns:["name","description"],searchPlaceholder:"Search products...",features:{search:!0,selection:!0,bulkActions:!0,export:!1,print:!1,filters:!0,pagination:!0},actions:{showViewIcon:!0,showViewButton:!1,showEditButton:!1,showDeleteButton:!1,showMoreMenu:!0,showCopyId:!0,showShare:!0},api:{baseUrl:d.route("products.index"),searchParam:"search",sortParam:"sort",directionParam:"direction",pageParam:"page",perPageParam:"per_page",deleteUrl:l=>d.route("products.destroy",{product:l})},exportConfig:{showCsv:!0,showJson:!0,showPrint:!0,filename:"products"},pagination:i}},Ne=[{title:"Products",href:"/products"}];function Ra({products:e,pagination:i}){const d=U(),l={...ae(e,i),api:{...ae(e,i).api,baseUrl:window.location.pathname,preserveState:["notifications","tenant","preferences"]}};return s.jsxs(ce,{breadcrumbs:Ne,children:[s.jsx(me,{title:"Products Management"}),s.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"flex gap-2"}),s.jsx(y,{href:d.route("products.create"),children:s.jsxs(D,{className:"cursor-pointer",children:[s.jsx(ke,{className:"mr-2 h-4 w-4"}),"Add Product"]})})]}),s.jsx(Le,{config:l})]})]})}export{Ra as default};
