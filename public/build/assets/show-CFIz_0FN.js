import{r as n,u as H,j as e,H as Qe,L as fe}from"./app--rPLb1Wa.js";import{B as i}from"./button-t6oEvNNW.js";import{C as x,c as u,a as g,b as y,d as F}from"./card-CKITB03R.js";import{T as We,a as Ye,b as L,c as I}from"./tabs-D9LivUjR.js";import{f as a}from"./utils-DawFQoOT.js";import{B as ge}from"./badge-BytQ6YWm.js";import{T as _}from"./textarea-BhLX4LKA.js";import{t as m}from"./index-Dtar63yJ.js";import{A as Ze}from"./app-layout-Dnm4xl_Y.js";import{L as h}from"./label-sJHZW9me.js";import{I as G}from"./input-7hAbn_4K.js";import{S as ye,a as Ne,b as _e,c as ve,d as j}from"./select-ezPgkrJs.js";import{A as X,a as J,b as K,c as Q,d as W,e as Y,f as Z,g as ee}from"./alert-dialog-rk-5qMA3.js";import{D as be,b as we,c as De,d as Pe,e as es}from"./dialog-eYr-eMtF.js";import{u as ss}from"./use-tenant-router-CdkPTyQ-.js";import{A as ts}from"./arrow-left-Dbh3fK9n.js";import{S as as}from"./square-pen-COLElC3n.js";import{T as rs}from"./trash-2-CM4e-Rdn.js";import{I as ns}from"./image-VD4Jcppv.js";import{C as Ce}from"./circle-check-big-C1mHk2hD.js";import{C as se}from"./circle-x-B-BOC8UM.js";import{D as Ae}from"./dollar-sign-iov7TVxI.js";import{C as is}from"./circle-play--HIAMDB8.js";import{f as o}from"./format-Dbvp4nIN.js";/* empty css            */import"./index-DdBBGQ2H.js";import"./index-DKlkJ5f8.js";import"./index-D1BNpUEz.js";import"./index-BizbyHS1.js";import"./index-CiYhb_ol.js";import"./index-DBn22uq1.js";import"./breadcrumb-D_vSgZGN.js";import"./sheet-CrDhwUie.js";import"./index-CMqQocSw.js";import"./index-OBDDV7SX.js";import"./index-9nGA-rDe.js";import"./x-5C1CNzet.js";import"./createLucideIcon-Dn2ECoQ0.js";import"./index-BNkycKvd.js";import"./index-B-ffABjE.js";import"./index-Y54OWJqv.js";import"./dropdown-menu-tGwdyT5s.js";import"./check-B7WA0u7K.js";import"./chevron-down-3TE5sHwq.js";import"./skeleton-nucNN7DL.js";import"./use-effective-tenant-BheL7R1D.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-CAE3BrTq.js";import"./file-text-BV3sSqH6.js";import"./credit-card-D0dMZS3_.js";import"./mail-C4499bmE.js";import"./shield-DsM99oQg.js";import"./circle-alert-Bw4CcRkw.js";import"./package-DpMKRVkn.js";import"./users-DAp9UJ3w.js";import"./wallet-Idy0EFA4.js";import"./building-2-CZ3Ztb_0.js";import"./chevron-right-aR-LqB9c.js";import"./sonner-BeKZnWl-.js";import"./index-vfTxt5y-.js";const ds=[{title:"Loans",href:"/loans"},{title:"View Loan",href:"/loans/view"}];function bt({loan:s,payment_methods:cs,auth:ls}){var me,pe,xe,ue,he,je;const d=ss(),[Se,v]=n.useState(!1),[Te,te]=n.useState(!1),[c,B]=n.useState(null),[R,b]=n.useState(""),[O,w]=n.useState(""),[E,ae]=n.useState(""),[U,D]=n.useState(""),[$,P]=n.useState(""),[os,ms]=n.useState(!1),[ke,C]=n.useState(!1),[M,V]=n.useState(null),[p,q]=n.useState(null),[z,A]=n.useState(""),[re,Fe]=n.useState(null),[Le,ne]=n.useState(!1),[Ie,ie]=n.useState(!1),[l,Be]=n.useState(null),{data:Re,setData:de,post:Oe,processing:Ee}=H({content:""}),{data:f,setData:S,post:Ue,processing:$e}=H({file:null,type:"",description:""}),{data:ps,setData:xs,post:us,processing:hs}=H({payment_method_id:"",amount:((me=s.next_payment_amount)==null?void 0:me.toString())||"",payment_proof:null,notes:""}),[Me,Ve]=n.useState("details"),qe=t=>{t.preventDefault(),Oe(d.route("loans.notes.add",{loan:s.id}),{onSuccess:()=>{m.success("Note added successfully"),de("content","")}})},ze=t=>{t.preventDefault();const r=new FormData;f.file&&(r.append("file",f.file),r.append("name",f.file.name)),r.append("type",f.type),r.append("description",f.description),Ue(d.route("loans.documents.upload",{id:s.id}),{onSuccess:()=>{m.success("Document uploaded successfully"),S({file:null,type:"",description:""})}})},N=t=>{B(t),b(""),w(""),D(""),P(""),v(!0)},He=()=>{if(!c)return;const t={status:c};c==="approved"?t.approval_notes=R:c==="rejected"?t.rejection_reason=O:c==="active"&&(t.payment_method_id=U,t.disbursement_transaction_id=$,t.start_date=new Date().toISOString().split("T")[0],t.end_date=new Date(Date.now()+s.duration_days*24*60*60*1e3).toISOString().split("T")[0]),d.put("loans.update-status",t,{loan:s.id},{onSuccess:()=>{m.success(`Loan status updated to ${c}`),v(!1),B(null),b(""),w(""),D(""),P("")},onError:r=>{m.error("Failed to update loan status"),v(!1),B(null),b(""),w(""),D(""),P("")}})},ce=t=>({pending:"bg-yellow-500",approved:"bg-blue-500",rejected:"bg-red-500",active:"bg-green-500",in_arrears:"bg-orange-500",defaulted:"bg-red-600",paid:"bg-green-600",cancelled:"bg-red-400",scheduled:"bg-blue-500",due:"bg-yellow-500",processing:"bg-blue-500",completed:"bg-green-500",failed:"bg-red-500",waived:"bg-purple-500",partial:"bg-orange-500"})[t]||"bg-gray-500",Ge=()=>{const t=[];switch(s.status){case"pending":t.push(e.jsxs(i,{variant:"default",onClick:()=>N("approved"),className:"bg-green-600 hover:bg-green-700 cursor-pointer",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Approve Loan"]},"approve"),e.jsxs(i,{variant:"destructive",onClick:()=>N("rejected"),className:"cursor-pointer",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Reject Loan"]},"reject"));break;case"approved":t.push(e.jsxs(i,{variant:"default",onClick:()=>N("active"),className:"bg-blue-600 hover:bg-blue-700 cursor-pointer",children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Activate Loan"]},"activate"));break;case"active":case"in_arrears":t.push(e.jsxs(i,{variant:"default",onClick:()=>N("paid"),className:"bg-green-600 hover:bg-green-700 cursor-pointer",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Mark as Paid"]},"mark-paid"));break}return["pending","approved","active","in_arrears"].includes(s.status)&&t.push(e.jsxs(i,{variant:"destructive",onClick:()=>N("cancelled"),className:"cursor-pointer",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Cancel Loan"]},"cancel")),t},Xe=()=>{if(E!==s.reference_number){m.error("Please enter the correct loan reference number");return}d.delete("loans.destroy",{loan:s.id},{onSuccess:()=>{m.success("Loan deleted successfully"),d.visit("loans.index")},onError:()=>{m.error("Failed to delete loan")}})},le=(t,r)=>{V(t),q(r),A(""),C(!0)},Je=()=>{if(!M||!p)return;const t=p==="approve"?d.route("loans.payments.approve",{id:s.id,paymentId:M.id}):d.route("loans.payments.reject",{id:s.id,paymentId:M.id});d.post(t,{notes:z},{},{onSuccess:()=>{m.success(`Payment ${p}ed successfully`),C(!1),V(null),q(null),A("")},onError:()=>{m.error(`Failed to ${p} payment`)}})},oe=t=>{t.attachment&&(Fe(d.route("loans.payments.download-proof",[s.id,t.id])),ne(!0))},Ke=t=>{Be({total_payment:t.amount,late_fees_amount:t.late_fees_amount||0,early_repayment_fees_amount:t.early_repayment_fees_amount||0,fees_amount:t.fees_amount||0,interest_amount:t.interest_amount||0,principal_amount:t.principal_amount||0,remaining_payment:t.remaining_payment||0}),ie(!0)};return e.jsxs(Ze,{breadcrumbs:ds,children:[e.jsx(Qe,{title:`View Loan - ${s.reference_number}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(fe,{href:d.route("loans.index"),children:e.jsxs(i,{variant:"outline",className:"cursor-pointer",children:[e.jsx(ts,{className:"mr-2 h-4 w-4"}),"Back to Loans"]})}),e.jsxs("div",{className:"flex gap-2",children:[Ge(),e.jsx(fe,{href:d.route("loans.edit",{loan:s.id}),children:e.jsxs(i,{className:"cursor-pointer",children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Edit"]})}),e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10 cursor-pointer",onClick:()=>te(!0),children:e.jsx(rs,{className:"h-4 w-4"})})]})]}),s.status==="active"&&s.grace_period_days>0&&e.jsx(x,{className:"border-yellow-500/50 bg-yellow-500/5",children:e.jsx(u,{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-yellow-700",children:(()=>{const t=s.last_payment_date?new Date(s.last_payment_date):new Date(s.start_date),T=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24)),k=s.grace_period_days-T;return k>0?`Borrower has ${k} days remaining in their grace period. After this period, late payment fees will apply.`:k===0?"Today is the last day of the grace period. Late payment fees will apply starting tomorrow.":`Grace period ended ${Math.abs(k)} days ago. Late payment fees now apply.`})()})})})})}),e.jsx(X,{open:Se,onOpenChange:v,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Confirm Status Update"}),e.jsxs(W,{children:["Are you sure you want to update this loan's status to ",c==null?void 0:c.replace("_"," ").toUpperCase(),"? This action cannot be undone."]})]}),c==="approved"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(h,{htmlFor:"approval_notes",children:"Approval Notes"}),e.jsx(_,{id:"approval_notes",value:R,onChange:t=>b(t.target.value),placeholder:"Enter any notes about the approval...",className:"mt-1"})]}),c==="rejected"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(h,{htmlFor:"rejection_reason",children:"Reason for Rejection"}),e.jsx(_,{id:"rejection_reason",value:O,onChange:t=>w(t.target.value),placeholder:"Enter the reason for rejection...",className:"mt-1",required:!0})]}),c==="active"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"payment_method",children:"Disbursement Method"}),e.jsxs(ye,{value:U,onValueChange:D,required:!0,children:[e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select disbursement method"})}),e.jsxs(ve,{children:[e.jsx(j,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(j,{value:"cash",children:"Cash"}),e.jsx(j,{value:"btc",children:"Bitcoin (BTC)"}),e.jsx(j,{value:"usdt",children:"Tether (USDT)"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"disbursement_transaction_id",children:"Disbursement Transaction ID"}),e.jsx(G,{id:"disbursement_transaction_id",value:$,onChange:t=>P(t.target.value),placeholder:"Enter disbursement transaction ID",required:!0})]})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:He,disabled:c==="rejected"&&!O||c==="approved"&&!R||c==="active"&&(!U||!$),children:"Confirm"})]})]})}),e.jsx(X,{open:Te,onOpenChange:te,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Delete Loan"}),e.jsxs(W,{children:["This action cannot be undone. This will permanently delete the loan and all associated data. To confirm, please enter the loan reference number:",e.jsx("span",{className:"font-semibold ml-1",children:s.reference_number})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(h,{htmlFor:"delete_confirmation",children:"Loan Reference Number"}),e.jsx(G,{id:"delete_confirmation",value:E,onChange:t=>ae(t.target.value),placeholder:"Enter loan reference number",className:"mt-1"})]}),e.jsxs(Y,{children:[e.jsx(Z,{onClick:()=>ae(""),children:"Cancel"}),e.jsx(ee,{onClick:Xe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 cursor-pointer",disabled:E!==s.reference_number,children:"Delete Loan"})]})]})}),e.jsx(x,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 border-b pb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Reference Number"}),e.jsx("p",{className:"text-lg font-semibold",children:s.reference_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activation Date"}),e.jsx("p",{className:"text-lg font-semibold",children:s.start_date&&!isNaN(new Date(s.start_date).getTime())?o(new Date(s.start_date),"PPP"):"Not yet active"})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Starting Amount"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:a(s.amount,s.currency.code)})]}),e.jsxs("div",{className:"bg-emerald-500/5 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-emerald-600",children:"Current Balance"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:a(s.current_balance,s.currency.code)}),e.jsx("p",{className:"text-xs text-emerald-600/80 mt-1",children:s.current_balance<s.amount?"Remaining":"Total"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Principal Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.principal_paid,s.currency.code)})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Interest Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.interest_paid,s.currency.code)})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Fees Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.fees_paid,s.currency.code)})]}),e.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Next Payment Due"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:s.next_payment_due_date&&!isNaN(new Date(s.next_payment_due_date).getTime())?o(new Date(s.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-primary/80 mt-1",children:["Amount: ",a(s.current_balance+s.current_interest_due,s.currency.code)]})]})]})]})})}),e.jsxs(We,{value:Me,onValueChange:Ve,className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsx(L,{value:"details",children:"Details"}),e.jsx(L,{value:"documents",children:"Documents"}),e.jsx(L,{value:"notes",children:"Notes"}),e.jsx(L,{value:"payments",children:"Payments"})]}),e.jsx(I,{value:"details",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(y,{children:"Loan Information"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Status"}),e.jsx(ge,{className:ce(s.status),children:s.status.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Amount"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.current_balance,s.currency.code)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Starting Amount"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.amount,s.currency.code)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Purpose"}),e.jsx("p",{children:s.purpose||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Interest Rate"}),e.jsxs("p",{className:"text-lg font-semibold",children:[s.interest_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Duration"}),e.jsxs("p",{className:"text-lg font-semibold",children:[s.duration_days," days"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Monthly Payment"}),e.jsx("p",{className:"text-lg font-semibold",children:a(s.interest_rate*s.current_balance/100,s.currency.code)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Payments"}),e.jsx("p",{className:"text-lg font-semibold",children:s.completed_payments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Interest Due"}),e.jsx("p",{className:"text-lg font-semibold",children:!s.current_interest_due||isNaN(s.current_interest_due)||!isFinite(s.current_interest_due)?a(0,s.currency.code):a(s.current_interest_due,s.currency.code)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Interest accrued up to today"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Next Payment Due"}),e.jsx("p",{className:"text-lg font-semibold",children:s.next_payment_due_date&&!isNaN(new Date(s.next_payment_due_date).getTime())?o(new Date(s.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Amount: ",a(s.current_balance+s.current_interest_due,s.currency.code)]})]})]})]})]}),e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Loan Charges & Fees"}),e.jsx(F,{children:"All applicable charges and fees for this loan"})]}),e.jsxs(u,{className:"space-y-4",children:[s.grace_period_days>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Grace Period"}),e.jsxs("p",{className:"text-sm font-semibold",children:[s.grace_period_days," days"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["During this ",s.grace_period_days,"-day period, the borrower can make payments without incurring late fees. After this period, late payment fees will apply."]})]}),(s.late_payment_fee_fixed>0||s.late_payment_fee_percentage>0)&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Late Payment Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:s.late_payment_fee_fixed>0?a(s.late_payment_fee_fixed,s.currency.code):`${s.late_payment_fee_percentage}% of payment amount`})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This fee will be charged for each payment made after the due date and grace period."}),s.grace_period_days>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: Borrower has ",s.grace_period_days," days grace period before late fees apply."]})]}),s.origination_fee_amount>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Origination Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:a(s.origination_fee_amount,s.currency.code)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["One-time fee charged when the loan is disbursed. Borrower will receive ",a(s.amount-s.origination_fee_amount,s.currency.code)," after this fee is deducted."]})]}),s.platform_fee_amount>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Platform Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:a(s.platform_fee_amount,s.currency.code)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fee charged for using the platform services"})]}),s.allows_early_repayment&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Early Repayment Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:s.early_repayment_fixed_fee>0?a(s.early_repayment_fixed_fee,s.currency.code):`${s.early_repayment_fee_percentage}% of remaining balance`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Charged when repaying the loan before the end of the ",s.early_repayment_period_days,"-day grace period. After ",s.early_repayment_period_days," days, this fee will no longer apply."]})]})]})]}),e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(g,{children:e.jsx(y,{children:"Borrower Information"})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Name"}),e.jsx("p",{children:`${s.user.first_name} ${s.user.last_name}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("p",{children:s.user.email})]}),s.approved_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Approved By"}),e.jsx("p",{children:(pe=s.approved_by_user)!=null&&pe.first_name&&((xe=s.approved_by_user)!=null&&xe.last_name)?`${s.approved_by_user.first_name} ${s.approved_by_user.last_name}`:"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o(new Date(s.approved_at),"PPP")})]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Disbursement Transaction ID"}),e.jsx("p",{children:s.disbursement_transaction_id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Payment Method"}),e.jsx("p",{children:((ue=s.payment_method)==null?void 0:ue.name)||"N/A"})]})]})]})})]})]})}),e.jsx(I,{value:"documents",children:e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Loan Documents"}),e.jsx(F,{children:"Upload and manage loan-related documents"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:ze,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"file",children:"Upload Document"}),e.jsx(G,{id:"file",type:"file",onChange:t=>{var r;return S("file",((r=t.target.files)==null?void 0:r[0])||null)},className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"type",children:"Document Type"}),e.jsxs(ye,{value:f.type,onValueChange:t=>S("type",t),required:!0,children:[e.jsx(Ne,{className:"mt-1",children:e.jsx(_e,{placeholder:"Select document type"})}),e.jsxs(ve,{children:[e.jsx(j,{value:"identification",children:"Identification"}),e.jsx(j,{value:"proof_of_income",children:"Proof of Income"}),e.jsx(j,{value:"bank_statement",children:"Bank Statement"}),e.jsx(j,{value:"contract",children:"Contract"}),e.jsx(j,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",value:f.description,onChange:t=>S("description",t.target.value),className:"mt-1",rows:3})]}),e.jsx(i,{type:"submit",disabled:$e,children:"Upload Document"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Uploaded Documents"}),e.jsxs("div",{className:"space-y-4",children:[(he=s.documents)==null?void 0:he.map(t=>{var r,T;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",t.type.replace("_"," ").toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Uploaded by ",(r=t.uploadedBy)==null?void 0:r.first_name," ",((T=t.uploadedBy)==null?void 0:T.last_name)||"Unknown"," on"," ",o(new Date(t.created_at),"PPP p")]}),t.description&&e.jsx("p",{className:"text-sm mt-2",children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>window.open(d.route("loans.documents.download",[s.id,t.id]),"_blank"),children:"Download"}),e.jsx(i,{variant:"destructive",size:"sm",onClick:()=>{confirm("Are you sure you want to delete this document?")&&d.delete("loans.documents.delete",[s.id,t.id],{preserveScroll:!0,onSuccess:()=>{m.success("Document deleted successfully")}})},children:"Delete"})]})]})},t.id)}),(!s.documents||s.documents.length===0)&&e.jsx("p",{className:"text-muted-foreground",children:"No documents uploaded yet."})]})]})]})})]})}),e.jsx(I,{value:"notes",children:e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Loan Notes"}),e.jsx(F,{children:"Add and view notes about this loan"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:qe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Add Note"}),e.jsx(_,{value:Re.content,onChange:t=>de("content",t.target.value),placeholder:"Enter your note here...",rows:4,required:!0})]}),e.jsx(i,{type:"submit",disabled:Ee,children:"Add Note"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Previous Notes"}),e.jsx("div",{className:"space-y-4",children:(je=s.notes)==null?void 0:je.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.created_by.first_name," ",t.created_by.last_name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o(new Date(t.created_at),"PPP p")})]}),e.jsxs("div",{className:"flex gap-2",children:[t.updated_at!==t.created_at&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Edited by ",t.updated_by.first_name," ",t.updated_by.last_name," on"," ",o(new Date(t.updated_at),"PPP p")]}),e.jsx(i,{variant:"destructive",size:"sm",onClick:()=>{confirm("Are you sure you want to delete this note?")&&d.delete("loans.notes.delete",[s.id,t.id],{preserveScroll:!0,onSuccess:()=>{m.success("Note deleted successfully")}})},children:"Delete"})]})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:t.content})]},t.id))})]})]})})]})}),e.jsx(I,{value:"payments",children:e.jsxs(x,{children:[e.jsxs(g,{children:[e.jsx(y,{children:"Payment History"}),e.jsx(F,{children:"View and manage loan payments"})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Next Payment Due"}),e.jsx("p",{className:"text-lg font-semibold",children:s.next_payment_due_date&&!isNaN(new Date(s.next_payment_due_date).getTime())?o(new Date(s.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(s.current_balance+s.current_interest_due,s.currency.code)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Last Payment"}),e.jsx("p",{className:"text-lg font-semibold",children:s.last_payment_date&&!isNaN(new Date(s.last_payment_date).getTime())?o(new Date(s.last_payment_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(s.last_payment_amount,s.currency.code)]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Payment History"}),e.jsx("div",{className:"space-y-4",children:s.payments&&s.payments.length>0?s.payments.map(t=>{var r;return e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Payment #",t.payment_number]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(t.amount,s.currency.code)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Payment Date: ",t.payment_at&&!isNaN(new Date(t.payment_at).getTime())?o(new Date(t.payment_at),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Approved Date: ",t.approved_at&&!isNaN(new Date(t.approved_at).getTime())?o(new Date(t.approved_at),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last Payment: ",s.last_payment_date&&!isNaN(new Date(s.last_payment_date).getTime())?o(new Date(s.last_payment_date),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Payment Method: ",((r=t.payment_method)==null?void 0:r.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx(ge,{className:ce(t.status),children:t.status.toUpperCase()})]}),t.notes&&e.jsxs("p",{className:"text-sm mt-2",children:["Notes: ",t.notes]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.attachment&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"relative w-20 h-20 rounded-lg overflow-hidden border",children:e.jsx("img",{src:d.route("loans.payments.download-proof",[s.id,t.id]),alt:"Payment Proof",className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>oe(t)})}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>oe(t),className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"View Full"]})]}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>le(t,"approve"),children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>le(t,"reject"),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),t.status==="completed"&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>Ke(t),className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"View Breakdown"]})]})]})})},t.id)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No payment history available."})})]})]})})]})})]}),e.jsx(X,{open:ke,onOpenChange:C,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:p==="approve"?"Approve Payment":"Reject Payment"}),e.jsx(W,{children:p==="approve"?"Are you sure you want to approve this payment?":"Are you sure you want to reject this payment?"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(h,{htmlFor:"action_notes",children:p==="approve"?"Approval Notes":"Reason for Rejection"}),e.jsx(_,{id:"action_notes",value:z,onChange:t=>A(t.target.value),placeholder:p==="approve"?"Enter any notes about the approval...":"Enter the reason for rejection...",className:"mt-1",required:!0})]}),e.jsxs(Y,{children:[e.jsx(Z,{onClick:()=>{C(!1),V(null),q(null),A("")},children:"Cancel"}),e.jsx(ee,{onClick:Je,className:p==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",disabled:!z.trim(),children:p==="approve"?"Approve Payment":"Reject Payment"})]})]})}),e.jsx(be,{open:Le,onOpenChange:ne,children:e.jsxs(we,{className:"max-w-4xl",children:[e.jsx(De,{children:e.jsx(Pe,{children:"Payment Proof"})}),re&&e.jsx("div",{className:"relative w-full h-[600px]",children:e.jsx("img",{src:re,alt:"Payment Proof",className:"w-full h-full object-contain"})})]})}),e.jsx(be,{open:Ie,onOpenChange:ie,children:e.jsxs(we,{className:"max-w-xl",children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"Payment Allocation Breakdown"}),e.jsx(es,{children:"Detailed breakdown of how the payment was allocated"})]}),l&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Payment Amount"}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.total_payment,s.currency.code)})]}),l.late_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Late Payment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for late payment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.late_fees_amount,s.currency.code)})]}),l.early_repayment_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Early Repayment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for early repayment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.early_repayment_fees_amount,s.currency.code)})]}),l.fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Regular Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Standard loan fees"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.fees_amount,s.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Interest Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accrued interest paid"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.interest_amount,s.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Principal Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount applied to loan balance"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.principal_amount,s.currency.code)})]}),l.remaining_payment>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Remaining Amount"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount not yet allocated"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.remaining_payment,s.currency.code)})]})]})})]})})]})]})}export{bt as default};
