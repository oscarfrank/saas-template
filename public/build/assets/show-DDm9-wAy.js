import{r as o,u as W,j as e,H as Te,L as Fe}from"./app-Bw_eO3sd.js";import{B as D}from"./button-DY2O9S9G.js";import{C as N,a as F,b as k,d as O,c as b}from"./card-DFDYEeIO.js";import{T as ke,a as Ie,b as Y,c as G}from"./tabs-Btb8IMYr.js";import{f as a}from"./utils-DawFQoOT.js";import{B as pe}from"./badge-DPU-7Oq6.js";import{T as ue}from"./textarea-DIheA2r5.js";import{t as v}from"./index-De6LdJTA.js";import{A as Me}from"./app-layout-BSIvknne.js";import{L as y}from"./label-C8ywGR50.js";import{I}from"./input-Bmbc7aO-.js";import{S as he,a as fe,b as ye,c as je,d as C}from"./select-BGKBtYvv.js";import{D as z,b as J,c as K,d as Q,e as xe}from"./dialog-DXDwBKs7.js";import{A as w,a as P}from"./alert-CYeSlVEl.js";import{f}from"./format-Dbvp4nIN.js";import{u as Le}from"./use-tenant-router-BPEgyWCx.js";import{A as Oe}from"./arrow-left-6EOJbuyn.js";import{I as Be}from"./image-C5BKt0I5.js";import{D as Re}from"./dollar-sign-BdaYzWQe.js";/* empty css            */import"./index-BUUDosUt.js";import"./index-BG0SbQBQ.js";import"./index-Bt6kV37t.js";import"./index-CVZ3wJAA.js";import"./index-CtNM4qhv.js";import"./index-KPETvMeP.js";import"./breadcrumb-C2sRCkcu.js";import"./sheet-CmXTK4FQ.js";import"./index-ByXzH8er.js";import"./index-fLpoMwuJ.js";import"./index-NSo7goI1.js";import"./x-BbsTXzvW.js";import"./createLucideIcon-B9LDe1F7.js";import"./index-V7Tq7z7Y.js";import"./index-VORSUaQ4.js";import"./index-U92boKRB.js";import"./dropdown-menu-eFqcjt66.js";import"./check-DWqh-ITp.js";import"./chevron-down-1laKfkfM.js";import"./skeleton-COevZx66.js";import"./use-effective-tenant-DB7mi6AU.js";import"./trash-2-CEE_VqOF.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-DQDpUZmM.js";import"./file-text-DPljHKaA.js";import"./credit-card-8AiVb87_.js";import"./mail-FVHvQLZC.js";import"./shield-BPzbhB4h.js";import"./circle-alert-BvybSHRd.js";import"./package-D6uMvGvA.js";import"./users-BpArtZsm.js";import"./wallet-Cnkdu3fg.js";import"./building-2-DJOAXm0m.js";import"./chevron-right-BXZknpZE.js";import"./sonner--M2gOl5q.js";import"./index-2GXxL6M4.js";function Ee({loanId:t,onSubmit:X,initialAmount:c}){const[u,S]=o.useState(null),[j,V]=o.useState(""),{data:m,setData:A,post:_e,processing:$,errors:d,reset:Z}=W({amount:c||"",payment_type:"",reference_number:"",payment_date:f(new Date,"yyyy-MM-dd"),notes:"",proof_file:null}),ee=r=>{r.preventDefault();const h=new FormData;h.append("amount",m.amount),h.append("payment_type",j),j==="offline"&&(h.append("reference_number",m.reference_number),h.append("payment_date",m.payment_date),h.append("notes",m.notes),u&&h.append("proof_file",u)),X(h,j)},B=r=>{r.target.files&&r.target.files[0]&&(S(r.target.files[0]),A("proof_file",r.target.files[0]))},R=r=>{V(r),A("payment_type",r)},q=r=>{A("amount",r)};return e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(k,{children:"Submit Payment"}),e.jsx(O,{children:j==="online"?"Complete your payment using our secure online payment system.":"Please provide the payment details and upload proof of payment."})]}),e.jsx(b,{children:e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"amount",children:"Amount"}),e.jsx(I,{id:"amount",type:"number",step:"0.01",min:c,value:m.amount,onChange:r=>q(r.target.value),required:!0}),d.amount&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.amount})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"payment_type",children:"Payment Type"}),e.jsxs(he,{value:m.payment_type,onValueChange:R,children:[e.jsx(fe,{className:"mt-1",children:e.jsx(ye,{placeholder:"Select payment type"})}),e.jsxs(je,{children:[e.jsx(C,{value:"online",children:"Online Payment"}),e.jsx(C,{value:"offline",children:"Offline Payment"})]})]}),d.payment_type&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.payment_type})})]})]}),j==="online"&&e.jsx(w,{children:e.jsx(P,{children:"Online payment covers: Credit/Debit Card, Bank Transfer, and Mobile Banking Apps. You will be redirected to our secure payment gateway to complete your transaction."})}),j==="offline"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{children:e.jsx(P,{children:"Offline payment covers: Cash deposits at bank branches, Mobile App screenshots, or any other manual payment method. Please ensure to provide all required details."})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"reference_number",children:"Reference Number"}),e.jsx(I,{id:"reference_number",value:m.reference_number,onChange:r=>A("reference_number",r.target.value),required:!0}),d.reference_number&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.reference_number})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"payment_date",children:"Payment Date"}),e.jsx(I,{id:"payment_date",type:"date",value:m.payment_date,onChange:r=>A("payment_date",r.target.value),required:!0}),d.payment_date&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.payment_date})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(ue,{id:"notes",value:m.notes,onChange:r=>A("notes",r.target.value)}),d.notes&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.notes})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"proof_file",children:"Proof of Payment"}),e.jsx(I,{id:"proof_file",type:"file",onChange:B,required:!0}),d.proof_file&&e.jsx(w,{variant:"destructive",children:e.jsx(P,{children:d.proof_file})})]})]}),e.jsx(D,{type:"submit",disabled:$||!m.amount||!m.payment_type,children:$?"Processing...":j==="online"?"Proceed to Payment":"Submit Payment"})]})})]})}const Ue=[{title:"My Loans",href:"/loans"},{title:"Loan Details",href:"/loans/view"}];function Ht({loan:t,payment_methods:X}){var de,ce,me;const c=Le(),{data:u,setData:S,post:j,processing:V}=W({file:null,type:"",description:""}),{data:m,setData:A,post:_e,processing:$}=W({payment_method_id:"",amount:((de=t.next_payment_amount)==null?void 0:de.toString())||"",payment_proof:null,notes:""}),[d,Z]=o.useState("details"),[ee,B]=o.useState(!1),[R,q]=o.useState(null),[r,h]=o.useState(!1),ge=o.useRef(null),[Ne,T]=o.useState(!1),[be,te]=o.useState(!1),[l,ve]=o.useState(null),[_,se]=o.useState(""),[p,ae]=o.useState(null),we=s=>{s.preventDefault();const n=new FormData;u.file&&(n.append("file",u.file),n.append("name",u.file.name)),n.append("type",u.type),n.append("description",u.description),j(c.route("loans.documents.upload",{id:t.id}),{onSuccess:()=>{v.success("Document uploaded successfully"),S({file:null,type:"",description:""})},onError:x=>{Object.values(x).forEach(i=>{v.error(i)})}})},Pe=(s,n)=>{n==="online"?c.post("loans.payments.store",s,{loan:t.id},{onSuccess:()=>{v.success("Payment submitted successfully"),B(!1),T(!1),c.reload()},onError:x=>{Object.values(x).forEach(i=>{v.error(i)})}}):c.post("loans.payments.store",s,{loan:t.id},{onSuccess:()=>{v.success("Payment submitted successfully"),B(!1),T(!1),c.reload()},onError:x=>{Object.values(x).forEach(i=>{v.error(i)})}})},re=s=>({pending:"bg-yellow-500",approved:"bg-blue-500",rejected:"bg-red-500",active:"bg-green-500",in_arrears:"bg-orange-500",defaulted:"bg-red-600",paid:"bg-green-600",cancelled:"bg-red-400",scheduled:"bg-blue-500",due:"bg-yellow-500",processing:"bg-blue-500",completed:"bg-green-500",failed:"bg-red-500",waived:"bg-purple-500",partial:"bg-orange-500"})[s]||"bg-gray-500",ne=s=>{s.attachment&&(q(c.route("loans.payments.download-proof",{id:t.id,paymentId:s.id})),h(!0))},De=()=>{var s;se(((s=t.next_payment_amount)==null?void 0:s.toString())||""),ae(ie(t.next_payment_amount||0)),T(!0)},Ae=s=>{ve({total_payment:s.amount,late_fees_amount:s.late_fees_amount||0,early_repayment_fees_amount:s.early_repayment_fees_amount||0,fees_amount:s.fees_amount||0,interest_amount:s.interest_amount||0,principal_amount:s.principal_amount||0,remaining_payment:s.remaining_payment||0}),te(!0)},ie=s=>{const n=new Date(t.start_date),i=Math.floor((new Date().getTime()-n.getTime())/(1e3*60*60*24)),M=i<=t.grace_period_days,L=i<t.early_repayment_period_days;let E=0;!M&&t.days_past_due>0&&(t.late_payment_fee_fixed>0?E=t.late_payment_fee_fixed:t.late_payment_fee_percentage>0&&(E=t.current_balance*(t.late_payment_fee_percentage/100)));let U=0;L&&t.allows_early_repayment&&(t.early_repayment_fixed_fee>0?U=t.early_repayment_fixed_fee:t.early_repayment_fee_percentage>0&&(U=t.current_balance*(t.early_repayment_fee_percentage/100)));const le=t.current_interest_due;let H=s-E-U-le;const oe=Math.max(0,Math.min(H,t.principal_remaining));return H-=oe,{total_payment:s,late_fees_amount:E,early_repayment_fees_amount:U,fees_amount:0,interest_amount:le,principal_amount:oe,remaining_payment:H}},g=()=>{const s=new Date(t.start_date),x=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60*24)),i=x<=t.grace_period_days;let M=0;!i&&t.days_past_due>0&&(t.late_payment_fee_fixed>0?M=t.late_payment_fee_fixed:t.late_payment_fee_percentage>0&&(M=t.current_balance*(t.late_payment_fee_percentage/100)));let L=0;return x<t.early_repayment_period_days&&t.allows_early_repayment&&(t.early_repayment_fixed_fee>0?L=t.early_repayment_fixed_fee:t.early_repayment_fee_percentage>0&&(L=t.current_balance*(t.early_repayment_fee_percentage/100))),M+L+t.current_interest_due},Ce=s=>{se(s);const n=parseFloat(s)||0;ae(ie(n))},Se=()=>{if(!_){v.error("Please enter a payment amount");return}if(parseFloat(_)<g()){v.error(`Minimum payment amount is ${a(g(),t.currency.code)}`);return}T(!0)};return e.jsxs(Me,{breadcrumbs:Ue,children:[e.jsx(Te,{title:`Loan Details - ${t.reference_number}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(Fe,{href:c.route("user-loans"),children:e.jsxs(D,{variant:"outline",className:"cursor-pointer",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Back to Loans"]})})}),t.status==="active"&&t.grace_period_days>0&&e.jsx(N,{className:"border-yellow-500/50 bg-yellow-500/5",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-yellow-700",children:(()=>{const s=t.last_payment_date?new Date(t.last_payment_date):new Date(t.start_date),x=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60*24)),i=t.grace_period_days-x;return i>0?`You have ${i} days remaining in your grace period. After this period, late payment fees will apply.`:i===0?"Today is the last day of your grace period. Make a payment today to avoid late fees.":`Your grace period has ended ${Math.abs(i)} days ago. Late payment fees now apply.`})()})}),t.next_payment_due_date&&e.jsx(D,{variant:"outline",className:"border-yellow-500 text-yellow-700 hover:bg-yellow-500/10",onClick:De,children:"Make Payment"})]})})}),e.jsx(N,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 border-b pb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Reference Number"}),e.jsx("p",{className:"text-lg font-semibold",children:t.reference_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activation Date"}),e.jsx("p",{className:"text-lg font-semibold",children:t.start_date&&!isNaN(new Date(t.start_date).getTime())?f(new Date(t.start_date),"PPP"):"Not yet active"})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Starting Amount"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:a(t.amount,t.currency.code)})]}),e.jsxs("div",{className:"bg-emerald-500/5 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-emerald-600",children:"Current Balance"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:a(t.current_balance,t.currency.code)}),e.jsx("p",{className:"text-xs text-emerald-600/80 mt-1",children:t.current_balance<t.amount?"Remaining":"Total"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Principal Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.principal_paid,t.currency.code)})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Interest Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.interest_paid,t.currency.code)})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Fees Paid"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.fees_paid,t.currency.code)})]}),e.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border-2 border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Next Payment Due"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:t.next_payment_due_date&&!isNaN(new Date(t.next_payment_due_date).getTime())?f(new Date(t.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-primary/80 mt-1",children:["Amount: ",a(t.current_balance+t.current_interest_due,t.currency.code)]})]})]})]})})}),e.jsxs(ke,{value:d,onValueChange:Z,className:"space-y-4",children:[e.jsxs(Ie,{children:[e.jsx(Y,{value:"details",children:"Details"}),e.jsx(Y,{value:"documents",children:"Documents"}),e.jsx(Y,{value:"payments",children:"Payments"})]}),e.jsx(G,{value:"details",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(N,{children:[e.jsx(F,{children:e.jsx(k,{children:"Loan Information"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Status"}),e.jsx(pe,{className:re(t.status),children:t.status.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Amount"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.current_balance,t.currency.code)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Starting Amount"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.amount,t.currency.code)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Purpose"}),e.jsx("p",{children:t.purpose||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Interest Rate"}),e.jsxs("p",{className:"text-lg font-semibold",children:[t.interest_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Duration"}),e.jsxs("p",{className:"text-lg font-semibold",children:[t.duration_days," days"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Monthly Payment"}),e.jsx("p",{className:"text-lg font-semibold",children:a(t.interest_rate*t.current_balance/100,t.currency.code)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Payments"}),e.jsx("p",{className:"text-lg font-semibold",children:t.completed_payments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Interest Due"}),e.jsx("p",{className:"text-lg font-semibold",children:!t.current_interest_due||isNaN(t.current_interest_due)||!isFinite(t.current_interest_due)?a(0,t.currency.code):a(t.current_interest_due,t.currency.code)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Interest accrued up to today"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Next Payment Due"}),e.jsx("p",{className:"text-lg font-semibold",children:t.next_payment_due_date&&!isNaN(new Date(t.next_payment_due_date).getTime())?f(new Date(t.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Amount: ",a(t.current_balance+t.current_interest_due,t.currency.code)]})]})]})]})]}),e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(k,{children:"Loan Charges & Fees"}),e.jsx(O,{children:"All applicable charges and fees for this loan"})]}),e.jsxs(b,{className:"space-y-4",children:[t.grace_period_days>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Grace Period"}),e.jsxs("p",{className:"text-sm font-semibold",children:[t.grace_period_days," days"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["During this ",t.grace_period_days,"-day period, you can make payments without incurring late fees. After this period, late payment fees will apply."]})]}),(t.late_payment_fee_fixed>0||t.late_payment_fee_percentage>0)&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Late Payment Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:t.late_payment_fee_fixed>0?a(t.late_payment_fee_fixed,t.currency.code):`${t.late_payment_fee_percentage}% of payment amount`})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This fee will be charged for each payment made after the due date and grace period."}),t.grace_period_days>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: You have ",t.grace_period_days," days grace period before late fees apply."]})]}),t.origination_fee_amount>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Origination Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:a(t.origination_fee_amount,t.currency.code)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["One-time fee charged when the loan is disbursed. You will receive ",a(t.amount-t.origination_fee_amount,t.currency.code)," after this fee is deducted."]})]}),t.platform_fee_amount>0&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Platform Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:a(t.platform_fee_amount,t.currency.code)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fee charged for using the platform services"})]}),t.allows_early_repayment&&e.jsxs("div",{className:"space-y-1 border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Early Repayment Fee"}),e.jsx("p",{className:"text-sm font-semibold",children:t.early_repayment_fixed_fee>0?a(t.early_repayment_fixed_fee,t.currency.code):`${t.early_repayment_fee_percentage}% of remaining balance`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Charged when repaying the loan before the end of the ",t.early_repayment_period_days,"-day grace period. After ",t.early_repayment_period_days," days, this fee will no longer apply."]})]})]})]})]})}),e.jsx(G,{value:"documents",children:e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(k,{children:"Loan Documents"}),e.jsx(O,{children:"View and upload loan-related documents"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"file",children:"Upload Document"}),e.jsx(I,{id:"file",type:"file",onChange:s=>{var n;return S("file",((n=s.target.files)==null?void 0:n[0])||null)},className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"type",children:"Document Type"}),e.jsxs(he,{value:u.type,onValueChange:s=>S("type",s),required:!0,children:[e.jsx(fe,{className:"mt-1",children:e.jsx(ye,{placeholder:"Select document type"})}),e.jsxs(je,{children:[e.jsx(C,{value:"identification",children:"Identification"}),e.jsx(C,{value:"proof_of_income",children:"Proof of Income"}),e.jsx(C,{value:"bank_statement",children:"Bank Statement"}),e.jsx(C,{value:"contract",children:"Contract"}),e.jsx(C,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"description",children:"Description"}),e.jsx(ue,{id:"description",value:u.description,onChange:s=>S("description",s.target.value),className:"mt-1",rows:3})]}),e.jsx(D,{type:"submit",disabled:V,children:"Upload Document"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Uploaded Documents"}),e.jsxs("div",{className:"space-y-4",children:[(ce=t.documents)==null?void 0:ce.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",s.type.replace("_"," ").toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Uploaded on ",f(new Date(s.created_at),"PPP p")]}),s.description&&e.jsx("p",{className:"text-sm mt-2",children:s.description})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(D,{variant:"outline",size:"sm",onClick:()=>window.open(c.route("loans.documents.download",{id:t.id,documentId:s.id}),"_blank"),children:"Download"})})]})},s.id)),(!t.documents||t.documents.length===0)&&e.jsx("p",{className:"text-muted-foreground",children:"No documents uploaded yet."})]})]})]})})]})}),e.jsx(G,{value:"payments",ref:ge,children:e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(k,{children:"Payment History"}),e.jsx(O,{children:"View and manage loan payments"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Next Payment Due"}),e.jsx("p",{className:"text-lg font-semibold",children:t.next_payment_due_date&&!isNaN(new Date(t.next_payment_due_date).getTime())?f(new Date(t.next_payment_due_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(t.current_balance+t.current_interest_due,t.currency.code)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Last Payment"}),e.jsx("p",{className:"text-lg font-semibold",children:t.last_payment_date&&!isNaN(new Date(t.last_payment_date).getTime())?f(new Date(t.last_payment_date),"PPP"):"N/A"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(t.last_payment_amount,t.currency.code)]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Payment History"}),e.jsxs("div",{className:"space-y-4",children:[(me=t.payments)==null?void 0:me.map(s=>{var n;return e.jsx(N,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Payment #",s.payment_number]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ",a(s.amount,t.currency.code)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Payment Date: ",s.payment_at&&!isNaN(new Date(s.payment_at).getTime())?f(new Date(s.payment_at),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Approved Date: ",s.approved_at&&!isNaN(new Date(s.approved_at).getTime())?f(new Date(s.approved_at),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last Payment: ",t.last_payment_date&&!isNaN(new Date(t.last_payment_date).getTime())?f(new Date(t.last_payment_date),"PPP"):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Payment Method: ",((n=s.payment_method)==null?void 0:n.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx(pe,{className:re(s.status),children:s.status.toUpperCase()})]}),s.notes&&e.jsxs("p",{className:"text-sm mt-2",children:["Notes: ",s.notes]})]}),s.attachment&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"relative w-20 h-20 rounded-lg overflow-hidden border",children:e.jsx("img",{src:c.route("loans.payments.download-proof",{id:t.id,paymentId:s.id}),alt:"Payment Proof",className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>ne(s)})}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>ne(s),className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"View Full"]})]})}),s.status==="completed"&&e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>Ae(s),className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"View Breakdown"]})]})})},s.id)}),(!t.payments||t.payments.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No payment history available."})]})]}),t.status==="active"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Make a Payment"}),e.jsxs(N,{className:"mb-4",children:[e.jsxs(F,{children:[e.jsx(k,{children:"Payment Amount"}),e.jsx(O,{children:"Enter the amount you wish to pay"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{htmlFor:"payment-amount",children:"Amount"}),e.jsx(I,{id:"payment-amount",type:"number",step:"0.01",min:g(),value:_,onChange:s=>Ce(s.target.value),placeholder:`Minimum ${a(g(),t.currency.code)}`,className:`mt-1 ${_&&parseFloat(_)<g()?"border-red-500":""}`}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Minimum payment: ",a(g(),t.currency.code)," (fees + interest)"]}),_&&parseFloat(_)<g()&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["Amount must be at least ",a(g(),t.currency.code)," to cover fees and interest"]})]}),e.jsx(D,{onClick:Se,disabled:!p||parseFloat(_)<g(),children:"Proceed to Payment"})]}),p&&e.jsx("div",{className:"mt-4 space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Payment Amount"}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.total_payment,t.currency.code)})]}),p.late_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Late Payment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for late payment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.late_fees_amount,t.currency.code)})]}),p.early_repayment_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Early Repayment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for early repayment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.early_repayment_fees_amount,t.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Interest Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accrued interest to be paid"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.interest_amount,t.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Principal Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount to be applied to loan balance"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.principal_amount,t.currency.code)})]}),p.remaining_payment>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Remaining Amount"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount that will be refunded"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(p.remaining_payment,t.currency.code)})]})]})})]})})]})]})]})})]})})]})]}),e.jsx(z,{open:Ne,onOpenChange:T,children:e.jsxs(J,{className:"max-w-xl",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Make a Payment"}),e.jsx(xe,{children:"Complete your payment using one of the available payment methods"})]}),e.jsx(Ee,{loanId:t.id,initialAmount:_,onSubmit:(s,n)=>{Pe(s,n),T(!1)}})]})}),e.jsx(z,{open:r,onOpenChange:h,children:e.jsxs(J,{className:"max-w-4xl",children:[e.jsx(K,{children:e.jsx(Q,{children:"Payment Proof"})}),R&&e.jsx("div",{className:"relative w-full h-[600px]",children:e.jsx("img",{src:R,alt:"Payment Proof",className:"w-full h-full object-contain"})})]})}),e.jsx(z,{open:be,onOpenChange:te,children:e.jsxs(J,{className:"max-w-xl",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Payment Allocation Breakdown"}),e.jsx(xe,{children:"Detailed breakdown of how your payment was allocated"})]}),l&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Payment Amount"}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.total_payment,t.currency.code)})]}),l.late_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Late Payment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for late payment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.late_fees_amount,t.currency.code)})]}),l.early_repayment_fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Early Repayment Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Charged for early repayment"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.early_repayment_fees_amount,t.currency.code)})]}),l.fees_amount>0&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Regular Fees"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Standard loan fees"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.fees_amount,t.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Interest Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accrued interest paid"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.interest_amount,t.currency.code)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Principal Payment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount applied to loan balance"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.principal_amount,t.currency.code)})]}),l.remaining_payment>0&&e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Remaining Amount"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount not yet allocated"})]}),e.jsx("p",{className:"text-sm font-semibold",children:a(l.remaining_payment,t.currency.code)})]})]})})]})})]})}export{Ht as default};
