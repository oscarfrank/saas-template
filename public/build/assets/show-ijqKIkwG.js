import{r as o,j as e,H as we,L as Ce,a as C}from"./app-D04Dztzg.js";import{A as De}from"./app-layout-C_naymNT.js";import{B as i}from"./button-DZPivG0c.js";import{C as x,a as u,b as p,c as f}from"./card-BiECpO3p.js";import{B as N}from"./badge-DjyNViZj.js";import{D as V,b as Y,c as G,d as K,e as q,f as J}from"./dialog-Ckkazhp_.js";import{L as Q}from"./label-RUXCefAA.js";import{S as W,a as X,b as Z,c as ee,d as se}from"./select-BRqYn95E.js";import{A as Se,a as Pe,b as D,c as S,d as P,e as k,f as _,g as te}from"./alert-dialog-DGPkekn7.js";import{u as ke}from"./use-tenant-router-C1gTSJyt.js";import{A as _e}from"./arrow-left-C8d7RzRk.js";import{C as I}from"./circle-check-CiiqzFCk.js";import{C as ae}from"./clock-CszGDHJx.js";import{L as re}from"./loader-circle-BMN9FH4x.js";import{T as Ie}from"./trash-2-bEjB-2Kd.js";import{D as Ae}from"./dollar-sign-DAXZAp8e.js";import{U as $e}from"./users-C90dJzc7.js";import{B as ne}from"./banknote-BscDXfoQ.js";import{C as Re}from"./check-CXnK2_NP.js";import{F as Fe}from"./file-text-D9Mvcoy0.js";/* empty css            */import"./breadcrumb-EW6w0Tnx.js";import"./utils-DawFQoOT.js";import"./input-DOcNm42I.js";import"./sheet-10OrOGMG.js";import"./index-CnJ5OywE.js";import"./index-ybapLptU.js";import"./index-C7jeomV-.js";import"./index-DhOecPJh.js";import"./index-QeErrECp.js";import"./index-39nAXQv3.js";import"./index-Dnop7anH.js";import"./x-Zd_QZ6W_.js";import"./createLucideIcon-DQ1nCPNN.js";import"./index-DfZYuCB2.js";import"./index-ByPjEBNg.js";import"./index-BwMmloDF.js";import"./dropdown-menu-CTrM84f_.js";import"./index-5Qd1E-Xg.js";import"./index-DxpSCYGk.js";import"./chevron-down-RccFG6I8.js";import"./skeleton-Y604-fIL.js";import"./use-effective-tenant-QBTvs0JY.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./user-CHKOG5ae.js";import"./credit-card-DR0OTN7k.js";import"./mail-D5g0vBUi.js";import"./shield-DZ1jybk1.js";import"./circle-alert-DoebB800.js";import"./package-DgqiXCfS.js";import"./wallet-BpEENWzu.js";import"./building-2-DAyvAnId.js";import"./chevron-right-BKyDHRej.js";import"./sonner-BZ9uEQDq.js";import"./index-CwasXQq4.js";import"./index-wnnsRq2M.js";const le=[{value:"paystack",label:"Paystack"},{value:"kuda",label:"Kuda"},{value:"flutterwave",label:"Flutterwave"},{value:"manual",label:"Manual / Other"}];function ie(s){return new Date(s).toLocaleDateString(void 0,{dateStyle:"long"})}function oe(s,a){return`${ie(s)} – ${ie(a)}`}function Te(s){const a={};for(const c of s){const r=c.currency??"USD";a[r]=(a[r]??0)+Number(c.amount)}return Object.entries(a).map(([c,r])=>({currency:c,total:r}))}function ce(s){if(s.currency)return{primary:`${s.currency} ${Number(s.total_amount).toLocaleString(void 0,{minimumFractionDigits:2})}`};const a=Te(s.items);return{primary:a.length>0?"Multiple currencies":"—",breakdown:a}}function Le(s){var r;const a=(r=s.staff)==null?void 0:r.user;return a?`${a.first_name||""} ${a.last_name||""}`.trim()||a.email||`Staff #${s.staff_id}`:`Staff #${s.staff_id}`}function me(s,a){return s?a[s]??s:"—"}function zs({run:s,paymentMethodLabels:a,isTenantOwner:c=!1}){const r=ke(),[Oe,A]=o.useState(null),[de,j]=o.useState(!1),[$,R]=o.useState("manual"),[he,g]=o.useState(!1),[y,F]=o.useState(null),[T,L]=o.useState("manual"),[xe,b]=o.useState(!1),[O,m]=o.useState(1),[d,H]=o.useState(!1),[v,M]=o.useState(null),w=s.status==="processed",ue=s.status==="draft"||w&&c,pe=[{title:"HR",href:r.route("hr.staff.index")},{title:"Payments",href:r.route("hr.payments.index")},{title:oe(s.period_start,s.period_end),href:"#"}],B=s.items.filter(t=>t.status==="pending"),fe=s.items.filter(t=>t.status==="paid"),z=s.status==="draft"&&B.length>0,je=()=>{R("manual"),j(!0)},ge=()=>{z&&(H(!0),C.post(r.route("hr.payments.process",{paymentRun:s.id}),{payment_method:$},{preserveScroll:!0,onSuccess:()=>j(!1),onFinish:()=>H(!1)}))},ye=t=>{F(t),L("manual"),g(!0)},Ne=()=>{y!=null&&(A(y),M(y),C.post(r.route("hr.payments.items.pay",{paymentRun:s.id,item:y}),{payment_method:T},{preserveScroll:!0,onSuccess:()=>{g(!1),F(null)},onFinish:()=>{A(null),M(null)}}))},E=()=>{C.delete(r.route("hr.payments.destroy",{paymentRun:s.id})),b(!1),m(1)},be=t=>{b(t),t||m(1)},ve=t=>{var h;const n=`/${((h=r.tenant)==null?void 0:h.slug)??""}/hr/payments/${s.id}/slip/${t}`;return typeof window<"u"&&n?`${window.location.origin}${n}`:n};return e.jsxs(De,{breadcrumbs:pe,children:[e.jsx(we,{title:`Payment run – ${s.period_start}`}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("div",{className:"border-b bg-gradient-to-b from-muted/30 to-background",children:e.jsx("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:px-6",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"shrink-0",asChild:!0,children:e.jsx(Ce,{href:r.route("hr.payments.index"),children:e.jsx(_e,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:oe(s.period_start,s.period_end)}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[s.status==="processed"?e.jsxs(N,{variant:"secondary",className:"gap-1 font-normal",children:[e.jsx(I,{className:"h-3.5 w-3.5"}),"Completed"]}):e.jsxs(N,{variant:"outline",className:"gap-1 font-normal border-amber-500/50 text-amber-700 bg-amber-500/10",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),"Draft"]}),s.payment_method&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Via ",me(s.payment_method,a)]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.prorate?"Prorated by days":"Full amount"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:(()=>{const{primary:t,breakdown:l}=ce(s);return l!=null&&l.length?`${t} (${l.map(n=>`${n.currency} ${n.total.toLocaleString(void 0,{minimumFractionDigits:2})}`).join(", ")})`:`${t} total`})()}),s.narration&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Reference: ",s.narration]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[z&&e.jsxs(i,{onClick:je,disabled:d,className:"gap-2",children:[d?e.jsx(re,{className:"h-4 w-4 animate-spin"}):e.jsx(I,{className:"h-4 w-4"}),d?"Processing…":"Process entire run"]}),ue&&e.jsxs(i,{variant:"outline",className:"text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>{m(1),b(!0)},children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Delete run"]})]})]})})}),e.jsxs("div",{className:"mx-auto w-full max-w-6xl flex-1 px-4 py-6 sm:px-6",children:[e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(x,{className:"border-muted/50 shadow-sm",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Total amount"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:(()=>{const{primary:t,breakdown:l}=ce(s);return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-semibold tabular-nums",children:t}),l&&l.length>0&&e.jsx("ul",{className:"mt-2 space-y-0.5 text-sm text-muted-foreground",children:l.map(n=>e.jsxs("li",{className:"tabular-nums",children:[n.currency," ",n.total.toLocaleString(void 0,{minimumFractionDigits:2})]},n.currency))})]})})()})]}),e.jsxs(x,{className:"border-muted/50 shadow-sm",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Recipients"}),e.jsx($e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("p",{className:"text-2xl font-semibold",children:s.items.length})})]}),e.jsxs(x,{className:"border-muted/50 shadow-sm",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Paid"}),e.jsx(I,{className:"h-4 w-4 text-emerald-600"})]}),e.jsx(f,{children:e.jsx("p",{className:"text-2xl font-semibold",children:fe.length})})]}),e.jsxs(x,{className:"border-muted/50 shadow-sm",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx(ae,{className:"h-4 w-4 text-amber-600"})]}),e.jsx(f,{children:e.jsx("p",{className:"text-2xl font-semibold",children:B.length})})]})]}),e.jsxs(x,{className:"mt-6 border-muted/50 shadow-sm",children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center gap-2 text-base",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),"Payment line items"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Pay staff individually with "Pay" (choose method) or process the entire run. Generate a payment slip for each recipient.'})]}),e.jsx(f,{children:s.items.length===0?e.jsx("p",{className:"py-8 text-center text-muted-foreground",children:"No items in this run."}):e.jsx("div",{className:"rounded-xl border border-muted/50 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/30",children:[e.jsx("th",{className:"p-4 text-left font-medium",children:"Staff"}),e.jsx("th",{className:"p-4 text-right font-medium",children:"Amount"}),e.jsx("th",{className:"p-4 text-left font-medium",children:"Status"}),e.jsx("th",{className:"p-4 text-left font-medium",children:"Method"}),e.jsx("th",{className:"p-4 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:s.items.map(t=>{var h,U;const l=t.status==="pending",n=v===t.id;return e.jsxs("tr",{className:"border-b border-muted/50 last:border-0 transition-colors hover:bg-muted/20",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("p",{className:"font-medium",children:Le(t)}),((U=(h=t.staff)==null?void 0:h.user)==null?void 0:U.email)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.staff.user.email})]}),e.jsxs("td",{className:"p-4 text-right font-medium tabular-nums",children:[t.currency," ",Number(t.amount).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("td",{className:"p-4",children:t.status==="paid"?e.jsxs(N,{variant:"secondary",className:"gap-1 font-normal",children:[e.jsx(Re,{className:"h-3.5 w-3.5"}),"Paid",t.paid_at&&e.jsx("span",{className:"ml-1 opacity-80",children:new Date(t.paid_at).toLocaleDateString(void 0,{dateStyle:"short"})})]}):e.jsx(N,{variant:"outline",className:"font-normal border-amber-500/50 text-amber-700 bg-amber-500/10",children:"Pending"})}),e.jsx("td",{className:"p-4 text-muted-foreground text-xs",children:me(t.payment_method??s.payment_method,a)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="draft"&&l&&e.jsxs(i,{variant:"outline",size:"sm",className:"gap-1",disabled:n,onClick:()=>ye(t.id),children:[n?e.jsx(re,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(ne,{className:"h-3.5 w-3.5"}),n?"Paying…":"Pay"]}),e.jsx(i,{variant:"ghost",size:"sm",className:"gap-1",asChild:!0,children:e.jsxs("a",{href:ve(t.id),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Slip"]})})]})})]},t.id)})})]})})})]})]})]}),e.jsx(V,{open:de,onOpenChange:j,children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Process entire run"}),e.jsx(q,{children:"All pending items will be marked as paid. How are you making these payments?"})]}),e.jsxs("div",{className:"space-y-2 py-2",children:[e.jsx(Q,{children:"Payment method"}),e.jsxs(W,{value:$,onValueChange:R,children:[e.jsx(X,{className:"w-full",children:e.jsx(Z,{})}),e.jsx(ee,{children:le.map(t=>e.jsx(se,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs(J,{children:[e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(i,{onClick:ge,disabled:d,children:d?"Processing…":"Process run"})]})]})}),e.jsx(V,{open:he,onOpenChange:g,children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Mark as paid"}),e.jsx(q,{children:"How are you paying this staff member?"})]}),e.jsxs("div",{className:"space-y-2 py-2",children:[e.jsx(Q,{children:"Payment method"}),e.jsxs(W,{value:T,onValueChange:L,children:[e.jsx(X,{className:"w-full",children:e.jsx(Z,{})}),e.jsx(ee,{children:le.map(t=>e.jsx(se,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs(J,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(i,{onClick:Ne,disabled:v!==null,children:v!==null?"Saving…":"Mark as paid"})]})]})}),e.jsx(Se,{open:xe,onOpenChange:be,children:e.jsx(Pe,{children:w&&O===1?e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(S,{children:"Delete this completed payment run?"}),e.jsx(P,{children:"You are about to permanently delete a completed payment run. All records and line items will be removed. This cannot be undone. Only the organization owner can delete completed runs."})]}),e.jsxs(k,{children:[e.jsx(_,{children:"Cancel"}),e.jsx(i,{variant:"outline",onClick:()=>m(2),children:"Continue"})]})]}):w&&O===2?e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(S,{children:"Final confirmation"}),e.jsx(P,{children:"This is your last chance. Permanently delete this run and all its line items? This action cannot be undone."})]}),e.jsxs(k,{children:[e.jsx(i,{variant:"outline",onClick:()=>m(1),children:"Back"}),e.jsx(_,{children:"Cancel"}),e.jsx(te,{className:"bg-destructive text-white hover:bg-destructive/90 hover:text-white",onClick:E,children:"Delete run"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(S,{children:"Delete this payment run?"}),e.jsx(P,{children:"This will permanently delete the draft run and all its line items. This cannot be undone."})]}),e.jsxs(k,{children:[e.jsx(_,{children:"Cancel"}),e.jsx(te,{className:"bg-destructive text-white hover:bg-destructive/90 hover:text-white",onClick:E,children:"Delete run"})]})]})})})]})}export{zs as default};
