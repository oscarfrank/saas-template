import{r as n,j as e,u as me,H as fe,a as T}from"./app-D04Dztzg.js";import{u as P,B as E}from"./button-DZPivG0c.js";import{C as he,c as xe}from"./card-BiECpO3p.js";import{A as I,a as F}from"./alert-CDT7eYpy.js";import{I as ve,a as ge,b as S}from"./input-otp-BMl7_PB7.js";import{A as be}from"./app-layout-C_naymNT.js";import{S as je,H as ye}from"./layout-CpTnTvqo.js";import{u as we,P as k,c as D,a as B}from"./index-ybapLptU.js";import{R as Re,I as Ne,c as Q}from"./index-DxpSCYGk.js";import{u as Se}from"./index-5Qd1E-Xg.js";import{u as Ce}from"./index-ByPjEBNg.js";import{u as Ee}from"./index-wnnsRq2M.js";import{P as Ae}from"./index-Dnop7anH.js";import{c as V}from"./utils-DawFQoOT.js";import{C as Ie}from"./breadcrumb-EW6w0Tnx.js";import{L}from"./label-RUXCefAA.js";import{t as O}from"./index-CwasXQq4.js";import{S as Fe}from"./shield-DZ1jybk1.js";import{c as ke}from"./createLucideIcon-DQ1nCPNN.js";import{M as _e}from"./mail-D5g0vBUi.js";import{C as De}from"./circle-alert-DoebB800.js";/* empty css            */import"./sonner-BZ9uEQDq.js";import"./separator-D5oupA52.js";import"./use-effective-tenant-QBTvs0JY.js";import"./user-CHKOG5ae.js";import"./credit-card-DR0OTN7k.js";import"./building-2-DAyvAnId.js";import"./users-C90dJzc7.js";import"./package-DgqiXCfS.js";import"./user-plus-2Et7JMnD.js";import"./key-round-QiGZ6a3r.js";import"./history-DoytfjFO.js";import"./index-C7jeomV-.js";import"./index-QeErrECp.js";import"./input-DOcNm42I.js";import"./sheet-10OrOGMG.js";import"./index-CnJ5OywE.js";import"./index-DhOecPJh.js";import"./index-39nAXQv3.js";import"./x-Zd_QZ6W_.js";import"./index-DfZYuCB2.js";import"./index-BwMmloDF.js";import"./dropdown-menu-CTrM84f_.js";import"./check-CXnK2_NP.js";import"./chevron-down-RccFG6I8.js";import"./skeleton-Y604-fIL.js";import"./use-tenant-router-C1gTSJyt.js";import"./trash-2-bEjB-2Kd.js";import"./en-US-DSSwd-Ay.js";import"./endOfMonth-BNqLjwTF.js";import"./file-text-D9Mvcoy0.js";import"./dollar-sign-DAXZAp8e.js";import"./wallet-BpEENWzu.js";import"./chevron-right-BKyDHRej.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Ge=ke("Smartphone",Pe);var G="Radio",[Me,H]=B(G),[Te,Le]=Me(G),U=n.forwardRef((t,u)=>{const{__scopeRadio:c,name:x,checked:a=!1,required:d,disabled:f,value:v="on",onCheck:g,form:b,...j}=t,[h,m]=n.useState(null),o=P(u,y=>m(y)),i=n.useRef(!1),w=h?b||!!h.closest("form"):!0;return e.jsxs(Te,{scope:c,checked:a,disabled:f,children:[e.jsx(k.button,{type:"button",role:"radio","aria-checked":a,"data-state":Y(a),"data-disabled":f?"":void 0,disabled:f,value:v,...j,ref:o,onClick:D(t.onClick,y=>{a||g==null||g(),w&&(i.current=y.isPropagationStopped(),i.current||y.stopPropagation())})}),w&&e.jsx(z,{control:h,bubbles:!i.current,name:x,value:v,checked:a,required:d,disabled:f,form:b,style:{transform:"translateX(-100%)"}})]})});U.displayName=G;var K="RadioIndicator",W=n.forwardRef((t,u)=>{const{__scopeRadio:c,forceMount:x,...a}=t,d=Le(K,c);return e.jsx(Ae,{present:x||d.checked,children:e.jsx(k.span,{"data-state":Y(d.checked),"data-disabled":d.disabled?"":void 0,...a,ref:u})})});W.displayName=K;var Oe="RadioBubbleInput",z=n.forwardRef(({__scopeRadio:t,control:u,checked:c,bubbles:x=!0,...a},d)=>{const f=n.useRef(null),v=P(f,d),g=Ee(c),b=Ce(u);return n.useEffect(()=>{const j=f.current;if(!j)return;const h=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(h,"checked").set;if(g!==c&&o){const i=new Event("click",{bubbles:x});o.call(j,c),j.dispatchEvent(i)}},[g,c,x]),e.jsx(k.input,{type:"radio","aria-hidden":!0,defaultChecked:c,...a,tabIndex:-1,ref:v,style:{...a.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});z.displayName=Oe;function Y(t){return t?"checked":"unchecked"}var qe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],_="RadioGroup",[Be]=B(_,[Q,H]),$=Q(),X=H(),[Qe,Ve]=Be(_),J=n.forwardRef((t,u)=>{const{__scopeRadioGroup:c,name:x,defaultValue:a,value:d,required:f=!1,disabled:v=!1,orientation:g,dir:b,loop:j=!0,onValueChange:h,...m}=t,o=$(c),i=Se(b),[w,y]=we({prop:d,defaultProp:a??null,onChange:h,caller:_});return e.jsx(Qe,{scope:c,name:x,required:f,disabled:v,value:w,onValueChange:y,children:e.jsx(Re,{asChild:!0,...o,orientation:g,dir:i,loop:j,children:e.jsx(k.div,{role:"radiogroup","aria-required":f,"aria-orientation":g,"data-disabled":v?"":void 0,dir:i,...m,ref:u})})})});J.displayName=_;var Z="RadioGroupItem",ee=n.forwardRef((t,u)=>{const{__scopeRadioGroup:c,disabled:x,...a}=t,d=Ve(Z,c),f=d.disabled||x,v=$(c),g=X(c),b=n.useRef(null),j=P(u,b),h=d.value===a.value,m=n.useRef(!1);return n.useEffect(()=>{const o=w=>{qe.includes(w.key)&&(m.current=!0)},i=()=>m.current=!1;return document.addEventListener("keydown",o),document.addEventListener("keyup",i),()=>{document.removeEventListener("keydown",o),document.removeEventListener("keyup",i)}},[]),e.jsx(Ne,{asChild:!0,...v,focusable:!f,active:h,children:e.jsx(U,{disabled:f,required:d.required,checked:h,...g,...a,name:d.name,ref:j,onCheck:()=>d.onValueChange(a.value),onKeyDown:D(o=>{o.key==="Enter"&&o.preventDefault()}),onFocus:D(a.onFocus,()=>{var o;m.current&&((o=b.current)==null||o.click())})})})});ee.displayName=Z;var He="RadioGroupIndicator",te=n.forwardRef((t,u)=>{const{__scopeRadioGroup:c,...x}=t,a=X(c);return e.jsx(W,{...a,...x,ref:u})});te.displayName=He;var Ue=J,Ke=ee,We=te;function ze({className:t,...u}){return e.jsx(Ue,{"data-slot":"radio-group",className:V("grid gap-3",t),...u})}function q({className:t,...u}){return e.jsx(Ke,{"data-slot":"radio-group-item",className:V("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...u,children:e.jsx(We,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Ie,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}const Ye=[{title:"Two Factor Authentication",href:"/settings/two-factor-auth"}];function Xt({enabled:t,showingQrCode:u,showingRecoveryCodes:c,qrCode:x,recoveryCodes:a,status:d,error:f,method:v="authenticator"}){const[g,b]=n.useState(u),[j,h]=n.useState(c),[m,o]=n.useState(""),[i,w]=n.useState(v),[y,R]=n.useState(!1),[N,C]=n.useState(0),[M,A]=n.useState(null);n.useEffect(()=>{let l;return N>0&&(l=setInterval(()=>{C(r=>r-1)},1e3)),()=>clearInterval(l)},[N]);const s=me({code:"",method:i}),re=l=>{l.preventDefault(),R(!0),i==="email"?s.post(route("two-factor-auth.enable"),{onSuccess:()=>{C(60)},onError:r=>{r.method&&s.setError("method",r.method),R(!1)}}):s.post(route("two-factor-auth.enable"),{onSuccess:r=>{console.log("Full response:",r),console.log("All props:",r.props);const p=r.props.qrCode;p?(console.log("Found QR code in props"),A(p)):console.error("No QR code found in response:",{props:r.props})},onError:r=>{console.error("Error enabling 2FA:",r),r.method&&s.setError("method",r.method),R(!1),A(null)}})},oe=l=>{l.preventDefault(),s.post(route("two-factor-auth.disable"),{onSuccess:()=>{R(!0),C(60)},onError:r=>{r.code&&s.setError("code",r.code)}})},se=l=>{if(l.preventDefault(),m.length!==6)return;const r={code:m};T.post(route("two-factor-auth.confirm-disable"),r,{preserveScroll:!0,preserveState:!0,onBefore:()=>{l.preventDefault()},onSuccess:p=>{if(p.props.error){s.setError("code",p.props.error),o("");return}s.reset(),o(""),R(!1),b(!1),h(!1),O.success("Two-factor authentication has been disabled",{description:"Your account is now using standard password authentication.",duration:5e3})},onError:p=>{p.code&&s.setError("code",p.code),o("")}})},ae=l=>{if(l.preventDefault(),m.length!==6)return;const r={code:m,method:i};console.log("Current form data:",r),T.post(route("two-factor-auth.confirm"),r,{preserveScroll:!0,preserveState:!0,onBefore:()=>{l.preventDefault()},onSuccess:p=>{if(p.props.error){s.setError("code",p.props.error),o(""),R(!0),p.props.qrCode&&A(p.props.qrCode);return}s.reset(),o(""),R(!1),A(null),p.props.recoveryCodes&&h(!0),O.success("Two-factor authentication has been enabled successfully!",{description:`Your account is now more secure using ${i==="authenticator"?"an authenticator app":"email verification"}.`,duration:5e3})},onError:p=>{p.code&&s.setError("code",p.code),o(""),R(!0)}})},ie=l=>{l.preventDefault(),s.post(route("two-factor-auth.recovery-codes"),{onSuccess:()=>h(!0)})},ne=l=>{const r=l;w(r),s.setData("method",r),o(""),b(!1)},ce=()=>{N>0||(t?s.post(route("two-factor-auth.disable"),{onSuccess:()=>{C(60)}}):s.post(route("two-factor-auth.send-code"),{onSuccess:()=>{C(60)}}))},de=()=>i==="email"?e.jsxs(I,{className:"mb-4",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(F,{children:"While email 2FA provides security, we recommend using an authenticator app for better protection. Email 2FA can be vulnerable to email account compromise."})]}):null,le=()=>t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsxs(F,{children:["Two-factor authentication is currently enabled using the ",v," method."]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("form",{onSubmit:ie,children:e.jsx(E,{type:"submit",variant:"outline",disabled:s.processing,children:"Regenerate Recovery Codes"})}),e.jsx("form",{onSubmit:oe,children:e.jsx(E,{type:"submit",variant:"destructive",disabled:s.processing,children:"Disable 2FA"})})]}),j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost."}),e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:a&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.map((l,r)=>e.jsx("div",{className:"font-mono text-sm",children:l},r))})})]})]}):null,ue=()=>y?e.jsxs("div",{className:"space-y-4",children:[i==="authenticator"&&!t&&e.jsx("div",{className:"space-y-4",children:M?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan the following QR code using your phone's authenticator application."}),e.jsx("div",{className:"p-4 bg-white rounded-lg flex justify-center items-center",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:M}})})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading QR code..."})}),(i==="email"||t)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"We've sent a verification code to your email address to confirm disabling 2FA.":"We've sent a verification code to your email address."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:ce,disabled:s.processing||N>0,children:"Resend Code"}),N>0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Resend available in ",N," seconds"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"Enter the verification code from your email to disable two-factor authentication:":`Enter the code from your ${i==="authenticator"?"authenticator app":"email"} to confirm setup:`}),s.errors.code&&e.jsx(I,{variant:"destructive",children:e.jsx(F,{children:s.errors.code})}),e.jsxs("form",{onSubmit:t?se:ae,className:"space-y-4 flex flex-col items-center",children:[e.jsx(ve,{maxLength:6,value:m,onChange:o,disabled:s.processing,className:"gap-2",children:e.jsxs(ge,{className:"gap-2",children:[e.jsx(S,{index:0,className:"h-12 w-12 text-lg"}),e.jsx(S,{index:1,className:"h-12 w-12 text-lg"}),e.jsx(S,{index:2,className:"h-12 w-12 text-lg"}),e.jsx(S,{index:3,className:"h-12 w-12 text-lg"}),e.jsx(S,{index:4,className:"h-12 w-12 text-lg"}),e.jsx(S,{index:5,className:"h-12 w-12 text-lg"})]})}),e.jsx(E,{type:"submit",disabled:s.processing||m.length!==6,children:t?"Disable":"Confirm"})]})]})]}):null,pe=()=>t||y?null:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You can choose between using an authenticator app or receiving codes via email."}),e.jsxs(ze,{value:i,onValueChange:ne,className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(q,{value:"authenticator",id:"authenticator",className:"peer sr-only"}),e.jsxs(L,{htmlFor:"authenticator",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(Ge,{className:"mb-3 h-6 w-6"}),"Authenticator App"]})]}),e.jsxs("div",{children:[e.jsx(q,{value:"email",id:"email",className:"peer sr-only"}),e.jsxs(L,{htmlFor:"email",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(_e,{className:"mb-3 h-6 w-6"}),"Email"]})]})]}),de(),e.jsx("form",{onSubmit:re,className:"flex justify-center",children:e.jsx(E,{type:"submit",disabled:s.processing,children:"Enable Two-Factor Authentication"})})]});return e.jsxs(be,{breadcrumbs:Ye,children:[e.jsx(fe,{title:"Two Factor Authentication"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ye,{title:"Two Factor Authentication",description:"Add additional security to your account using two factor authentication."}),e.jsx(he,{children:e.jsxs(xe,{children:[d&&e.jsx(I,{className:"mb-4",children:e.jsx(F,{children:d})}),le(),ue(),pe()]})})]})})]})}export{Xt as default};
