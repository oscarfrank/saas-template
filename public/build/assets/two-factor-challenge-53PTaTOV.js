import{r as m,b as E,j as e,H as I}from"./app-CMfsqCQM.js";import{B as v}from"./button-B2dnQCAa.js";import{I as P,a as k,b as a}from"./input-otp-erXCSEYi.js";import{A as D}from"./auth-layout-CrSi5k0n.js";import{A as f,a as g}from"./alert-Ce17EFUv.js";import{C as L,a as V,b as O,c as H,d as z}from"./card-BKip0K0O.js";import{C as B}from"./checkbox-BuKLpctU.js";import{L as j}from"./label-BEW08XYy.js";import{I as U}from"./input-Bpdo4m0L.js";import{T as $,a as q,b as y,c as b}from"./tabs-BjbrlGHc.js";import{t as N}from"./index-q8lzB8Tn.js";/* empty css            */import"./utils-DawFQoOT.js";import"./sonner-DSzJt1Z7.js";import"./index-xqWKCSYm.js";import"./index-CSp-ZSgT.js";import"./index-C5ERfWkd.js";import"./index-jjTweGYJ.js";import"./check-KdCJQoSn.js";import"./createLucideIcon-DV9StWnM.js";import"./index-BDWLcZMo.js";import"./index-DJMkznTg.js";import"./index-BeUfNboo.js";import"./index-NxXi0nlY.js";function pe({email:C,password:w,remember:_,method:l,errors:F}){const[u,d]=m.useState("code"),[t,x]=m.useState(60),{data:o,setData:c,post:h,processing:s,errors:T}=E({code:"",recovery_code:"",email:C,password:w,remember:_,remember_device:!1,method:l});m.useEffect(()=>{let r;return t>0&&(r=setInterval(()=>{x(i=>i-1)},1e3)),()=>{r&&clearInterval(r)}},[t]);const p=r=>{r.preventDefault(),console.log("Form submitted with data:",{code:o.code,recovery_code:o.recovery_code,email:o.email,remember:o.remember,remember_device:o.remember_device,method:o.method}),h(route("login"),{preserveScroll:!0,onSuccess:i=>{console.log("2FA verification successful. Full response:",i),console.log("Attempting to navigate to dashboard..."),window.location.href=route("dashboard")},onError:i=>{console.error("2FA verification failed:",i),c(u==="code"?"code":"recovery_code","")},onFinish:()=>{console.log("2FA verification request completed")}})},A=()=>{t>0||(console.log("Resending code..."),h(route("two-factor-challenge.send-code"),{method:o.method,email:o.email,password:o.password,remember:o.remember,preserveState:!0,preserveScroll:!0,onSuccess:()=>{console.log("Code resent successfully"),x(60),N.success("A new verification code has been sent to your email")},onError:r=>{console.error("Failed to resend code:",r),N.error(r.code||"Failed to send verification code. Please try again.")}}))},n={...T,...F},R=o.code.length===6,S=o.recovery_code.length>0;return e.jsxs(D,{title:"Two Factor Authentication",description:"Please enter your authentication code to continue",children:[e.jsx(I,{title:"Two Factor Authentication"}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs(L,{className:"w-full max-w-md",children:[e.jsxs(V,{className:"space-y-1 text-center",children:[e.jsx(O,{className:"text-2xl font-bold",children:"Two Factor Authentication"}),e.jsx(H,{children:l==="authenticator"?"Please enter the code from your authenticator app":"Please enter the code sent to your email"})]}),e.jsx(z,{children:e.jsxs($,{value:u,onValueChange:r=>d(r),className:"w-full",children:[e.jsxs(q,{className:"grid w-full grid-cols-2",children:[e.jsx(y,{value:"code",children:l==="authenticator"?"From Authenticator App":"From Email"}),e.jsx(y,{value:"recovery",children:"Recovery Code"})]}),e.jsx(b,{value:"code",children:e.jsx("form",{className:"flex flex-col gap-6",onSubmit:p,children:e.jsxs("div",{className:"grid gap-6",children:[n.code&&e.jsx(f,{variant:"destructive",children:e.jsx(g,{children:n.code})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{maxLength:6,value:o.code,onChange:r=>{console.log("OTP value changed:",r),c("code",r)},disabled:s,className:"gap-2",containerClassName:"justify-center",children:e.jsxs(k,{className:"gap-2",children:[e.jsx(a,{index:0,className:"h-12 w-12 text-lg"}),e.jsx(a,{index:1,className:"h-12 w-12 text-lg"}),e.jsx(a,{index:2,className:"h-12 w-12 text-lg"}),e.jsx(a,{index:3,className:"h-12 w-12 text-lg"}),e.jsx(a,{index:4,className:"h-12 w-12 text-lg"}),e.jsx(a,{index:5,className:"h-12 w-12 text-lg"})]})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{id:"remember_device",checked:o.remember_device,onCheckedChange:r=>c("remember_device",r)}),e.jsx(j,{htmlFor:"remember_device",className:"text-sm text-muted-foreground",children:"Remember this device for 30 days"})]}),e.jsx(v,{type:"submit",className:"w-full",disabled:s||!R,size:"lg",children:s?"Verifying...":"Verify"}),e.jsxs("div",{className:"flex flex-col items-center gap-2 text-sm text-muted-foreground",children:[l==="email"&&e.jsx("button",{type:"button",onClick:A,disabled:t>0,className:`hover:text-primary ${t>0?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:t>0?`Resend code in ${t}s`:"Didn't receive a code? Resend"}),e.jsx("button",{type:"button",onClick:()=>d("recovery"),className:"hover:text-primary cursor-pointer",children:"Use a recovery code"})]})]})})}),e.jsx(b,{value:"recovery",children:e.jsx("form",{className:"flex flex-col gap-6",onSubmit:p,children:e.jsxs("div",{className:"grid gap-6",children:[n.recovery_code&&e.jsx(f,{variant:"destructive",children:e.jsx(g,{children:n.recovery_code})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"recovery_code",children:"Recovery Code"}),e.jsx(U,{id:"recovery_code",value:o.recovery_code,onChange:r=>c("recovery_code",r.target.value),placeholder:"Enter your recovery code",disabled:s})]}),e.jsx(v,{type:"submit",className:"w-full",disabled:s||!S,size:"lg",children:s?"Verifying...":"Verify"}),e.jsx("div",{className:"flex flex-col items-center gap-2 text-sm text-muted-foreground",children:e.jsx("button",{type:"button",onClick:()=>d("code"),className:"hover:text-primary",children:"Use authentication code instead"})})]})})})]})})]})})]})}export{pe as default};
